---
trigger: always_on
description: "文件创建、修改、删除的强制规则"
---

# 文件操作规范

**规则类型**: 🔴 强制规则  
**强制级别**: 🔴 严格执行  
**适用范围**: 所有文件操作

---

## �� 核心原则

### 三大核心原则

1. **先查后建** - 创建前必须搜索，避免重复
2. **明确位置** - 文件必须放在正确的目录
3. **规范命名** - 文件名必须清晰、具体、符合规范

### 适用范围

此规则适用于：
- ✅ 创建任何新文件（代码、文档、配置等）
- ✅ 移动现有文件到新位置
- ✅ 重命名现有文件
- ✅ 复制文件到新位置
- ✅ 删除文件前的验证

---

## 📋 创建文件前的检查清单

### Step 1: 搜索是否已存在类似文件 🔴

**🚨 AI创建任何文件前必须先执行此步骤！**

**目的**: 避免重复创建，避免文件混淆，避免编号冲突



**🔴 强制自检（AI必须执行）**：

在调用write_to_file或un_command创建文件之前，AI必须回答：
- [ ] 我刚才执行了list_dir或grep_search了吗？
- [ ] 我看到搜索结果了吗？
- [ ] 我确认没有重复文件了吗？

**如果任何一项是"否"  立即停止，先搜索！**

**AI违规记录**：
- 如果发现自己跳过了搜索  立即删除刚创建的文件
- 重新执行：搜索  确认  创建

**必须执行的搜索**:
```bash
# 方法1: 搜索文件内容
grep -r "关键词" [目录]/

# 方法2: 搜索文件名
find [目录]/ -name "*关键词*"

# 方法3: 列出目录内容
ls [目录]/
```

**必须回答的问题**:
- [ ] 是否有相同功能的文件？
- [ ] 是否有类似主题的文件？
- [ ] 新内容是否可以补充到现有文件？
- [ ] 如果已存在，为什么还要创建新文件？

**决策逻辑**:
```
如果找到类似文件：
   内容相同  ❌ 不创建，使用现有文件
   内容互补  ⚠️ 补充到现有文件，不新建
   内容重叠  ⚠️ 合并到现有文件
   完全不同  ✅ 可以创建新文件

如果未找到类似文件：
   ✅ 继续下一步检查
```

---

### Step 2: 确定正确的目录位置

**目的**: 确保文件放在正确的位置，保持项目结构清晰

**必须回答的问题**:
- [ ] 这是文档还是代码？
- [ ] 应该放在哪个主目录？（文档目录 vs 代码目录）
- [ ] 应该放在哪个子目录？
- [ ] 完整的绝对路径是什么？

**判断流程**:

参考 `09-项目结构与配置.md`：

```
文件类型判断：
 代码文件 (.py, .ts, .tsx, .js, .java, .cpp)
   放在代码主目录下
      后端代码  [后端目录]/
      前端代码  [前端目录]/
      测试代码  tests/
      脚本  scripts/

 文档文件 (.md, .txt, .rst)
   技术文档  代码目录下的 README.md 或 docs/
   项目文档  文档主目录下的分类目录
     记录类文档 (YYYY-MM-DD_*.md)   2-开发记录/
     报告类文档 (YYYY-MM-DD_*报告.md)   2-开发记录/
     规范类文档 ([主题]规范.md)   6-开发规范/
     说明类文档 ([主题]说明.md)   对应功能目录/
     指南类文档 ([主题]指南.md)   3-部署运维/ 或对应目录/
     归档文档   9-归档/

 配置文件 (.json, .yaml, .toml, .ini, .env)
   项目级配置  项目根目录
   代码配置  代码目录
   状态文件  文档目录（如适用）

 数据文件 (.json, .csv, .xlsx, .sqlite)
   示例数据  代码目录/data/
   文档数据  不提交到Git（.gitignore）

 临时文件 (.tmp, .temp, .bak)
    ⚠️ 添加到 .gitignore，不提交
```

**禁止的位置**:
- ❌ 项目根目录（除了明确允许的文件）
- ❌ 文档主目录的根目录（必须放在分类子目录）
- ❌ 随意创建新的顶层目录

---

### Step 3: 确认文件名符合规范

**目的**: 文件名清晰、统一、易于理解

**命名规范** (参考 `03-文件命名规范.md`):

**文档类型**:
- **规范类**: `[主题]规范.md`
  - 示例: `文件操作规范.md`, `API设计规范.md`
  
- **说明类**: `[主题]说明.md`
  - 示例: `部署说明.md`, `配置说明.md`
  
- **指南类**: `[主题]指南.md`
  - 示例: `新手指南.md`, `开发指南.md`
  
- **记录类**: `YYYY-MM-DD_[描述].md`
  - 示例: `2025-11-25_功能开发记录.md`
  
- **报告类**: `YYYY-MM-DD_[主题]报告.md`
  - 示例: `2025-11-25_测试报告.md`

**代码类型**:
- 遵循项目语言的命名规范
- Python: `snake_case.py`
- TypeScript: `PascalCase.tsx` (组件), `camelCase.ts` (工具)
- Java: `PascalCase.java`

**必须回答的问题**:
- [ ] 文件名是否清晰具体？
- [ ] 是否避免了禁止的关键词？
- [ ] 是否会与现有文件混淆？
- [ ] 是否符合命名类型规范？

**禁止的文件名**:
- ❌ 模糊名称: `文档.md`, `说明.md`, `笔记.md`, `README2.md`
- ❌ 临时名称: `临时.md`, `test.md`, `新建文档.md`, `TODO.md`
- ❌ 包含空格: `我的 文档.md`, `项目 说明.md`
- ❌ 随意命名: `aaa.md`, `xxx.py`, `temp123.js`
- ❌ 中英混杂: `项目setup.md`, `配置config.md`（除非有明确原因）

**允许的文件名**:
- ✅ 清晰具体: `用户认证功能说明.md`, `数据库设计规范.md`
- ✅ 符合类型: `2025-11-25_版本发布记录.md`
- ✅ 标准名称: `README.md`, `.gitignore`, `package.json`

---

### Step 4: 检查是否需要创建新目录

**目的**: 避免随意创建目录，保持项目结构稳定

**如果目录不存在，必须确认**:
- [ ] 这个新目录是否真的必要？
- [ ] 是否符合项目的目录分类规范？
- [ ] 是否应该放在现有目录的子目录下？
- [ ] 目录名称是否清晰明确？

**允许创建新目录的情况**:
- ✅ 项目配置中明确定义的目录结构
- ✅ 代码按模块划分的子目录（如 `components/`, `services/`）
- ✅ 文档按主题划分的子目录（但必须在分类目录下）

**禁止创建的目录**:
- ❌ 在项目根目录创建新的顶层目录
- ❌ 在文档主目录根目录创建不在分类中的目录
- ❌ 创建临时目录（除非添加到 .gitignore）
- ❌ 创建深层嵌套目录（>4层）

**目录命名规范**:
- 使用清晰的英文或中文名称
- 可以使用编号前缀（如 `1-`, `2-`）
- 避免空格和特殊字符
- 小写字母和连字符（代码目录）或中文（文档目录）

---

### Step 5: 准备更新项目索引

**目的**: 保持项目文档的可发现性和一致性

**创建文件后必须更新**:

1. **在文档目录创建文档**:
   - 更新 `[文档目录]/README.md` 的索引部分
   - 添加到对应分类的文件列表
   - 添加简短描述

2. **创建重要代码文件**:
   - 更新对应目录的 README.md
   - 如果是新功能/模块，添加说明
   - 更新项目状态文件（如适用）

3. **创建新的子目录**:
   - 在父目录的 README.md 中添加目录说明
   - 在新目录中创建 README.md
   - 说明目录用途和内容

4. **修改文件引用**:
   - 如果移动或重命名文件，更新所有引用
   - 检查 Markdown 链接
   - 检查代码中的 import 路径

**必须回答的问题**:
- [ ] 需要更新哪个 README.md？
- [ ] 文件应该添加到索引的哪个部分？
- [ ] 是否需要添加描述或说明？
- [ ] 是否有其他文件引用需要更新？

---

## 🚫 严格禁止的操作

### 绝对不允许的操作

#### 1. ❌ 跳过检查直接创建文件
**禁止**:
```
# 错误示例：直接创建，未检查
write_to_file("新建文档.md", content)
```

**必须**:
```
# 正确流程：
1. 搜索是否已存在
2. 确定目录位置
3. 确认文件名
4. 检查目录
5. 准备更新索引
6. 创建文件
7. 更新索引
```

#### 2. ❌ 在禁止的位置创建文件

**禁止的位置**（根据 `02-目录管理规范.md` 和 `07-项目配置.md`）:
- 项目根目录（除了明确允许的文件）
- 文档主目录的根目录
- 任何标记为"只读"或"自动生成"的目录
- 🔒 **知识库目录** - 只允许添加新文件，不允许修改、删除已有文件

**示例**:
```
❌ 错误：在根目录创建文档
/项目根目录/功能说明.md

✅ 正确：放在文档目录的分类子目录
/项目根目录/[文档目录]/[分类目录]/功能说明.md
```

#### 3. ❌ 使用禁止的文件名

**禁止**:
- 模糊名称
- 临时名称
- 包含空格
- 随意命名

**示例**:
```
❌ 错误文件名：
- 文档.md
- 临时笔记.md
- test123.py
- 我的 项目.md

✅ 正确文件名：
- 用户认证功能说明.md
- 2025-11-25_开发记录.md
- user_service.py
- 项目部署指南.md
```

#### 4. ❌ 创建文件后不更新索引

**禁止**:
```
创建文件  完成 ❌
```

**必须**:
```
创建文件  更新 README.md  完成 ✅
```

#### 5. ❌ 随意创建目录

**禁止**:
```
# 在根目录随意创建
/项目根目录/临时文件夹/
/项目根目录/我的笔记/
```

**必须**:
```
# 遵循项目配置的目录结构
参考 06-目录架构模板.md 和 07-项目配置.md
```

---

## ✅ AI自检清单

每次文件操作后必须检查：

- [ ] 搜索过类似文件了吗？
- [ ] 确认文件位置正确吗？
- [ ] 文件名符合规范吗？
- [ ] 需要创建的目录合理吗？
- [ ] README.md已更新吗？
- [ ] 所有引用已更新吗？
- [ ] 遵守了所有禁止规则吗？

---

**AI必须主动执行所有检查，不等待提醒！** 🎯
---

## 🔴 强制检查点（AI必须执行）

### 创建文件前必须检查

**AI在创建任何.md文件前，必须回答以下问题**：

1. **文件类型是什么？**
   - [ ] 记录类文档（YYYY-MM-DD_*.md）
   - [ ] 规范类文档（[主题]规范.md）
   - [ ] 说明类文档（[主题]说明.md）
   - [ ] 指南类文档（[主题]指南.md）
   - [ ] README.md

2. **文件应该放在哪里？**
   - [ ] 如果是记录类  必须放在: `2-开发记录/YYYY-MM-DD/`
   - [ ] 如果是规范类  必须放在: 对应目录（如 `3-部署运维/`）
   - [ ] 如果是说明类  必须放在: 对应功能目录
   - [ ] 如果是指南类  必须放在: `3-部署运维/` 或对应目录
   - [ ] 如果是README  必须放在: 对应目录内

3. **是否符合目录规范？**
   - [ ] 检查目录是否在 09-项目结构与配置.md 中定义
   - [ ] 检查目录命名是否符合标准
   - [ ] ❌ 绝对不放在文档主目录根目录！

4. **创建后必须自检**
   - [ ] 文件位置正确？
   - [ ] 文件命名符合规范？
   - [ ] 没有在禁止的位置？

### ❌ 严格禁止的位置

**AI绝对不能在以下位置创建文件**：

- ❌ `项目文档/` 根目录（除了README.md）
- ❌ 任何旧目录名（如 `7-过程记录/`）
- ❌ 任何不在09规则中定义的目录

**违规示例**：
`
❌ 项目文档/2025-11-27_报告.md  # 在根目录
❌ 项目文档/7-过程记录/文件.md  # 旧目录名
❌ 项目文档/temp/文件.md  # 未定义的目录
`

**正确示例**：
`
✅ 项目文档/2-开发记录/2025-11-27/2025-11-27_1430_报告.md
✅ 项目文档/3-部署运维/部署说明.md
✅ 项目文档/1-需求与设计/功能说明.md
`

---

## 🛡️ AI自我约束机制

### 每次创建文件时

1. **暂停** - 不要立即创建
2. **检查** - 执行上述检查点
3. **确认** - 确保位置正确
4. **创建** - 使用正确的路径
5. **验证** - 创建后自检

### 如果发现错误

- ⏸️ 立即停止
- 🗑️ 删除错误文件
- ✅ 在正确位置重新创建
- 💬 向用户报告错误

---

## 📍 文件归属判断标准

### AI创建文件前必须判断位置

创建任何文件前，AI必须按照以下流程判断文件应该放在哪里。

---

### 步骤1: 判断文件性质

#### 1.1 时间相关文件（带日期）

**特征**：文件名以 `YYYY-MM-DD` 开头

**判断**：
- ✅ **必须**放在：`项目文档/2-开发记录/YYYY-MM-DD/`
- ❌ **禁止**放在其他任何位置

**示例**：
```
✅ 2025-11-27_1709_文件归属规则方案.md
    2-开发记录/2025-11-27/

❌ 不要放在：3-部署运维/、1-需求与设计/等
```

#### 1.2 规则/规范建议文件

**特征**：文件名包含"建议"、"方案"、"分析"，内容是对规则系统的建议

**判断**：
- ✅ **未实施前**：`2-开发记录/YYYY-MM-DD/`（作为开发记录）
- ✅ **已实施后**：`9-归档/规则系统建议/`（归档）
- ❌ **禁止**放在：`3-部署运维/`

#### 1.3 功能设计文档

**特征**：文件名包含"功能"、"设计"、"实现"、"方案"，描述系统设计和实现

**判断**：
- ✅ **必须**放在：`1-需求与设计/`
- ❌ **禁止**放在：`3-部署运维/`

#### 1.4 部署运维文档（严格限制）

**必须同时满足ALL条件**：
1. ✅ 描述**如何部署**、**如何运行**、**如何配置**
2. ✅ 面向**运维人员**或**部署人员**
3. ✅ 与**开发设计**无关，与**运行环境**有关
4. ✅ **开发完成后**使用，不是开发时使用
5. ✅ **长期有效**，不是临时建议

**判断**：
- ✅ **全部满足**：`3-部署运维/`
- ❌ **任一不满足**：不能放在`3-部署运维/`

**允许的示例**：
```
✅ 后端启动方式说明.md  3-部署运维/
✅ 局域网访问指南.md  3-部署运维/
✅ 端口管理说明.md  3-部署运维/
```

**禁止的示例**：
```
❌ Git添加前检查指南.md（开发规范，非部署运维）
❌ 09规则增强建议.md（规则建议，非部署运维）
❌ 避免备份文件说明.md（开发规范，非部署运维）
```

---

### 步骤2: 关键词判断矩阵

| 关键词类型 | 关键词 | 目标目录 |
|-----------|--------|----------|
| **时间标记** | `YYYY-MM-DD` 开头 | 2-开发记录/日期/ |
| **设计类** | 功能、设计、实现、架构、方案、技术 | 1-需求与设计/ |
| **部署类** | 启动、部署、配置、迁移、安装、运行 | 3-部署运维/ ⚠️需验证准入 |
| **临时类** | 建议、分析、讨论、报告 | 2-开发记录/日期/ |
| **规范类** | 规范、指南、检查、流程 | 2-开发记录/日期/ 或集成到规则 |

---

### 步骤3: 3-部署运维/ 严格准入检查

**只允许以下类型**：

1. ✅ 启动/运行相关（如何启动、停止系统）
2. ✅ 部署/安装相关（如何部署、环境配置）
3. ✅ 网络/访问相关（如何配置网络、访问系统）
4. ✅ 迁移/备份相关（如何迁移、备份系统）
5. ✅ 演示账号相关（运维角度的账号管理）

**绝对禁止以下类型**：

- ❌ 规则建议（应放2-开发记录/）
- ❌ 开发规范（应放2-开发记录/或集成到规则）
- ❌ 功能设计（应放1-需求与设计/）
- ❌ 技术方案（应放1-需求与设计/）
- ❌ 临时分析（应放2-开发记录/）
- ❌ 测试报告（应放2-开发记录/）

---

### 步骤4: AI强制执行流程

创建文件时，AI**必须**：

```
1. 提取关键信息
   - 文件名、内容主题、日期

2. 判断文件性质
   - 带日期？  2-开发记录/日期/
   - 功能设计？  1-需求与设计/
   - 部署运维？  验证准入条件
   - 临时建议？  2-开发记录/日期/

3. 准入检查（如果是3-部署运维/）
   - 验证是否满足ALL 5个条件
   - 任一不满足  不能放3-部署运维/

4. 确定目录并创建

5. 验证位置正确
```

---

### 步骤5: 不确定时的默认规则

**如果无法确定位置**：
- ✅ 默认放在：`2-开发记录/YYYY-MM-DD/`
- ✅ 文件名加日期前缀
- ❌ 不要随机选择目录

---

### 快速判断：3-部署运维/ 准入测试

**问自己5个问题**（必须ALL是）：
1. 这是给运维人员看的吗？
2. 这在开发阶段不需要吗？
3. 这描述部署/运行吗？
4. 这不是临时建议吗？
5. 这与代码开发无关吗？

**如果有任何一个"否"，就不能放在3-部署运维/**
