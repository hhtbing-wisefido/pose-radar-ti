---
trigger: always_on
description: "Git操作规范 - 提交、推送、分支管理的标准流程"
---
# Git操作规范

**规则类型**: 🔴 强制规则  
**强制级别**: 🔴 严格执行  
**适用范围**: 所有Git操作

---

## 🎯 核心原则

### AI在执行Git操作时必须遵守

**绝对禁止**：

**🔴 AI执行Git命令前强制自检**：

在执行任何git add命令之前，AI必须问自己：
- [ ] 我要执行的命令中有-A、.、*吗？
- [ ] 如果有  这是禁止的！必须改成逐个指定文件
- [ ] 我执行了git status检查了吗？
- [ ] 我分析了哪些文件应该添加吗？

**如果发现自己正要执行git add -A**：
1. ⏸️ 立即停止
2. 🔄 改为：git status  分析  逐个添加
3. ❌ 永远不要执行批量添加

**AI违规记录**：
- 如果发现自己执行了git add -A  立即git reset撤销


- ❌ 禁止使用 `git add -A` 或 `git add .`
- ❌ 禁止不检查就批量添加文件
- ❌ 禁止提交临时文件、空文件、旧目录

**必须执行**：
- ✅ 必须先检查工作区状态
- ✅ 必须选择性添加文件
- ✅ 必须在提交前确认

---

## 📋 强制检查清单

### AI在执行 `git add` 前必须检查

#### 1. 检查工作区状态
```powershell
git status
```

**必须确认**：
- [ ] 查看了所有待添加的文件
- [ ] 识别了新文件、修改文件、删除文件
- [ ] 没有可疑的文件名

#### 2. 识别可疑文件

**可疑文件模式**（禁止添加）：
- `*temp*.py|.md|.txt` - 临时文件
- `*test*.py` - 测试文件
- `*_old*` - 旧文件
- `*backup*` - 备份文件
- `.windsurfrules/` - 旧规则目录
- `项目记录/` - 旧目录名
- 任何0字节的文件

**如发现可疑文件**：
1. ⏸️ 停止添加操作
2. 💬 询问用户："发现可疑文件 [文件名]，是否应该添加？"
3. ✅ 建议添加到 `.gitignore`

#### 3. 检查空文件

**AI必须检查**：
```powershell
# 列出所有0字节文件
Get-ChildItem -Recurse | Where-Object { $_.Length -eq 0 }
```

**如发现空文件**：
- ⏸️ 停止操作
- 💬 提示用户："发现空文件 [文件名]，可能是误创建"
- ❌ 不添加到Git

#### 4. 检查旧目录

**禁止添加的目录**：
- `.windsurfrules/` - 已迁移到 `.windsurf/rules/`
- `项目记录/` - 已重命名为 `项目文档/`
- 任何带 `_old`、`_backup`、`_temp` 后缀的目录

---

## ✅ 正确的Git操作流程

### 流程1：添加文件（强制）

```
1. 检查工作区
   git status
   
2. AI分析输出
   - 识别文件类型
   - 检测可疑文件
   - 检查空文件
   
3. 选择性添加（逐个指定）
   git add "项目文档/2-开发记录/YYYY-MM-DD_描述.md"
   git add ".windsurf/rules/NN-规则名.md"
   
4. 确认暂存区
   git status
   git diff --cached --name-only
   
5. 提交
   git commit -m "清晰的描述"
```

### 流程2：提交前验证（强制）

**AI必须在提交前验证**：

```powershell
# 1. 查看暂存区文件列表
git diff --cached --name-only

# 2. AI自检
- [ ] 所有文件都是应该提交的？
- [ ] 没有临时文件？
- [ ] 没有空文件？
- [ ] 没有旧目录？
- [ ] 文件路径正确？

# 3. 确认无误再提交
git commit -m "描述"
```

---

## 🚫 绝对禁止的操作

### ❌ 禁止1：批量添加

```powershell
# 永远不要这样做
git add -A   # ❌ 禁止！
git add .    # ❌ 禁止！
git add *    # ❌ 禁止！
```

**原因**：会无差别添加所有文件，包括临时文件和错误文件

### ❌ 禁止2：不检查就提交

```powershell
# 永远不要这样做
git add 文件
git commit -m "update"  # ❌ 没检查就提交
```

**必须**：
```powershell
git add 文件
git status              # ✅ 必须检查
git diff --cached       # ✅ 必须查看变更
git commit -m "描述"
```

### ❌ 禁止3：忽略警告

**如果检测到问题**：
- ❌ 不要忽略
- ❌ 不要强行继续
- ✅ 必须处理问题
- ✅ 必须询问用户

---

## 📝 文件类型判断规则

### ✅ 应该添加的文件

**文档类**：
- `YYYY-MM-DD_描述.md` - 开发记录
- `[主题]规范.md` - 规范文档
- `[主题]说明.md` - 说明文档
- `README.md` - 索引文档

**代码类**：
- `*.py` - Python代码（非临时）
- `*.ts`, `*.tsx` - TypeScript代码
- `*.js`, `*.jsx` - JavaScript代码

**配置类**：
- `.gitignore` - Git配置
- `package.json` - 项目配置
- `requirements.txt` - 依赖配置

### ❌ 不应该添加的文件

**临时文件**：
- `*temp*.py|.md|.txt`
- `*test*.py`
- `*.tmp`
- `*.log`

**旧文件**：
- `*_old.*`
- `*backup*`
- `*.bak`

**空文件**：
- 任何0字节的文件

**旧目录**：
- `.windsurfrules/`
- `项目记录/`

---

## 🔍 AI自检机制

### 每次Git操作后，AI必须自检

#### 检查点1：添加前
- [ ] 运行了 `git status`？
- [ ] 分析了文件列表？
- [ ] 检测了可疑文件？
- [ ] 检查了空文件？

#### 检查点2：添加时
- [ ] 使用了选择性添加？
- [ ] 明确指定了文件路径？
- [ ] 没有使用 `git add -A`？

#### 检查点3：提交前
- [ ] 运行了 `git status`？
- [ ] 查看了 `git diff --cached`？
- [ ] 确认了所有文件都应该提交？
- [ ] 提交信息清晰明确？

---

## 💡 最佳实践

### 示例1：添加开发记录

```powershell
# 1. 检查状态
git status

# AI分析：
# ?? 项目文档/2-开发记录/2025-11-27/2025-11-27_1430_功能完成.md
# ✅ 这是正常的开发记录文件

# 2. 添加文件
git add "项目文档/2-开发记录/2025-11-27/2025-11-27_1430_功能完成.md"

# 3. 确认
git status

# 4. 提交
git commit -m "docs: 添加功能完成记录"
```

### 示例2：发现可疑文件

```powershell
# 1. 检查状态
git status

# AI分析：
# ?? add_frontmatter.py (0字节)
# ❌ 这是空文件，可疑！

# 2. AI操作：
# - 停止添加操作
# - 提示用户："发现空文件 add_frontmatter.py，建议删除或添加到.gitignore"
# - 不添加此文件
```

### 示例3：处理多个文件

```powershell
# 1. 检查状态
git status

# 输出：
# ?? 项目文档/2-开发记录/file1.md
# ?? 项目文档/2-开发记录/file2.md
# ?? temp_test.py

# AI分析：
# ✅ file1.md - 正常文档
# ✅ file2.md - 正常文档
# ❌ temp_test.py - 临时测试文件

# 2. 只添加正常文件
git add "项目文档/2-开发记录/file1.md"
git add "项目文档/2-开发记录/file2.md"

# 3. 提示用户处理temp_test.py
# "发现临时文件 temp_test.py，建议添加到.gitignore"
```

---

## 🎯 与其他规则的关系

### 配合规则

- **00-核心工作原则** - 自检机制
- **01-文件操作规范** - 文件命名和位置
- **03-文件命名规范** - 识别正确的文件名
- **04-变更同步规则** - Git操作后的同步

### 优先级

🔴 **最高优先级** - Git操作必须严格遵守此规则

---

## 📚 相关文档

- **使用指南**: `项目文档/3-部署运维/Git添加前检查指南.md`
- **配置文件**: `.gitignore`

---

## ✅ 总结

### AI必须记住

1. **❌ 永远不用** `git add -A` 或 `git add .`
2. **✅ 必须检查** 每次添加前运行 `git status`
3. **🔍 必须识别** 可疑文件、空文件、旧目录
4. **⏸️ 必须停止** 发现问题时停止操作
5. **💬 必须询问** 不确定时询问用户

### 核心流程

```
检查  分析  选择性添加  确认  提交
```

**每一步都必须执行，不能跳过！**

---

**AI必须将此规则刻入核心，每次Git操作都严格遵守！** 🎯

---

## 🗑️ 删除文件的正确流程

### AI删除文件时必须

#### 方法1：使用git rm（推荐）

```powershell
git rm "文件路径"
# 自动删除文件并添加删除记录到暂存区
```

#### 方法2：Remove-Item + git add

```powershell
Remove-Item "文件路径" -Force
git add "文件路径"  #  必须立即执行
```

#### ❌ 绝对禁止

```powershell
Remove-Item "文件路径"  # ❌ 只删除不添加
# 这会导致文件删除但Git不知道，造成同步遗漏
```

---

## 🔍 Git同步状态检查流程

### 用户要求"同步GitHub"时必须执行

#### 4项强制检查

```powershell
# 检查1：工作区未暂存的变更
$check1 = git status --short
if ($check1) { "❌ 有未暂存的变更" }

# 检查2：未暂存的文件
$check2 = git diff --name-only
if ($check2) { "❌ 有未暂存的文件" }

# 检查3：已暂存但未提交
$check3 = git diff --cached --name-only
if ($check3) { "❌ 有已暂存但未提交的文件" }

# 检查4：未推送的提交
$check4 = git log origin/main..HEAD --oneline
if ($check4) { "❌ 有未推送的提交" }
```

#### 判断逻辑

- ✅ **全部为空**  真正同步  可以说"已同步"
- ❌ **任一有输出**  需要同步  执行同步操作

---

## ✅ 说"已同步GitHub"前的验证清单

AI必须确认：

- [ ] `git status --short` 为空
- [ ] `git diff --name-only` 为空
- [ ] `git diff --cached --name-only` 为空
- [ ] `git log origin/main..HEAD` 为空

**只有全部通过，才能说"✅ GitHub已同步"**

**如有任何一项不通过，必须先同步，再验证**

---

## 🔴 绝对禁止

### 禁止行为

- ❌ 删除文件后不添加到Git
- ❌ 只检查一项就说"已同步"
- ❌ 过度信任单一命令输出
- ❌ 不验证就说"已完成"

### 教训

**2025-11-27案例**：
- AI删除4个文件但没有git add
- 用户要求同步时，AI只检查git status
- 输出为空就说"已同步"
- 实际有4个删除未同步
- 用户发现后质问，AI才发现问题

**结论**：必须多重验证，不能偷懒！
