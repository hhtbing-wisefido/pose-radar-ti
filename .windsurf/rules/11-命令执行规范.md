---
trigger: always_on
description: "命令执行和终端操作规范"
---

# 命令执行规范

**规则类型**: 🔴 强制规则  
**强制级别**: 🔴 严格执行  
**适用范围**: 所有run_command工具调用

---

## 🔴 核心规则：禁止阻塞模式

### 绝对禁止



**🔴 AI调用run_command前强制自检**：

在调用run_command工具之前，AI必须检查：
- [ ] 我的Blocking参数是什么？
- [ ] 如果是true  这是禁止的！必须改成false
- [ ] 我设置了WaitMsBeforeAsync吗？
- [ ] 时间设置合理吗？（1000-5000ms）

**如果发现自己正要用Blocking: true**：
1. ⏸️ 立即停止
2. 🔄 改为：Blocking: false + WaitMsBeforeAsync
3. ❌ 永远不要用阻塞模式

**AI违规记录**：
- 每次调用run_command必须是Blocking: false
- 如果不小心用了true  下次对话开始前提醒自己

❌ **禁止使用 `Blocking: true`**
- 会导致Windsurf UI卡住
- 用户看不到进度
- 用户误以为死机而Cancel
- 造成时间浪费

### 必须使用

✅ **必须使用非阻塞模式**
```
Blocking: false
WaitMsBeforeAsync: 适当的毫秒数
```

---

## 📋 使用指南

### 快速命令（< 1秒）
```
Blocking: false
WaitMsBeforeAsync: 1000
```

### 中等命令（1-5秒）
```
Blocking: false
WaitMsBeforeAsync: 3000
```

### 长时间命令（> 5秒）
```
Blocking: false
WaitMsBeforeAsync: 5000
```

然后用 `command_status` 检查结果

---

## ⚠️ 特殊情况处理

### 需要看输出的命令

使用有进度输出的命令：
```powershell
# ❌ 错误
Remove-Item -Recurse  # 无输出

# ✅ 正确
cmd /c "rd /s /q path && echo 完成"
robocopy source dest /MOV  # 有进度
```

### 大量文件操作

- 删除 > 100个文件  用 `cmd /c rd`
- 移动 > 50个文件  用 `robocopy`
- 复制 > 50个文件  用 `robocopy`

---

## ✅ 正确示例

``````
# 删除目录
run_command:
  CommandLine: cmd /c "rd /s /q temp"
  Blocking: false
  WaitMsBeforeAsync: 3000

# 移动文件
run_command:
  CommandLine: robocopy source dest /MOV
  Blocking: false
  WaitMsBeforeAsync: 5000
``````

---

## 🚫 错误示例

``````
# ❌ 绝对禁止
run_command:
  CommandLine: Remove-Item -Recurse
  Blocking: true  #  禁止！
``````

---

## 💡 记住

1. **永远不用 Blocking: true**
2. **大量操作用非阻塞 + 进度命令**
3. **完成后用 command_status 检查**

---

**AI必须严格遵守，绝不违反！** 🎯
