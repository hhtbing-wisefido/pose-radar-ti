---
trigger: always_on
description: "修改后必须同步文档和索引"
---

# 变更同步规则

**规则类型**: 🔴 强制规则  
**强制级别**: 🔴 严格执行

---

## 🔴 版本更新同步规则（新增）

### 版本/重大功能变更后必须同步

**触发条件**：
- ✅ 版本号变更（如 v2.0.0  v2.1.0）
- ✅ 词条数量变化（如 71条  104条）
- ✅ Schema字段变更（新增/删除字段）
- ✅ 新增编码系统或Category
- ✅ 新增重大功能

**必须更新的README**：
1. �� **根目录 README.md** - 版本号、词条统计、功能列表
2. 🔴 **project-code/README.md** - 版本号、更新日志
3. 🟡 **项目文档/README.md** - 如有新开发记录目录

**根目录README必须同步的内容**：
| 字段 | 位置 | 说明 |
|-----|------|------|
| 版本号 | 标题行、badge | 如 v2.1.0+owlRD |
| 词条总数 | 当前统计 | 如 104条 |
| 编码系统分布 | 统计章节 | SNOMED/Internal/TDP占比 |
| 功能列表 | 核心特性 | 新增功能说明 |
| 最后更新日期 | 文件末尾 | 当前日期 |

---

## 🔴 AI修改文件后强制执行（非提醒）

**每次修改/创建/删除/移动文件后**，AI必须**立即执行**（不是提醒）：

### 检查1: 是否需要更新README？
- 这个目录有README.md吗？
- README中是否需要更新？
- **如果是  立即执行更新，不等用户确认**

### 检查2: 是否需要更新索引？
- 这是在项目文档/目录下吗？
- 需要更新文档索引吗？

### 检查3: 是否需要更新引用？
- 其他文件引用了这个文件吗？
- 需要更新链接吗？

**绝对禁止**：
- ❌ 修改完文件就结束，不同步
- ❌ 只提醒用户，不执行同步
- ❌ 等用户要求才同步

**AI违规记录**：
- 如果忘记同步  立即补充执行

---

## 核心原则

### 变更必须同步

`
代码变更  文档同步  索引更新  Git提交
`

**核心理念**:
- �� 文档是代码的一部分 - 修改代码=修改文档
- 🔗 保持一致性 - 任何变更都要保持系统一致
- ✅ 完整性检查 - 确保所有相关内容已更新
- 🔴 主动执行 - 不等待用户要求

---

## 适用场景

| 操作类型 | 需要同步 | 原因 |
|---------|---------|------|
| ✏️ 修改文件内容 | ✅ 必须 | 功能改变需要更新文档 |
| ❌ 删除文件 | ✅ 必须 | 索引需要移除 |
| 📝 重命名文件 | ✅ 必须 | 所有引用需要更新 |
| 📦 移动文件 | ✅ 必须 | 路径变更需要同步 |
| 🚀 添加新功能 | ✅ 必须 | README需要说明 |
| 🔄 版本更新 | ✅ 必须 | 根目录README必须更新 |
| 🐛 修Bug | ⚠️ 视情况 | 如影响使用需更新 |
| ♻️ 重构代码 | ⚠️ 视情况 | 如API改变需更新 |
| 💅 样式调整 | ❌ 通常不需要 | 不影响功能 |

---

## 修改文件后的同步要求

### 1. 更新README.md
- 如果添加新功能，在README中说明
- 如果修改现有功能，更新相关章节
- 保持README与实际功能一致
- **版本更新必须同步根目录README**

### 2. 更新索引文件
- 项目文档/README.md - 如有新文档目录
- .windsurf/README.md - 如修改规则

### 3. 更新引用
- 检查其他文档是否引用该文件
- 更新所有相关链接
- 确保没有死链接

---

## 检查清单

操作后必须检查：
1. [ ] README.md已更新
2. [ ] 相关索引已更新
3. [ ] 所有引用已修正
4. [ ] 没有死链接
5. [ ] 目录结构图正确
6. [ ] Git提交包含所有变更
7. [ ] **版本更新时：根目录README已同步**

---

## 严格禁止

### ❌ 绝对禁止的行为
1. **修改代码但不更新文档**
2. **删除文件但不更新索引**
3. **重命名但不更新引用**
4. **只更新部分文档**
5. **版本更新但不同步根目录README**
6. **只提醒用户而不执行同步**

---

## AI自检要求

每次文件操作后，AI必须：
1. ✅ 自动检查是否需要同步
2. ✅ 列出需要更新的所有文档
3. ✅ **立即执行**所有必要的同步操作
4. ✅ 验证同步完成
5. ✅ 在Git提交中包含所有同步文件

**AI必须主动执行同步，绝不等待用户要求！**

---

**保持同步是保持系统整洁和可维护性的关键！** 🎯
