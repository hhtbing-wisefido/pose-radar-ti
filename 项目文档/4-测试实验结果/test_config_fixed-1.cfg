% ***************************************************************
% 修复后的AWRL6844配置文件
% 基于: 固件配置匹配关系测试报告
% 日期: 2025-12-23
% 目的: 与mmwave_demo.release.appimage固件100%匹配
% 
% 修复要点:
% 1. 使用antGeometryBoard xWRL6844EVM（不使用antGeometryCfg）
% 2. 启用runtimeCalibCfg 1
% 3. frameCfg使用1358 loops和100ms period
% 4. 添加adcDataDitherCfg 1
% 5. 启用lowPowerCfg 1
% 6. 禁用adcLogging 0
% ***************************************************************

% ========================================
% 1. 停止传感器
% ========================================
sensorStop 0

% ========================================
% 2. 通道配置 (4T4R TDM模式)
% ========================================
% channelCfg <rxChannelEn> <txChannelEn> <cascading>
% rxChannelEn: 153 = 10011001b = RX0,RX3,RX4,RX7 (4个RX)
% txChannelEn: 255 = 11111111b = 全部8个TX（4T4R TDM需要4个）
% cascading: 0 = 单芯片模式
channelCfg 153 255 0

% ========================================
% 3. APLL频移使能
% ========================================
% apllFreqShiftEn <enable>
% 0 = 禁用频移
apllFreqShiftEn 0

% ========================================
% 4. Chirp通用配置 (TDM模式)
% ========================================
% chirpComnCfg <numTxAnt> <DigOutputSampRate> <DigOutputBitsSel> <DfeFirSel> 
%              <useHWSessionCfg> <Slope> <NumAdcSamples>
% 参数说明:
%   numTxAnt: 8 (TDM模式，使用4个TX)
%   DigOutputSampRate: 0
%   DigOutputBitsSel: 0
%   DfeFirSel: 256
%   useHWSessionCfg: 1 (使用硬件配置)
%   Slope: 13.1 MHz/us
%   NumAdcSamples: 3
chirpComnCfg 8 0 0 256 1 13.1 3

% ========================================
% 5. Chirp时序配置
% ========================================
% chirpTimingCfg <chirpStartIdx> <chirpEndIdx> <chirpLoopNum> 
%                <burstInterval> <deviceStartupTimeUsec>
% 参数说明:
%   chirpStartIdx: 6
%   chirpEndIdx: 63
%   chirpLoopNum: 0
%   burstInterval: 160
%   deviceStartupTimeUsec: 58
chirpTimingCfg 6 63 0 160 58

% ========================================
% 6. 帧配置 (关键参数)
% ========================================
% frameCfg <chirpStartIdx> <chirpEndIdx> <numLoops> <numFrames> 
%          <framePeriodicity> <triggerSelect>
% 参数说明:
%   chirpStartIdx: 64
%   chirpEndIdx: 0
%   numLoops: 1358 ⭐ (必须匹配固件内置值)
%   numFrames: 1
%   framePeriodicity: 100 ⭐ (必须匹配固件内置值，单位ms)
%   triggerSelect: 0
frameCfg 64 0 1358 1 100 0

% ========================================
% 7. GUI监控配置
% ========================================
% guiMonitor <detectedObjects> <logMagRange> <noiseProfile> 
%            <rangeAzimuthHeatMap> <rangeDopplerHeatMap> <statsInfo>
guiMonitor 1 1 0 0 0 1

% ========================================
% 8. CFAR处理配置 (Range方向)
% ========================================
% cfarProcCfg <subFrameIdx> <procDirection> <mode> <noiseWin> 
%             <guardLen> <divShift> <cyclicMode> <thresholdScale> <peakGrouping>
% 参数说明:
%   subFrameIdx: 0 (Range方向)
%   procDirection: 2
%   mode: 8
%   noiseWin: 4
%   guardLen: 3
%   divShift: 0
%   cyclicMode: 9.0
%   thresholdScale: 0
%   peakGrouping: (无)
cfarProcCfg 0 2 8 4 3 0 9.0 0

% ========================================
% 9. CFAR处理配置 (Doppler方向)
% ========================================
cfarProcCfg 1 2 4 2 2 1 9.0 0

% ========================================
% 10. CFAR FOV配置 (Range)
% ========================================
% cfarFovCfg <subFrameIdx> <min> <max>
% Range: 0.25m ~ 9.0m
cfarFovCfg 0 0.25 9.0

% ========================================
% 11. CFAR FOV配置 (Doppler)
% ========================================
% Doppler: -20.16 ~ 20.16 m/s
cfarFovCfg 1 -20.16 20.16

% ========================================
% 12. AOA处理配置
% ========================================
% aoaProcCfg <numAzimuthBins> <numElevationBins>
aoaProcCfg 64 64

% ========================================
% 13. AOA FOV配置
% ========================================
% aoaFovCfg <minAzimuthDeg> <maxAzimuthDeg> <minElevationDeg> <maxElevationDeg>
aoaFovCfg -60 60 -60 60

% ========================================
% 14. 杂波去除配置
% ========================================
% clutterRemoval <enable>
clutterRemoval 0

% ========================================
% 15. 工厂校准配置
% ========================================
% factoryCalibCfg <enable> <reserved1> <reserved2> <reserved3> <flashOffset>
factoryCalibCfg 1 0 44 2 0x1ff000

% ========================================
% 16. 运行时校准配置 ⭐ (关键)
% ========================================
% runtimeCalibCfg <enable>
% 1 = 启用运行时校准（必须匹配固件要求）
runtimeCalibCfg 1

% ========================================
% 17. 天线几何配置 ⭐ (关键)
% ========================================
% 使用Board配置（不使用antGeometryCfg）
% antGeometryBoard <boardType>
% 必须使用xWRL6844EVM，固件会自动加载板级天线配置
antGeometryBoard xWRL6844EVM

% ========================================
% 18. ADC数据抖动配置 ⭐ (新增)
% ========================================
% adcDataDitherCfg <enable>
% 1 = 启用ADC数据抖动（减少量化噪声）
adcDataDitherCfg 1

% ========================================
% 19. ADC数据源配置
% ========================================
% adcDataSource <mode> <filename>
% mode: 0 = 从雷达获取实时数据
adcDataSource 0 adc_test_data_0001.bin

% ========================================
% 20. ADC日志配置 ⭐ (关键)
% ========================================
% adcLogging <enable>
% 0 = 禁用ADC logging（匹配固件默认行为）
adcLogging 0

% ========================================
% 21. 低功耗配置 ⭐ (关键)
% ========================================
% lowPowerCfg <enable>
% 1 = 启用低功耗模式（匹配固件默认值）
lowPowerCfg 1

% ========================================
% 22. 启动传感器
% ========================================
% sensorStart <reserved1> <reserved2> <reserved3> <reserved4>
sensorStart 0 0 0 0
