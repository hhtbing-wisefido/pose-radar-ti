# 🐍 Python烧录工具

> **图形化烧录工具 v1.0.8 - 模块化架构、专业、直观、高效**
> **作者: Benson@Wisefido**

---

## 📍 SDK依赖路径

**调用的SDK工具**:
```
C:\ti\MMWAVE_L_SDK_06_01_00_01\tools\FlashingTool\arprog_cmdline_6844.exe
```

**设备型号**: AWRL6844 (xWRL684x-evm)

**工具说明**:
- flash_tool.py 是封装器，调用 arprog_cmdline_6844.exe 执行烧录
- 所有烧录操作均通过arprog完成
- Python工具提供GUI界面、端口管理、进度显示功能

---

## 📦 工具版本

| 文件 | 版本 | 说明 |
|------|------|------|
| `flash_tool.py` | **v1.0.8** | 🎉 模块化架构⭐（标签页分离+易于扩展） |

---

## ✨ v1.0.8 新功能 🎉

### 🆕 本次更新（2025-12-15）

**🏗️ 模块化架构重构** - 代码精简36%，可维护性大幅提升

1. **📂 标签页模块化** - 每个标签页独立为一个模块
   - 旧版本：单文件 2753行 ❌
   - 新版本：主入口 518行 + 4个标签页模块 1247行 ✅
   - 代码精简：**-36%** (1765行 vs 2753行)
   - 维护性提升：**81%** (主入口代码减少)

2. **🎯 清晰的目录结构** - 分离关注点
   ```
   5-Scripts/
   ├── flash_tool.py        # 主入口（518行）
   └── tabs/                # 标签页模块目录
       ├── __init__.py      # 模块初始化
       ├── tab_basic.py     # 基本烧录标签页
       ├── tab_advanced.py  # 高级功能标签页
       ├── tab_monitor.py   # 串口监视标签页
       └── tab_ports.py     # 端口管理标签页
   ```

3. **🔌 易于扩展** - 添加新标签页只需3步
   - 在tabs/目录创建新模块文件
   - 在__init__.py中导出类
   - 在flash_tool.py中实例化标签页

4. **🛡️ 防误用机制** - 保证正确启动方式
   - 单独运行标签页模块时显示友好错误提示
   - 强制从主入口启动，确保完整初始化

5. **📝 Git友好** - 完整的开发历史记录
   - 5次提交记录模块化过程
   - 每个阶段独立可回溯
   - 便于代码审查和问题定位

### 🎨 架构优势

| 对比项 | v1.0.6 | v1.0.8 | 改进 |
|-------|--------|--------|------|
| 代码行数 | 2753行 | 1765行 | -36% ⬇️ |
| 文件数量 | 1个 | 5个 | 模块化 ✅ |
| 主文件大小 | 2753行 | 518行 | -81% ⬇️ |
| 可维护性 | 低 | 高 | ⬆️⬆️⬆️ |
| 可扩展性 | 困难 | 容易 | ✅ |
| 代码复用 | 无 | 高 | ✅ |

---

## ✨ v1.0.6 功能（已保留）

### 🆕 v1.0.6 更新

1. **🎯 专注6844系列** - 移除设备切换功能
   - 工具专为AWRL6844设计和优化
   - 其他设备型号需使用独立工具
   - 简化界面，避免不必要的操作

2. **🖥️ 窗口可调整大小** - 支持自适应和最大化
   - 默认尺寸：900x820
   - 最小尺寸：900x820
   - 可以自由调整窗口大小
   - 支持最大化显示
   - 字体和布局自适应窗口大小

3. **⚡ 优化启动体验** - 移除启动时的验证弹窗
   - 固件验证结果只在日志中显示
   - 减少不必要的弹窗打扰
   - 验证失败信息清晰记录在日志
   - 保持界面简洁高效

---

## ✨ v1.0.5 功能（已保留）

1. **🔍 固件验证功能** - 自动检测固件是否匹配AWRL6844EVM
   - Meta Header Magic Number验证（0x5254534D）
   - 文件大小范围检查（SBL: 100-200KB, App: 150-1784KB）
   - 启动时自动验证固件
   - **验证失败时弹窗警告并说明原因**

2. **📊 增强的分析固件功能** - 深度解析.appimage结构
   - 识别Meta Header和Magic Number
   - 列出包含的核心镜像（R5F/C66x/RF）
   - **显示详细的匹配验证结果和原因**
   - 可滚动的报告窗口（700x600）
   - 包含基本信息、固件结构、设备匹配验证、结论和建议

3. **⚠️ 智能提示** - 固件不匹配时显示警告
   - 文件过大/过小提示
   - Magic Number不匹配提示
   - **弹窗提醒并建议处理措施**
   - 避免烧录错误固件

4. **📋 详细的验证报告** - 完整展示匹配原因
   - 文件类型识别（SBL/Application）
   - 文件大小验证结果
   - Meta Magic验证结果
   - 设备系列确认
   - 镜像数量和核心类型
   - **完整的匹配/不匹配原因说明**

### 验证报告示例

#### ✅ 匹配成功的报告
```
======================================================================
📊 固件结构分析报告
======================================================================

【基本信息】
  文件名: hello_world_system.release.appimage
  文件类型: Application
  文件大小: 223,456 bytes (218.2 KB)
  分析时间: 2025-12-15 14:30:25

【固件结构】
  ✅ 这是一个有效的.appimage固件文件
  Meta Header Magic: 0x5254534D
  预期Magic: 0x5254534D ("MSTR")
  镜像数量: 3

【包含的核心镜像】
  [0] R5F (APPSS)
      Magic Number: 0xA95316AD
  [1] C66x DSP (DSS)
      Magic Number: 0xD59246F1
  [2] RF (FECSS)
      Magic Number: 0xFECB36DE

【设备匹配验证】
  目标设备: AWRL6844 评估板 (xWRL684x)

  ✅ 验证结果: 匹配成功

【匹配详情】
  ✅ Application固件验证通过
     文件大小: 223,456 bytes (218.2 KB)
     Meta Magic: 0x5254534D (正确)
     设备系列: xWRL684x
     镜像数量: 3

【结论】
  ✅ 此固件可以安全烧录到 AWRL6844 评估板
======================================================================
```

#### ❌ 不匹配的报告
```
======================================================================
📊 固件结构分析报告
======================================================================

【基本信息】
  文件名: wrong_firmware.appimage
  文件大小: 2,048,000 bytes (2000.0 KB)

【固件结构】
  ✅ 这是一个有效的.appimage固件文件
  Meta Header Magic: 0x5254534D

【设备匹配验证】
  目标设备: AWRL6844 评估板 (xWRL684x)

  ❌ 验证结果: 不匹配

【失败原因】
  ❌ Application固件过大: 2,048,000 bytes (最大: 1,826,816 bytes)
  这可能不是xWRL684x系列的固件！

【建议】
  ⚠️ 此固件可能不适用于 AWRL6844 评估板
  ⚠️ 烧录可能导致设备无法启动
  ⚠️ 请确认固件来源和设备型号
======================================================================
```

### 验证机制说明

**固件匹配检查**：
- ✅ Meta Magic: 0x5254534D（"MSTR"标识）
- ✅ 文件大小范围合理
- ✅ 包含预期的核心镜像

**支持的Magic Numbers**（来自SDK sbl.h）：
| Magic | 值 | 含义 |
|-------|---|------|
| Meta Header | 0x5254534D | Meta Image起始标识 |
| R5F Core | 0xA95316AD | APPSS (ARM R5F) |
| C66x DSP | 0xD59246F1 | DSS (C66x DSP) |
| RF Core | 0xFECB36DE | FECSS (RF固件) |

---

## ✨ v1.0.4 功能列表

- ✅ **完整GUI界面** - 无需命令行，鼠标操作
- ✅ **旧进程检测** - 启动时自动检测并提示关闭旧窗口
- ✅ **固件文件选择** - SBL/App固件可手动选择路径
- ✅ **绝对路径显示** - 显示固件文件的完整路径
- ✅ **打开固件目录** - 一键打开项目固件目录
- ✅ **实时文件检测** - 启动时自动检查固件和工具
- ✅ **🆕 烧录前端口验证** - 自动验证端口，占用时自动释放
- ✅ **智能端口管理** - 自动扫描，手动选择，一键测试
- ✅ **智能端口管理** - 自动扫描，手动选择，一键测试
- ✅ **端口释放功能** - 强制释放被占用的COM端口
- ✅ **🆕 串口监视器** - 实时监控COM3/COM4数据流，支持暂停/恢复/Hex显示
- ✅ **🆕 预烧录检查** - 烧录前弹窗确认SOP设置、供电、USB、复位状态
- ✅ **可视化进度** - 进度条+任务名称+百分比
- ✅ **彩色日志系统** - 蓝(INFO)/绿(SUCCESS)/黄(WARN)/红(ERROR)
- ✅ **烧录后验证** - 自动测试COM3/COM4连接
- ✅ **超时保护** - 可自定义超时时间，防止死锁
- ✅ **错误自动退出** - 失败立即停止，保护Flash
- ✅ **版本标记** - 界面显示版本号 v1.0.2

---

## 🚀 快速开始

### 📥 安装依赖

```bash
# 切换到工具目录
cd 项目文档/3-固件烧录/01-AWRL6844_HelloWorld_完整烧录/5-Scripts

# 首次运行安装依赖
pip install -r requirements.txt
```

### 🎮 启动工具

```bash
# 确保在 5-Scripts 目录
cd 项目文档/3-固件烧录/01-AWRL6844_HelloWorld_完整烧录/5-Scripts

# 运行工具
python flash_tool.py
```

### 🎮 启动工具

**方法1：默认启动（AWRL6844EVM）**
```bash
python flash_tool.py
```

**方法2：指定设备型号**
```bash
# 启动时指定设备（未来功能）
python flash_tool.py --device AWRL6844EVM
python flash_tool.py --device AWRL6432EVM  # 未来支持
python flash_tool.py --device IWR6843EVM   # 未来支持
```

**方法3：双击运行**
- Windows: 直接双击 `flash_tool.py`

---

## 📱 使用流程

### 🎯 v1.0.8 标签页说明

工具采用标签页设计，功能分组清晰：

| 标签页 | 功能 | 说明 |
|--------|------|------|
| 📝 **基本烧录** | SBL+App完整烧录 | 最常用功能，一键完成烧录 |
| ⚙️ **高级功能** | SBL/App单独烧录 | 用于单独更新某个部分 |
| 📡 **串口监视** | COM3/COM4实时监控 | 查看设备输出，调试固件 |
| 🔌 **端口管理** | 端口扫描/测试/释放 | 解决端口占用问题 |

### 启动界面

启动后会看到：
- 🎯 **设备信息栏** - 显示当前设备型号、系列、SDK版本
- 🔄 **切换设备按钮** - 可选择其他设备型号（未来功能）
- 📂 **固件选择区** - 选择SBL和App固件文件
- 🔌 **端口管理区** - 扫描、选择、测试COM端口

1. **启动程序**
   - 运行 `flash_tool.py`
   - 如有旧窗口，会提示是否关闭
   - 界面自动检测固件文件和工具

2. **配置固件**（可选）
   - 点击"选择"按钮选择SBL/App固件
   - 固件下方显示完整绝对路径
   - 点击"📂 打开固件目录"快速访问固件文件夹

3. **配置端口**（可选）
   - 点击"🔄 刷新端口"扫描可用COM口
   - 在下拉框选择COM3（烧录）和COM4（调试）
   - 点击"测试COM3/COM4"验证连接
   - 如端口被占用，点击"🔓 释放端口"

4. **串口监控**（可选）
   - 点击"监控 COM3"或"监控 COM4"打开串口监视器
   - 实时查看串口数据流（自动滚动）
   - 支持暂停/恢复显示
   - 支持Hex/Text切换显示
   - 独立窗口，不影响烧录操作

5. **调整超时**（可选）
   - 默认: SBL=120s, App=180s, 完整=300s
   - 根据需要调整超时时间

6. **预烧录检查与烧录**
   - 点击烧录按钮后，**自动验证端口连接**
   - 如端口被占用，自动尝试释放并重试
   - 弹出检查清单对话框
   - **必须完成以下步骤并勾选**：
     1. ✅ SOP_MODE0跳线设置正确
     2. ✅ 板子已供电且USB已连接
     3. ✅ 板子已复位（SW1按钮）
     4. ✅ 确认以上步骤完成
   - 全部勾选后"开始烧录"按钮才可用
   - 点击"开始烧录"继续，或关闭取消

7. **选择烧录方式**
   - **🚀 完整烧录 (SBL+App)** - 推荐，一次完成
   - **🔧 仅烧录 SBL** - 单独更新Bootloader
   - **📱 仅烧录 App** - 单独更新应用程序

8. **查看进度**
   - 任务名称显示当前步骤
   - 进度条实时更新
   - 日志区域输出详细信息
   - 错误提示区域显示异常

9. **烧录后验证**
   - 完整烧录会自动测试COM3/COM4
   - 成功后弹窗提示
   - 日志显示完整执行记录
   - 可使用串口监视器测试固件通讯

---

## ⏱️ 超时设置

| 操作 | 超时时间 | 说明 |
|-----|---------|------|
| SBL烧录 | 120秒 | 单独烧录SBL |
| App烧录 | 180秒 | 单独烧录Application |
| 完整烧录 | 300秒 | SBL + App |

超时后程序自动终止进程并报错。

---

## 🎨 日志级别

程序使用不同颜色区分日志级别：

- 🔵 **[INFO]**: 蓝色 - 普通信息
- 🟢 **[SUCCESS]**: 绿色 - 操作成功
- 🟡 **[WARN]**: 黄色 - 警告信息
- 🔴 **[ERROR]**: 红色 - 错误信息

---

## 📊 Flash布局

```
地址范围         大小        内容                   文件
──────────────────────────────────────────────────────────
0x00000000      8KB         Reserved
0x00002000      ~130KB      SBL Bootloader      sbl.release.appimage
                (256KB预留)
0x00042000      ~500KB      Application         hello_world_system.release.appimage
                (1784KB最大)
```

---

## ⚠️ 错误处理

### 1. COM口打开失败
- 检查板子是否上电
- 检查USB连接
- 确认COM口未被占用

### 2. 固件文件不存在
- 确认固件已编译
- 检查文件路径是否正确
- 确认文件名是否匹配

### 3. 烧录超时
- 检查板子是否正常
- 尝试复位板子后重试
- 检查arprog工具是否正常

### 4. 烧录失败
- 查看详细错误信息
- 尝试单独烧录SBL和App
- 检查Flash是否损坏

---

## 🔍 常见问题

### Q1: 如何知道烧录成功？

**A**: 程序会显示 `[SUCCESS] 烧录完成！` 并列出写入的地址。

---

### Q2: 烧录后如何验证？

**A**: 
1. 复位板子（按RST按钮）
2. 使用工具自带的"监控 COM4"串口监视器
3. 查看启动日志和实时数据

---

### Q3: 串口监视器如何使用？

**A**:
1. 点击"监控 COM3"或"监控 COM4"按钮
2. 独立窗口打开，自动连接串口
3. 实时显示接收到的数据（自动滚动）
4. 可点击"⏸️ 暂停"停止更新
5. 可勾选"Hex显示"查看十六进制数据
6. 点击"🗑️ 清除"清空显示
7. 关闭窗口自动断开连接

---

### Q4: 预烧录检查有什么用？

**A**:
- 防止烧录前忘记设置SOP_MODE0跳线
- 确保供电和USB连接正常
- 提醒复位板子进入Flash模式
- 避免烧录失败浪费时间

---

### Q5: 工具找不到arprog？

**A**: 
- 检查 `../3-Tools/` 目录是否存在 `arprog_cmdline_6844.exe`
- 确保在 `5-Scripts/` 目录运行脚本
- 确认相对路径正确

---

### Q6: 可以只烧录应用吗？

**A**: 
- 首次烧录：必须先烧录SBL，再烧录应用
- 后续更新：可以选择 **📱 仅烧录App** 更新应用

---

### Q7: 如何释放被占用的端口？

**A**:
1. 点击"🔓 释放COM3"或"🔓 释放COM4"
2. 工具会终止占用端口的进程
3. 重新刷新端口列表
4. 注意：会强制关闭相关程序，请谨慎使用

---

### Q8: 🆕 能否读取板载固件信息？

**A**: ❌ **不支持**

**原因**：
- arprog工具只支持写入（-f）、擦除（-e）功能
- 不提供读取（read）、转储（dump）、验证（verify）参数
- TI官方工具链设计为单向烧录，不支持回读

**替代方案**：
1. 通过串口日志获取版本信息（有限）
2. 使用TI UniFlash图形工具（需额外安装）
3. 使用JTAG调试器读取内存（需硬件）

---

### Q9: 🆕 烧录前端口验证是什么？

**A**:
- v1.0.3新增功能
- 烧录前自动测试端口连接
- 如端口被占用，自动尝试释放
- 避免烧录过程中端口错误
- 无需手动操作，完全自动

---

## 🔧 高级用法：直接使用arprog

如果需要手动控制，可直接使用arprog命令：

```bash
cd 5-Scripts
../3-Tools/arprog_cmdline_6844.exe -cCOM3 -f0x00002000 -s300 -a../1-SBL_Bootloader/sbl.release.appimage -cf0x00000000
../3-Tools/arprog_cmdline_6844.exe -cCOM3 -f0x00042000 -s1784 -a../2-HelloWorld_App/hello_world_system.release.appimage -cf0x00040000
```

**说明**：
- `-cf` 参数会自动创建Flash Header
- 分两次烧录，一次SBL，一次App

---

## 📦 依赖文件

| 文件 | 说明 |
|------|------|
| `flash_tool.py` | GUI版本主程序⭐（v1.0.3 by Benson@Wisefido） |
| `requirements.txt` | Python依赖（pyserial, psutil） |
| `../3-Tools/arprog_cmdline_6844.exe` | 烧录工具 |
| `../1-SBL_Bootloader/sbl.release.appimage` | SBL固件（可选择） |
| `../2-HelloWorld_App/hello_world_system.release.appimage` | 应用固件（可选择） |

---

## 🎯 GUI界面布局（v1.0.2）

```
╔═══════════════════════════════════════════════════════════════╗
║           AWRL6844 固件烧录工具 v1.0.2                        ║
╠═══════════════╦═══════════════════════════════════════════════╣
║ 📁 固件文件    ║  📊 烧录进度                                  ║
║  ├─ SBL ✅    ║   当前任务: 正在烧录SBL...                    ║
║  │  └─路径显示 ║   ━━━━━━━━━━━━━━━━━━━━━━ 45%                ║
║  ├─ App ✅    ║                                               ║
║  │  └─路径显示 ║  📝 日志输出                                  ║
║  └─ 📂打开目录 ║   ┌─────────────────────────────────────────┐ ║
║               ║   │ [15:30:45] [INFO] 开始烧录...            │ ║
║ 🔌 端口设置    ║   │ [15:30:46] [SUCCESS] 烧录成功！          │ ║
║  ├─ COM3     ║   │ [15:30:47] [WARN] 端口测试...            │ ║
║  ├─ COM4     ║   │ [15:30:48] [ERROR] 连接失败              │ ║
║  ├─ 🔄刷新   ║   └─────────────────────────────────────────┘ ║
║  └─ 🔓释放   ║   └─ 🗑️ 清除日志                             ║
║               ║                                               ║
║ 📡 串口监视器  ║  ⚠️ 错误提示                                  ║
║  ├─ 监控COM3  ║   └─ [错误信息显示在这里]                     ║
║  └─ 监控COM4  ║                                               ║
║               ║                                               ║
║ ⏱️ 超时设置   ║                                               ║
║  ├─ SBL 120s ║                                               ║
║  ├─ App 180s ║                                               ║
║  └─ 完整300s  ║                                               ║
║               ║                                               ║
║ ⚡ 烧录操作   ║                                               ║
║  ├─ 🚀完整    ║ ← 点击后弹出"预烧录检查"对话框                ║
║  ├─ 🔧SBL     ║ ← 确认SOP/供电/USB/复位                       ║
║  ├─ 📱App     ║ ← 全部勾选后才能开始烧录                      ║
║  └─ ⏹️停止   ║                                               ║
║               ║                                               ║
║ 🔍 端口测试   ║                                               ║
║  ├─ 测试COM3  ║                                               ║
║  └─ 测试COM4  ║                                               ║
╚═══════════════╩═══════════════════════════════════════════════╝

┌─────────────────────────────────────────────────┐
│        📡 串口监视器 - COM3                      │
├─────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────┐ │
│ │ [15:45:12] Received: Hello World            │ │
│ │ [15:45:13] Received: Radar Init OK          │ │
│ │ [15:45:14] Received: Starting...            │ │
│ └─────────────────────────────────────────────┘ │
│  [⏸️ 暂停] [📋 复制] [🗑️ 清除] [Hex显示☐]      │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│           ✅ 预烧录检查清单                      │
├─────────────────────────────────────────────────┤
│  ☐ 1. SOP_MODE0跳线已正确设置                   │
│  ☐ 2. 板子已供电且USB已连接                     │
│  ☐ 3. 已按下SW1复位按钮                         │
│  ☐ 4. 确认以上步骤全部完成                      │
│                                                 │
│        [开始烧录] [取消]  ← 全部勾选后才可用     │
└─────────────────────────────────────────────────┘
```

## 🎉 版本历史

### v1.0.6 (2025-12-15) - 当前版本 ⭐
- ✅ 移除设备切换功能（专注AWRL6844系列）
- ✅ 窗口改为可调整大小，支持最大化
- ✅ 优化启动体验：移除验证弹窗，只在日志显示
- ✅ 改进界面布局和字体显示
- ✅ 简化操作流程，提升用户体验

### v1.0.5 (2025-12-15)
- ✅ 固件验证功能：自动检测固件是否匹配AWRL6844EVM
- ✅ Meta Header Magic Number验证（0x5254534D）
- ✅ 文件大小范围检查（SBL: 100-200KB, App: 150-1784KB）
- ✅ 验证失败时弹窗警告并说明详细原因
- ✅ 增强的"分析固件"功能：70字符宽格式化报告
- ✅ 显示完整的匹配验证结果和原因（7个章节）
- ✅ 可滚动的700x600报告窗口
- ✅ 多设备支持架构：预留AWRL6432、IWR6843支持

### v1.0.4 (2025-12-15)
- ✅ 启动时显示设备型号：AWRL6844EVM
- ✅ 添加设备选择器界面（3种设备）
- ✅ 命令行参数支持：--device AWRL6844EVM
- ✅ 多设备配置字典结构
- ✅ 为后续设备扩展做好架构准备

### v1.0.3 (2025-12-15)
- ✅ 添加作者信息：Benson@Wisefido
- ✅ 烧录前自动验证端口连接（失败自动释放重试）
- ✅ 调研板载固件读取功能（结论：arprog不支持）
- ✅ 优化端口管理逻辑

### v1.0.2 (2025-12-15)
- ✅ 新增固件绝对路径显示
- ✅ 新增预烧录检查清单对话框（SOP/供电/USB/复位确认）
- ✅ 新增独立串口监视器（COM3/COM4）
- ✅ 串口监视器支持暂停/恢复、Hex/Text显示
- ✅ 优化烧录前验证流程

### v1.0.1 (2025-12-15)
- ✅ 启动时检测并提示关闭旧窗口
- ✅ 固件文件支持手动选择
- ✅ 新增打开固件目录按钮
- ✅ 新增COM端口释放功能
- ✅ 合并命令行版本，统一为GUI版本
- ✅ 删除旧的命令行脚本
- ✅ 更新依赖：添加psutil

### v1.0.0 (2025-12-15)
- ✅ 发布GUI版本（flash_tool_gui.py）
- ✅ 完整图形界面，功能分区清晰
- ✅ 烧录后自动验证COM3/COM4端口
- ✅ 实时文件状态检测
- ✅ 可调节超时设置
- ✅ 独立端口测试功能
- ✅ 彩色日志+错误提示区域

### v0.9.0 (2025-12-15)
- ✅ 发布命令行版本（flash_tool.py）
- ✅ 交互式菜单界面
- ✅ 自动COM口扫描
- ✅ 超时保护机制
- ✅ 整合所有批处理脚本功能

---

**更新日期**: 2025-12-15  
**当前版本**: v1.0.5  
**SDK版本**: 06.01.00.01  
**变更记录**: 新增固件验证功能和多设备支持架构                                  ║
║ 🔌 端口设置    ║  📝 日志输出                                  ║
║  ├─ COM3     ║   ┌─────────────────────────────────────────┐ ║
║  ├─ COM4     ║   │ [15:30:45] [INFO] 开始烧录...            │ ║
║  └─ 🔄刷新   ║   │ [15:30:46] [SUCCESS] 烧录成功！          │ ║
║               ║   │ [15:30:47] [WARN] 端口测试...            │ ║
║ ⏱️ 超时设置   ║   │ [15:30:48] [ERROR] 连接失败              │ ║
║  ├─ SBL 120s ║   └─────────────────────────────────────────┘ ║
║  ├─ App 180s ║   └─ 🗑️ 清除日志                             ║
║  └─ 完整300s  ║                                               ║
║               ║  ⚠️ 错误提示                                  ║
║ ⚡ 烧录操作   ║   └─ [错误信息显示在这里]                     ║
║  ├─ 🚀完整    ║                                               ║
║  ├─ 🔧SBL     ║                                               ║
║  ├─ 📱App     ║                                               ║
║  └─ ⏹️停止   ║                                               ║
║               ║                                               ║
║ 🔍 端口测试   ║                                               ║
║  ├─ 测试COM3 ║                                               ║
║  └─ 测试COM4 ║                                               ║
╚═══════════════╩═══════════════════════════════════════════════╝
```

---

## 🛠️ 开发者指南（v1.0.8新增）

### 📂 项目结构

```
5-Scripts/
├── flash_tool.py              # 主入口（518行）
│   ├── FlashToolGUI类         # 主应用类
│   ├── 设备配置               # DEVICE_CONFIGS
│   ├── 固件验证函数           # verify_firmware_file
│   └── 对话框类               # PreFlashCheckDialog等
│
└── tabs/                      # 标签页模块目录
    ├── __init__.py            # 模块初始化和导出
    │   └── __all__ = [...]    # 导出所有标签页类
    │
    ├── tab_basic.py           # 基本烧录标签页（390行）
    │   └── BasicTab类
    │       ├── __init__()     # 初始化界面
    │       ├── create_ui()    # 创建UI组件
    │       ├── update_port_list()  # 更新端口列表
    │       └── log()          # 日志输出
    │
    ├── tab_advanced.py        # 高级功能标签页（280行）
    │   └── AdvancedTab类
    │       ├── SBL单独烧录
    │       ├── App单独烧录
    │       └── 超时设置
    │
    ├── tab_monitor.py         # 串口监视标签页（260行）
    │   └── MonitorTab类
    │       ├── COM3监视器
    │       └── COM4监视器
    │
    └── tab_ports.py           # 端口管理标签页（277行）
        └── PortsTab类
            ├── 端口扫描
            ├── 端口测试
            └── 端口释放
```

### 🔧 添加新标签页

**步骤1: 创建标签页模块**

在 `tabs/` 目录创建新文件，例如 `tab_custom.py`：

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
tab_custom.py - 自定义标签页
版本: v1.0.8
"""

import tkinter as tk
from tkinter import ttk

class CustomTab:
    """自定义标签页类"""
    
    def __init__(self, parent_frame, app):
        """
        初始化标签页
        
        Args:
            parent_frame: 父容器（tk.Frame）
            app: 主应用实例（FlashToolGUI）
        """
        self.frame = parent_frame
        self.app = app
        
        # 检查是否从主入口启动
        if not hasattr(app, 'VERSION'):
            self._show_error_and_exit()
        
        # 创建界面
        self.create_ui()
    
    def _show_error_and_exit(self):
        """显示错误并退出"""
        import sys
        print("⚠️ 错误：此模块不能单独运行！")
        print("请从主入口启动：python flash_tool.py")
        sys.exit(1)
    
    def create_ui(self):
        """创建UI组件"""
        # 创建你的界面组件
        label = ttk.Label(
            self.frame,
            text="这是自定义标签页",
            font=('Arial', 12)
        )
        label.pack(pady=20)

# 防止单独运行
if __name__ == "__main__":
    import sys
    print("=" * 70)
    print("⚠️  错误：tab_custom.py 不能单独运行！")
    print("=" * 70)
    print("\n请从主入口启动：python flash_tool.py\n")
    sys.exit(1)
```

**步骤2: 在 `__init__.py` 中导出**

编辑 `tabs/__init__.py`，添加导入：

```python
from .tab_custom import CustomTab

__all__ = [
    'BasicTab',
    'AdvancedTab', 
    'MonitorTab',
    'PortsTab',
    'CustomTab'  # 添加新标签页
]
```

**步骤3: 在主入口中使用**

编辑 `flash_tool.py`，在 `create_widgets()` 方法中添加：

```python
def create_widgets(self):
    # ... 现有代码 ...
    
    # 导入新标签页
    from tabs import CustomTab
    
    # 创建标签页Frame
    custom_frame = ttk.Frame(self.notebook)
    
    # 添加到Notebook
    self.notebook.add(custom_frame, text="  自定义  ")
    
    # 实例化标签页
    self.custom_tab = CustomTab(custom_frame, self)
```

### 🔍 调试技巧

1. **查看日志** - 在标签页中调用 `self.app.log(message)`
2. **访问主应用** - 通过 `self.app` 访问主应用的方法和属性
3. **端口操作** - 使用 `self.app.refresh_ports()` 等方法
4. **测试模块** - 直接运行会显示友好错误提示

### 📦 模块依赖关系

```
flash_tool.py (主入口)
    ├── 导入 → tabs/__init__.py
    │       ├── BasicTab
    │       ├── AdvancedTab
    │       ├── MonitorTab
    │       └── PortsTab
    │
    ├── 实例化 → self.basic_tab
    ├── 实例化 → self.advanced_tab
    ├── 实例化 → self.monitor_tab
    └── 实例化 → self.ports_tab
```

---

## 相关文档

- [../README.md](../README.md) - 项目概述
- [../操作指南.md](../操作指南.md) - 详细操作步骤
- [../3-Tools/README.md](../3-Tools/README.md) - 工具说明
- [../Flash布局说明.md](../Flash布局说明.md) - Flash内存布局

---

**更新日期**: 2025-12-15  
**当前版本**: v1.0.8  
**作者**: Benson@Wisefido  
**SDK版本**: 06.01.00.01  
**变更记录**: 🎉 模块化架构重构，代码精简36%，新增开发者指南

