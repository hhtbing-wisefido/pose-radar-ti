# 📖 AWRL6844 固件系统工具操作指南

> **基于TI官方SDK标准流程 - 简化版**

---

## 📋 目录

- [前置准备](#前置准备)
- [Phase 1: 检查文件与硬件](#phase-1-检查文件与硬件)
- [Phase 2: 烧录固件](#phase-2-烧录固件)
- [Phase 3: 验证运行](#phase-3-验证运行)
- [故障排查](#故障排查)

---

## 前置准备

### 硬件准备

- [x] **AWRL6844EVM开发板** × 1
- [x] **USB数据线** (Type-C或Micro-USB) × 1

### 软件准备

- [x] **串口调试工具** (TeraTerm / PuTTY / 串口助手)
- [x] **XDS110驱动** (TI官方USB驱动)
- [x] **本项目固件文件** (已包含可烧录的.appimage)

### 驱动安装

如果串口无法识别，需要安装XDS110驱动：

1. 驱动位置：`C:\ti\ccs1280\ccs\install_scripts\`
2. 运行：`install_drivers.bat`
3. 重启电脑

---

## Phase 1: 检查文件与硬件

### 1.1 检查固件文件

确认以下**预编译固件**存在：

```
01-AWRL6844固件系统工具/
├── 1-SBL_Bootloader/
│   └── sbl.release.appimage               ✅ SBL固件 (~130KB)
│
├── 2-HelloWorld_App/
│   └── hello_world_system.release.appimage ✅ App固件 (~200KB)
│
└── 3-Tools/
    └── arprog_cmdline_6844.exe            ✅ 烧录工具
```

> **重要说明**：`.appimage` 文件由TI SDK编译生成，包含完整的Meta Header和多核代码，**可直接烧录到Flash**，无需任何中间处理步骤。

### 1.2 查看固件信息（可选）

```powershell
# 检查SBL固件
Get-ChildItem "1-SBL_Bootloader\sbl.release.appimage" | Format-Table Name, Length

# 检查App固件
Get-ChildItem "2-HelloWorld_App\hello_world_system.release.appimage" | Format-Table Name, Length
```

**预期输出**：
- SBL: ~130KB (133000字节左右)
- App: ~200KB (204800字节左右)

---

### 1.3 硬件连接与识别

**USB连接**：
1. 使用USB数据线连接开发板到PC
2. 确保电源指示灯亮起
3. Windows自动识别XDS110设备

**识别COM端口**：

方法1 - 设备管理器：
1. Win+X → 设备管理器
2. 展开"端口(COM和LPT)"
3. 查找 `XDS110 Class Application/User UART (COM3)` ← **烧录用这个**
4. 另有 `XDS110 Class Auxiliary Data Port (COM4)` ← 调试日志用

方法2 - PowerShell命令：
```powershell
Get-WmiObject Win32_SerialPort | Select-Object DeviceID, Description
```

预期输出：
```
DeviceID  Description
--------  -----------
COM3      XDS110 Class Application/User UART    ← 烧录用
COM4      XDS110 Class Auxiliary Data Port      ← 日志用
```

---

## Phase 2: 烧录固件

### 2.1 设置烧录模式

**配置SOP开关为 SOP_MODE1 (烧录模式)**：

```
SOP0: OFF  (断开)
SOP1: OFF  (断开)
```

> **重要**：必须设置为此模式才能烧录Flash！

---

### 2.2 执行烧录

**使用Python交互式工具（推荐）⭐**

```powershell
# 进入脚本目录
cd "D:\7.项目资料\Ti雷达项目\项目文档\3-固件烧录\01-AWRL6844_HelloWorld_完整烧录\5-Scripts"

# 首次运行安装依赖
pip install -r requirements.txt

# 运行工具
python flash_tool.py

# 或直接双击 flash_tool.py
```

**工具特性**：
- ✅ 自动扫描COM口
- ✅ 交互式菜单操作
- ✅ 实时进度显示
- ✅ 超时自动检测（SBL:120s, App:180s）
- ✅ 彩色日志输出
- ✅ 错误自动退出

**烧录时间**: 约2-3分钟

---

**手动使用arprog命令**

```powershell
cd "D:\7.项目资料\Ti雷达项目\项目文档\3-固件烧录\01-AWRL6844固件系统工具\5-Scripts"

# 步骤1: 烧录SBL
.\3_flash_sbl.bat COM3

# 步骤2: 烧录Application
.\4_flash_app.bat COM3
```

---

**方法3：直接使用arprog工具（高级）**

```powershell
cd "D:\7.项目资料\Ti雷达项目\项目文档\3-固件烧录\01-AWRL6844固件系统工具\3-Tools"

# 一次性烧录SBL和App（推荐）
.\arprog_cmdline_6844.exe -p COM3 ^
  -f1 "..\1-SBL_Bootloader\sbl.release.appimage" ^
  -f2 "..\2-HelloWorld_App\hello_world_system.release.appimage" ^
  -s SFLASH -c -cf
```

**参数说明**：
- `-p COM3` - 指定串口
- `-f1` / `-f2` - 指定烧录文件（支持最多8个文件）
- `-s SFLASH` - 目标存储器（QSPI Flash）
- `-c` - 发送break信号初始化
- `-cf` - **自动创建Flash头**（工具自动计算地址）

---

### 2.3 烧录过程输出

**预期输出示例**：

```
SW version: 0.8
Connecting Com Port....
connect to device
INFO : Port Opened
set break signal
--- please restart the device ---
connection succeeded

downloading [0] size [80]
INFO : Port Opened
INFO: Send start download command
[========================================>] 100%

downloading [8192] size [133120]
INFO : Port Opened
INFO: Send start download command
[========================================>] 100%
↑ SBL烧录完成

downloading [270336] size [204800]
INFO : Port Opened
INFO: Send start download command
[========================================>] 100%
↑ Application烧录完成

Flash complete!
```

---

## Phase 3: 验证运行

### 3.1 切换到运行模式

**配置SOP开关为 SOP_MODE2 (运行模式)**：

```
SOP0: OFF  (断开)
SOP1: ON   (闭合) ← 改变这个
```

### 3.2 复位启动

**方法1**：按下开发板的RESET按钮

**方法2**：断电后重新上电

---

### 3.3 打开串口终端

**串口配置**：
- 端口: COM3 (或你识别的端口)
- 波特率: 115200
- 数据位: 8
- 停止位: 1
- 校验: 无

**推荐工具**：TeraTerm, PuTTY, 串口助手

---

### 3.4 查看输出

**预期串口输出**：

```
**********************************************
*        AWRL6844 Secondary Bootloader      *
**********************************************

[BOOTLOADER_PROFILE] Boot Media       : FLASH
[BOOTLOADER_PROFILE] Boot Image Size  : 204 KB
[BOOTLOADER_PROFILE] Cores present    :
r5fss0-0
c66ss0
[BOOTLOADER] Booting Cores ...
[BOOTLOADER] Jumping to application

**********************************************
*         Hello World Application           *
**********************************************

Hello World from r5fss0-0 !
Hello World from c66ss0 !

All tests have passed!!
```

### 3.5 成功标志

如果看到以下内容，说明烧录成功：
- ✅ "BOOTLOADER_PROFILE] Boot Media : FLASH" - SBL从Flash启动
- ✅ "Hello World from r5fss0-0 !" - R5F核心运行正常
- ✅ "Hello World from c66ss0 !" - DSP核心运行正常
- ✅ "All tests have passed!!" - 测试通过

---

## 故障排查

### 问题1: 找不到COM端口

**现象**: 设备管理器中没有XDS110设备

**解决方案**：
1. 检查USB连接是否牢固
2. 更换USB端口
3. 安装XDS110驱动：
   ```
   C:\ti\ccs1280\ccs\install_scripts\install_drivers.bat
   ```
4. 重启电脑

---

### 问题2: 烧录失败 "connect to device failed"

**现象**: arprog工具无法连接到设备

**解决方案**：
1. 确认SOP开关为SOP_MODE1 (SOP0=OFF, SOP1=OFF)
2. 按下RESET按钮
3. 关闭其他占用串口的程序（TeraTerm、PuTTY等）
4. 重新上电后再试
5. 尝试更换COM端口

---

### 问题3: 烧录成功但无输出

**现象**: 切换到SOP_MODE2后串口无输出

**解决方案**：
1. 确认SOP开关改为SOP_MODE2 (SOP0=OFF, SOP1=ON)
2. 确认串口终端配置：115200 8N1
3. 确认COM端口正确（烧录用COM3，可能调试输出在COM4）
4. 按RESET按钮重新启动
5. 重新烧录固件

---

### 问题4: 输出乱码

**现象**: 串口终端显示乱码

**解决方案**：
1. 检查波特率是否为115200
2. 检查数据位是否为8
3. 检查停止位是否为1
4. 检查校验是否为"无"
5. 尝试使用不同的串口工具

---

### 问题5: 烧录过程中断

**现象**: 烧录进行到一半失败

**解决方案**：
1. 检查USB连接是否稳定
2. 尝试使用更短、质量更好的USB线
3. 不要在烧录过程中触碰开发板
4. 确保供电稳定
5. 重新执行完整烧录流程

---

## 📚 参考资料

### 官方文档

- **EVM_SETUP_AND_FLASHING.html** - 硬件设置和烧录指南
- **BUILD_GUIDE.html** - 编译指南
- **EXAMPLES_DRIVERS_SBL.html** - SBL原理和启动流程

### Flash布局

| 地址 | 大小 | 内容 |
|------|------|------|
| 0x0000 - 0x1FFF | 8KB | Reserved |
| 0x2000 - 0x41FFF | 256KB | SBL (实际~130KB) |
| 0x42000 - 0x1FFFFF | 1784KB max | Application |

### 源码定义

来自 `sbl.h`：
```c
#define M_META_SBL_OFFSET       (uint32_t)(0x02000U)
#define M_META_IMAGE_OFFSET     ((uint32_t)M_META_SBL_OFFSET + (uint32_t)(0x40000U))
#define SBL_MAX_METAIMAGE_SIZE  (1784U * 1024U)
```

---

**文档版本**: V2.0 (基于官方SDK标准流程)  
**更新日期**: 2025-12-15  
**适用SDK**: MMWAVE_L_SDK_06_01_00_01

Device Info:
  Chip ID: AWRL6844
  Revision: 1.0
  Temperature: 45°C

System Status: OK
LED Blinking...
```

---

### 5.5 成功标志

✅ **烧录成功**的标志：

1. 串口输出完整启动信息
2. 看到"Hello World from AWRL6844!"
3. 板载LED开始闪烁
4. 无错误信息

---

## 故障排查

### 问题1: 串口无法连接

**症状**：
```
Error: Cannot open COM3
```

**解决方案**：
1. 检查USB线是否连接
2. 确认COM端口号正确
3. 关闭其他占用串口的程序（如TeraTerm）
4. 重新安装XDS110驱动

---

### 问题2: 设备无法识别

**症状**：
```
Error: Device not detected
```

**解决方案**：
1. **确认SOP开关设置为SOP_MODE1 (00)**（QSPI刷写模式）
2. 按下复位按钮重试
3. 重新插拔USB线
4. 检查开发板供电（电源指示灯）

---

### 问题3: 烧录失败

**症状**：
```
Error: Programming failed at 0x00002000
```

**解决方案**：
1. 执行全片擦除：
   ```bash
   arprog_cmdline_6844.exe -p COM3 -e
   ```
2. 重新烧录SBL
3. 检查Flash是否损坏

---

### 问题4: 串口无输出

**症状**：烧录成功，但串口无任何输出

**解决方案**：
1. **确认SOP开关切换为SOP_MODE2 (01)**（应用/功能模式）
2. 检查串口参数：115200 8N1
3. 按下复位按钮
4. 检查是否连接错误串口（应为Application UART）

---

### 问题5: SBL启动但应用无法加载

**症状**：
```
[SBL] Loading Application from Flash...
[ERROR] Invalid Meta Image Magic
```

**解决方案**：
1. 确认应用烧录地址正确（0x42000）
2. 检查.appimage文件完整性
3. 重新烧录应用
4. 检查arprog命令是否使用了`-c`参数（擦除后写入）

---

### 问题6: 运行一段时间后卡死

**症状**：启动正常，但运行后程序卡死

**解决方案**：
1. 检查电源是否稳定
2. 降低工作频率（修改配置）
3. 增加散热（风扇）
4. 检查RAM是否溢出

---

## 高级操作

### 读取Flash内容

```bash
# 读取SBL区域
arprog_cmdline_6844.exe -p COM3 -r 0x2000 -s 0x3E000 -o sbl_readback.bin

# 读取App区域（按SBL_MAX_METAIMAGE_SIZE）
arprog_cmdline_6844.exe -p COM3 -r 0x42000 -s 0x1BE000 -o app_readback.bin
```

### 全片擦除

```bash
# 擦除整个Flash（慎用！）
arprog_cmdline_6844.exe -p COM3 -e
```

### 验证烧录

```bash
# 烧录后自动验证
arprog_cmdline_6844.exe -p COM3 -f sbl.release.appimage -o 0x2000 -v
```

---

## 性能参考

| 操作 | 预计时间 | 说明 |
|------|---------|------|
| 检查固件文件 | ~5秒 | 验证文件存在 |
| 擦除Flash | ~30秒 | 按Sector擦除 |
| 烧录SBL | ~45秒 | ~130KB @ 115200 |
| 烧录App | ~60秒 | ~218KB @ 115200 |
| **总耗时** | **~2-3分钟** | 完整烧录流程 |

---

## 下一步

- [ ] 尝试更复杂的示例（mmWave Demo）
- [ ] 修改配置文件定制功能
- [ ] 学习OTA固件更新
- [ ] 开发自己的应用

---

## 相关文档

- [README.md](./README.md) - 项目概述
- [Flash布局说明.md](./Flash布局说明.md) - 内存布局
- [1-SBL_Bootloader/README.md](./1-SBL_Bootloader/README.md) - SBL详解
- [2-HelloWorld_App/README.md](./2-HelloWorld_App/README.md) - 应用详解

---

**文档版本**: 1.0  
**最后更新**: 2025-12-12  
**适用硬件**: AWRL6844EVM  
**SDK版本**: 06.01.00.01
