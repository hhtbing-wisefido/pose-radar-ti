# 📖 烧录操作使用指南

## 🎯 快速解答

### 1. 为什么看不到SBL和App单独烧录按钮？

**原因**：按钮确实存在，但在当前界面布局中被折叠或需要滚动才能看到。

**位置**：在左侧"⚡ 烧录操作"区域：
- 🚀 完整烧录 (SBL+App)  ← 最上面，默认可见
- 🔧 仅烧录 SBL  ← 下方
- 📱 仅烧录 App  ← 下方
- ⏹️ 停止烧录  ← 最下方

**临时解决方案**：
1. 调整窗口大小（向下拉伸）
2. 使用v1.0.7版本（标签页布局）

---

## 🤔 何时只烧录App而不烧录SBL？

### 判断标准

#### ✅ 只需烧录App的情况：
1. **板子已有SBL**
   - 之前烧录过完整固件
   - SBL工作正常
   - COM3/COM4端口可以连接

2. **只修改了应用代码**
   - 修改了hello_world等应用
   - SBL代码未改动
   - 只想更新应用功能

3. **快速迭代开发**
   - 频繁修改应用代码
   - 测试新功能
   - 节省烧录时间（App烧录更快）

#### ⚠️ 必须完整烧录的情况：
1. **首次烧录**
   - 新板子
   - 从未烧录过固件
   - Flash为空

2. **SBL损坏**
   - 板子无法启动
   - COM口无法连接
   - 需要恢复引导程序

3. **更新SBL**
   - SDK升级
   - SBL有bug修复
   - 需要新的SBL功能

### 简单判断方法

**测试连接**：
1. 点击"🔍 端口管理" → "测试COM3"
2. 如果能连接 → 说明SBL存在，可以只烧录App
3. 如果无法连接 → 需要完整烧录

**查看日志**：
启动时日志会显示板载固件信息（如果有）

---

## 📍 烧录地址（Offset）说明

### 是自动的吗？

**✅ 完全自动！**

### Flash布局（AWRL6844）

```
Flash地址范围: 0x00000 - 0x2FFFFF (3MB)

┌─────────────────────────────────┐
│ 0x00000 - 0x01FFF               │
│ Vector Table (8KB)              │  保留区域
├─────────────────────────────────┤
│ 0x02000 - 0x41FFF               │  ← SBL自动烧录到这里
│ SBL Bootloader                  │
│ 大小: ~130KB (实际100-200KB)     │
├─────────────────────────────────┤
│ 0x42000 - 0x2FFFFF              │  ← App自动烧录到这里
│ Application                     │
│ 大小: ~220KB (实际150-1784KB)    │
└─────────────────────────────────┘
```

### 自动处理机制

**设备配置**（flash_tool.py代码中）：
```python
DEVICE_CONFIGS = {
    "AWRL6844EVM": {
        "sbl_offset": 0x2000,   # SBL固定地址
        "app_offset": 0x42000,  # App固定地址
        ...
    }
}
```

**烧录时**：
- 工具自动读取配置
- 调用arprog时自动传入正确地址
- 用户无需关心offset值

**命令示例**：
```bash
# SBL烧录
arprog -p COM3 -f sbl.release.appimage -a 0x2000

# App烧录
arprog -p COM3 -f hello_world.release.appimage -a 0x42000
```

### 为什么地址是固定的？

1. **硬件限制**：
   - 芯片ROM Bootloader查找SBL的地址是固定的（0x2000）
   - 这是TI芯片的硬件设计

2. **SBL限制**：
   - SBL启动后会查找App的地址（0x42000）
   - 这在SBL编译时就确定了

3. **安全性**：
   - 固定地址避免错误
   - 防止覆盖重要区域

---

## 💡 烧录决策流程图

```
                开始烧录
                    ↓
            板子是新的吗？
          ┌─────┴─────┐
         是           否
          ↓            ↓
    完整烧录      COM3能连接吗？
                  ┌─────┴─────┐
                 是           否
                  ↓            ↓
           只改了App吗？    完整烧录
          ┌─────┴─────┐    (SBL损坏)
         是           否
          ↓            ↓
     只烧录App      完整烧录
    （推荐，快）    （最安全）
```

---

## 🚀 操作示例

### 场景1：首次使用新板子
```
步骤：
1. 连接板子USB
2. 设置SOP引脚（烧录模式）
3. 选择COM3和COM4
4. 点击"🚀 完整烧录 (SBL+App)"
5. 等待完成（约300秒）
```

### 场景2：修改了应用代码
```
步骤：
1. 编译新的App固件
2. 替换hello_world_system.release.appimage
3. 点击"🔄 刷新"按钮
4. 点击"📱 仅烧录 App"
5. 等待完成（约180秒）

优势：
- 时间更短（不烧SBL）
- 风险更小（不影响引导）
```

### 场景3：板子无法启动
```
问题：
- COM口无法连接
- 应用无反应
- 可能SBL损坏

步骤：
1. 点击"测试COM3"
2. 如果失败 → 执行完整烧录
3. 如果成功但App有问题 → 只烧录App
```

---

## 📊 烧录时间对比

| 操作类型 | 时间 | 适用场景 |
|---------|------|---------|
| 完整烧录 (SBL+App) | ~300秒 | 首次烧录、SBL损坏 |
| 仅烧录SBL | ~120秒 | SBL升级、SBL损坏 |
| 仅烧录App | ~180秒 | 应用更新（推荐） |

**开发建议**：
- 第一次：完整烧录
- 后续开发：只烧App
- 每10次开发后：完整烧录一次（确保一致性）

---

## ⚠️ 常见错误

### 错误1：只烧App但COM口连不上
**原因**：板子没有SBL  
**解决**：执行完整烧录

### 错误2：完整烧录后App无法运行
**原因**：
- App固件不匹配
- SBL版本不对

**解决**：
1. 确认SBL和App来自同一SDK
2. 重新完整烧录
3. 查看日志错误信息

### 错误3：烧录后板子没反应
**原因**：
- SOP引脚未恢复
- 未按复位键

**解决**：
1. 检查SOP引脚（功能模式）
2. 按复位键
3. 查看COM4调试输出

---

## 🎯 最佳实践

### 开发阶段
1. ✅ 第一次：完整烧录
2. ✅ 修改代码：只烧App
3. ✅ 快速测试：只烧App
4. ✅ 发布版本：完整烧录

### 生产阶段
1. ✅ 统一使用完整烧录
2. ✅ 验证SBL和App版本
3. ✅ 记录烧录日志
4. ✅ 测试设备功能

---

**总结**：
- 地址是自动的，无需手动设置 ✅
- 测试COM3判断是否需要烧SBL ✅
- 开发时推荐只烧App，节省时间 ✅
- v1.0.7将提供更清晰的界面布局 ✅
