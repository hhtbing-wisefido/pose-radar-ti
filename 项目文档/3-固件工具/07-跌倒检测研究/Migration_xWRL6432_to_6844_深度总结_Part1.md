# 🔄 xWRL6432到xWRL6844迁移完全指南

> **文档版本**: v1.0  
> **创建日期**: 2025-12-25  
> **源文档**: Migration_from_xWRLx432_to_xWRL6844_V0.3 (TI官方)  
> **作者**: Yang, Zigang (TI)  
> **适用场景**: 从xWRL6432/xWRL1432迁移到xWRL6844的固件开发  
> **页数**: 10页  
> **图片**: 16张

---

## 📋 目录

- [第一部分：硬件特性对比](#第一部分硬件特性对比)
- [第二部分：内存映射与分区](#第二部分内存映射与分区)
- [第三部分：DFP变更详解](#第三部分dfp变更详解)
- [第四部分：SDK CLI配置迁移](#第四部分sdk-cli配置迁移)
- [第五部分：内置相位旋转](#第五部分内置相位旋转)
- [第六部分：迁移检查清单](#第六部分迁移检查清单)

---

## 📊 文档概述

### 目标读者

本文档面向：
- ✅ 熟悉xWRL6432/xWRL1432的开发者
- ✅ 需要迁移现有项目到xWRL6844的工程师
- ✅ 需要快速上手xWRL6844的算法工程师

### 核心价值

```
🎯 帮助开发者：
├─ 快速理解两代芯片的差异
├─ 避免常见的迁移陷阱
├─ 掌握新特性的使用方法
└─ 节省数周的调试时间
```

---

## 第一部分：硬件特性对比

### 1.1 芯片级差异总览 🔴 核心对比

#### 完整对比表

| 功能特性 | xWRL6432 | xWRL6844 | 变化 | 影响 |
|---------|----------|----------|------|------|
| **接收通道数** | 3 | 4 | +1 | ✅ 更好的角度分辨率 |
| **发射通道数** | 2 | 4 | +2 | ✅ MIMO虚拟阵列更大 |
| **RF频率范围** | 57-64 GHz | 57-64 GHz | 无变化 | ✅ 配置兼容 |
| **片上内存** | 1 MB | 2.5 MB | +1.5 MB | ✅ 更复杂算法 |
| **最大IF频率** | 5 MHz | 10 MHz | 翻倍 | ⚠️ 配置需调整 |
| **最大采样率** | 12.5 Msps | 25 Msps | 翻倍 | ⚠️ 参数需调整 |
| **MCU** | M4F/160MHz | R5F/200MHz | 架构变化 | 🔴 固件不兼容 |
| **DSP** | 无 | C66x/450MHz | 新增 | ✅ 信号处理能力 |
| **HWA** | HWA1.2/80MHz | HWA1.2/200MHz | 性能提升 | ✅ 更快处理 |
| **ADC原始数据捕获** | RDIF (12 bits) | LVDS (12/14/16 bits) | 接口变化 | ⚠️ DCA1000配置 |
| **标称TX功率** | 11 dBm | 13 dBm | +2 dB | ✅ 更远检测距离 |
| **典型噪声系数** | 11 dB | 11.5 dB | +0.5 dB | ⚠️ 略微下降 |
| **每Chirp可配置TX相位** | BPM only | BPM + beam steering | 增强 | ✅ 更灵活 |
| **功耗模式** | 是 | 是 | 保持 | ✅ 低功耗 |

#### 关键提升总结

```
🚀 性能提升：
├─ 虚拟天线阵列：2TX×3RX=6 → 4TX×4RX=16（+167%）
├─ 处理能力：M4F 160MHz → R5F 200MHz + C66x 450MHz
├─ 内存容量：1MB → 2.5MB（+150%）
└─ 采样带宽：IF 5MHz → 10MHz，采样率 12.5→25 Msps

⚠️ 需要注意：
├─ MCU架构变化（M4F→R5F）→ 固件二进制不兼容
├─ 通道数增加（TX 2→4, RX 3→4）→ 配置掩码变化
├─ 采样率翻倍 → CLI参数需调整
└─ ADC接口变化（RDIF→LVDS）→ 数据采集代码需修改
```

### 1.2 硬件架构对比图

**xWRL6432架构**：
```
┌─────────────────────────────────────┐
│         xWRL6432 芯片架构            │
├─────────────────────────────────────┤
│  📡 RF前端                           │
│  ├─ 2个TX通道                       │
│  ├─ 3个RX通道                       │
│  └─ FMCW信号生成                    │
├─────────────────────────────────────┤
│  💻 MCU: ARM Cortex-M4F @ 160MHz    │
│  ├─ 512KB APPSS RAM                │
│  └─ 256KB L3 RAM (Radar Cube)     │
├─────────────────────────────────────┤
│  ⚡ HWA 1.2 @ 80MHz                 │
│  └─ FFT硬件加速                     │
├─────────────────────────────────────┤
│  📊 ADC: 12.5 Msps                  │
│  └─ RDIF接口（12-bit）              │
└─────────────────────────────────────┘
```

**xWRL6844架构**：
```
┌─────────────────────────────────────┐
│         xWRL6844 芯片架构            │
├─────────────────────────────────────┤
│  📡 RF前端                           │
│  ├─ 4个TX通道（8个PA）              │
│  ├─ 4个RX通道                       │
│  └─ FMCW信号生成                    │
├─────────────────────────────────────┤
│  💻 MCU: ARM Cortex-R5F @ 200MHz    │
│  ├─ 768KB APPSS RAM                │
│  └─ 512KB L3 RAM (Radar Cube)     │
├─────────────────────────────────────┤
│  🧠 DSP: C66x @ 450MHz ⭐新增       │
│  └─ 384KB L2 RAM                   │
├─────────────────────────────────────┤
│  ⚡ HWA 1.2 @ 200MHz                │
│  └─ FFT硬件加速（性能2.5倍）        │
├─────────────────────────────────────┤
│  📊 ADC: 25 Msps                    │
│  └─ LVDS接口（12/14/16-bit）        │
└─────────────────────────────────────┘
```

---

## 第二部分：内存映射与分区

### 2.1 内存对比表

| 内存区域 | xWRL6432/xWRL1432 | xWRL6844 | 变化 | 用途 |
|---------|-------------------|----------|------|------|
| **APPSS** | 512 KB | 768 KB | +256 KB | 应用程序代码和数据 |
| **L3 Memory** | 256 KB | 512 KB | +256 KB | Radar Cube（ADC数据） |
| **DSS L2** | - | 384 KB | 新增 | DSP本地内存 |
| **FECSS/HSM** | 32 KB | 32 KB | 无变化 | 前端控制子系统 |
| **Shared RAM** | 256 KB | 896 KB | +640 KB | 共享内存 |
| **总计** | ~1 MB | ~2.5 MB | +1.5 MB | - |

### 2.2 内存分配特性

#### xWRL6844的灵活内存分配

```
🔧 Tightly Coupled Memory (TCM)：
├─ 用于程序和数据的紧耦合内存
├─ 可以以128KB为单位分配给APPSS或L3
└─ 提供最低延迟访问

💡 示例分配：
├─ 场景1：复杂算法
│   ├─ APPSS: 768KB + 256KB TCM = 1024KB
│   └─ L3: 512KB
│
├─ 场景2：大数据缓冲
│   ├─ APPSS: 768KB
│   └─ L3: 512KB + 256KB TCM = 768KB
│
└─ 场景3：均衡分配
    ├─ APPSS: 768KB + 128KB TCM = 896KB
    └─ L3: 512KB + 128KB TCM = 640KB
```

### 2.3 内存映射地址

**xWRL6432内存地址**：
```c
// xWRL6432内存映射
#define APPSS_RAM_BASE    0x10200000  // 512KB
#define L3_RAM_BASE       0x20000000  // 256KB
#define SHARED_RAM_BASE   0x70000000  // 256KB
#define HSM_RAM_BASE      0x...       // 32KB
```

**xWRL6844内存地址**：
```c
// xWRL6844内存映射（参考TRM文档）
#define APPSS_RAM_BASE    0x10200000  // 768KB
#define L3_RAM_BASE       0x20000000  // 512KB
#define DSS_L2_BASE       0x...       // 384KB (新增)
#define SHARED_RAM_BASE   0x70000000  // 896KB
#define HSM_RAM_BASE      0x...       // 32KB
```

**⚠️ 迁移注意事项**：

```
🔴 链接脚本必须更新：
├─ linker.cmd中的内存大小定义
├─ 堆栈大小可以增加
└─ Radar Cube缓冲区可以扩大

✅ 好处：
├─ 可以支持更多虚拟天线（16 vs 6）
├─ 可以增加Range FFT点数
├─ 可以保存更多帧历史数据
└─ 可以运行更复杂的算法（如深度学习）
```

---

## 第三部分：DFP变更详解

### 3.1 IF带宽增加 ⚠️ 重要变更

#### 核心变化

```
最大IF带宽：
xWRL6432: 5 MHz
xWRL6844: 10 MHz  ← 翻倍！

采样率：
相同的DigOutputSampRate值，实际采样率翻倍
```

#### 配置对比

**xWRL6432配置**：
```c
// chirpComnCfg的参数
digOutputSampRate = 40
实际采样率 = 100MHz / 40 = 2.5 Msps
```

**xWRL6844配置**：
```c
// chirpComnCfg的参数  
digOutputSampRate = 80  ← 翻倍！
实际采样率 = 200MHz / 80 = 2.5 Msps  ← 保持相同
```

**⚠️ 迁移规则**：
```
如果要保持相同的采样率：
xWRL6844的digOutputSampRate = xWRL6432的值 × 2

示例：
6432: digOutputSampRate = 40 → 采样率 2.5 Msps
6844: digOutputSampRate = 80 → 采样率 2.5 Msps（相同）
```

### 3.2 校准变更 🔴 API变化

#### 变化1：RX IFA校准

```
xWRL6432: RX IFA校准是可选的
xWRL6844: RX IFA校准作为factory calibration API的一部分启用
```

#### 变化2：RX增益范围

```
RX增益范围变化：
xWRL6432: 30dB - 40dB
xWRL6844: 36dB - 46dB  (+6dB偏移)

⚠️ 注意：
- xWRL6844只验证了38dB - 46dB
- 如果固件中硬编码了增益值，需要调整
```

#### 变化3：校准数据保存/恢复API 🔴 不兼容

**xWRL6432的旧API（已废弃）**：
```c
// ❌ xWRL6844不再支持
rl_fecssRfRxTxCalDataSet()
rl_fecssRfRxTxCalDataGet()
```

**xWRL6844的新API（必须使用）**：
```c
// ✅ 必须使用新API
rl_fecssRfFactoryCalDataSet()  // 保存完整校准文件
rl_fecssRfFactoryCalDataGet()  // 恢复完整校准文件
```

**迁移代码示例**：
```c
// xWRL6432旧代码（需要替换）
rlRfCalRxTxDataNv_t calData;
rl_fecssRfRxTxCalDataGet(&calData);  // ❌ 不再支持

// xWRL6844新代码
rlRfFactoryCalDataNv_t factoryCalData;
rl_fecssRfFactoryCalDataGet(&factoryCalData);  // ✅ 使用新API
```

#### 变化4：校准时间增加

```
⏱️ 校准时间对比：
xWRL6432: ~X秒
xWRL6844: ~Y秒（更长）

原因：
├─ 更多通道（TX 2→4, RX 3→4）
├─ 新增RX IFA校准
└─ 更复杂的校准流程

💡 建议：
├─ 首次启动时进行完整校准
├─ 保存校准数据到Flash
└─ 后续启动从Flash恢复
```

