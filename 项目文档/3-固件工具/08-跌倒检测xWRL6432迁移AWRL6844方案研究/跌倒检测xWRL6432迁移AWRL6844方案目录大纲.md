# 跌倒检测xWRL6432迁移AWRL6844方案目录大纲

> **创建日期**: 2025-12-25
> **迁移目标**: xWRL6432 → AWRL6844
> **应用场景**: 跌倒检测算法移植

---

## 一、项目背景与目标

### 1.1 迁移背景

- 源平台：xWRL6432 (2TX3RX, M4F MCU)
- 目标平台：AWRL6844 (4TX4RX, R5F MCU)
- 应用：Pose & Fall Detection

### 1.2 迁移目标

- 保持跌倒检测算法功能一致
- 利用6844硬件优势提升性能
- 完成固件、配置、算法全面适配

### 1.3 关键挑战

- 芯片架构差异（MCU、天线、采样率）
- 必须新增相位校正
- ADC数据格式变化

---

## 二、芯片对比分析

### 2.1 硬件架构对比

```
项目对比：
├── MCU架构：M4F/160MHz → R5F/200MHz
├── 天线配置：2TX3RX → 4TX4RX
├── 内存容量：1MB → 2.5MB
└── 采样率：12.5Msps → 25Msps
```

### 2.2 关键差异汇总

- 10项必须修改的技术要点
- 通道配置格式变化
- 校准API更新
- 新增相位校正需求

---

## 三、迁移方案框架

### 3.1 阶段一：准备工作

```
1. 开发环境搭建
   ├── MMWAVE_L_SDK 06.01.00.01
   ├── Code Composer Studio 12.x
   └── radar_toolbox 3.30.00.06

2. 硬件准备
   ├── AWRL6844-EVM开发板
   ├── 串口连接验证
   └── COM端口配置

3. 源代码整理
   ├── xWRL6432源码分析
   ├── 识别需修改模块
   └── 创建迁移工作目录
```

### 3.2 阶段二：固件代码迁移

```
1. 创建6844工程
   ├── 从SDK示例创建
   └── 或复制6432项目修改

2. MCU架构适配
   ├── R5F启动代码替换
   ├── 系统初始化修改
   └── 编译器选项调整

3. 内存映射调整
   ├── linker.cmd修改
   ├── APPSS_RAM扩展（512KB→768KB）
   └── L3_RAM扩展（256KB→512KB）

4. 驱动层适配
   ├── UART驱动检查
   ├── EDMA配置调整
   ├── GPIO引脚映射
   └── HWA接口验证

5. 编译调试
   ├── MSS核心编译
   ├── DSS核心编译
   └── 链接错误解决
```

### 3.3 阶段三：硬件配置迁移

```
1. 通道配置修改
   ├── CLI命令：channelCfg 7 3 0 → 15 15 0
   ├── mmw_cli.c代码修改
   └── 底层API：RX掩码0x07→0x99, TX掩码0x03→0xFF

2. 采样率参数调整
   ├── chirpComnCfg参数翻倍
   └── digOutputSampRate: 40 → 80

3. 校准API替换
   ├── 删除旧API：rl_fecssRfRxTxCalDataGet/Set()
   └── 使用新API：rl_fecssRfFactoryCalDataGet/Set()

4. 配置文件生成
   ├── 修改.cfg文件
   └── 验证所有参数

5. 固件烧录验证
   ├── 生成.appimage
   ├── 使用arprog_cmdline_6844烧录
   └── 串口测试（115200）
```

### 3.4 阶段四：算法层迁移

```
1. 相位校正实现（必须）
   ├── 定义16元素校正向量
   ├── 实现校正函数
   └── 插入Range FFT后

2. ADC数据格式适配
   ├── 6432格式：IQ交织
   ├── 6844格式：I/Q分开
   └── 修改读取代码

3. 点云处理调整
   ├── 虚拟天线：6 → 16
   ├── 宏定义修改
   └── AoA算法适配

4. 特征提取适配
   ├── 检查天线数量依赖
   └── 22维特征向量验证

5. CNN模型集成
   ├── 复制pose_model.a
   ├── 链接脚本配置
   └── 推理代码验证
```

### 3.5 阶段五：验证与优化

```
1. 基础功能测试
   ├── 固件启动验证
   ├── CLI命令响应
   ├── 雷达工作状态
   └── 点云数据输出

2. 姿态分类验证
   ├── 站立、坐、躺、走、跌倒
   ├── 分类准确率测试
   └── 置信度分析

3. 跌倒检测测试
   ├── 多方向跌倒测试
   ├── 检测率统计（目标>95%）
   └── 误报率控制

4. 性能优化
   ├── CFAR参数调整
   ├── 特征提取优化
   └── 时间滤波

5. 边界场景测试
   ├── 距离边界（0.4m-6m）
   ├── 多人场景
   └── 遮挡场景
```

---

## 四、关键技术要点

### 4.1 必须修改配置对比表

```
配置项          | xWRL6432      | AWRL6844         | 修改位置
----------------|---------------|------------------|------------------
channelCfg      | 7 3 0         | 15 15 0          | .cfg文件
chirpComnCfg    | 40 ...        | 80 ...           | .cfg文件
RX掩码(底层)    | 0x07          | 0x99             | mmw_cli.c
TX掩码(底层)    | 0x03          | 0xFF             | mmw_cli.c
校准API         | 旧API         | Factory Cal API  | mmw_mss_main.c
相位校正        | 无            | 16元素向量       | rangeproc.c
ADC格式         | IQ交织        | I/Q分开          | adcdata.c
虚拟天线数      | 6             | 16               | mmw.h
```

### 4.2 核心代码片段

```
1. 相位校正向量
   int8_t phaseCorr[16] = {1,1,1,1,-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1};

2. 通道配置
   channelCfg 15 15 0

3. 采样率翻倍
   chirpComnCfg 80 0 0 256 1 23 0

4. 校准API
   rl_fecssRfFactoryCalDataGet/Set(deviceMap, &factoryCalData);
```

---

## 五、文件修改清单

### 5.1 固件代码文件

```
├── mss/
│   ├── startup_r5f.c (替换)
│   ├── system_r5f.c (替换)
│   ├── linker.cmd (修改内存映射)
│   ├── mmw_cli.c (通道配置修改)
│   └── mmw_mss_main.c (校准API替换)
│
├── dss/
│   ├── linker.cmd (修改内存映射)
│   └── datapath/
│       ├── rangeproc.c (新增相位校正)
│       └── adcdata.c (ADC格式适配)
│
└── common/
    └── mmw.h (宏定义修改)
```

### 5.2 配置文件

```
└── fall_detection_6844.cfg
    ├── channelCfg 15 15 0
    ├── chirpComnCfg 80 ...
    └── (其他参数保持)
```

---

## 六、项目资源

### 6.1 参考文档

```
├── SDK研究文档
│   └── 项目文档/3-固件工具/06-SDK固件研究/
│
├── 迁移指南
│   └── 项目文档/3-固件工具/07-跌倒检测研究/
│       └── Migration_from_xWRLx432_to_xWRL6844.md
│
└── 源代码
    └── 知识库/Pose_And_Fall_Detection/src/xWRL6432/
```

### 6.2 开发工具

```
├── MMWAVE_L_SDK 06.01.00.01
├── Code Composer Studio 12.x
├── radar_toolbox 3.30.00.06
└── arprog_cmdline_6844.exe (SDK自带烧录工具，实测可用)
```

---

## 七、交付物清单

### 7.1 代码类

```
├── fall_detection_6844_mss.out (MSS固件)
├── fall_detection_6844_dss.out (DSS固件)
├── fall_detection_6844.appimage (烧录镜像)
└── 源代码目录
```

### 7.2 文档类

```
├── 迁移实施记录
├── 测试验证报告
├── 配置参数说明
└── 已知问题与解决方案
```

---

> 📌 **文档类型**: 方案目录大纲
> 📅 **最后更新**: 2025-12-25
> ✅ **状态**: 框架完成，待实施
