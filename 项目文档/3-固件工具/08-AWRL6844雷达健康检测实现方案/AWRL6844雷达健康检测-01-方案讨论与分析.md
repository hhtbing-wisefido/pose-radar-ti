# 📋 AWRL6844雷达健康检测-01-方案讨论与分析

> **目标**: 分析AWRL6844实现雷达健康检测的可选方案
> **创建日期**: 2026-01-05
> **状态**: ✅ 已完成（理论分析）
>
> ⚠️ **实战更新（2026-01-07）**：理论分析正确，但方案A在实战中遇到技术障碍。
> 详见：[1.6 实战验证结果](#16-实战验证结果2026-01-07) 和 [02-方案确认](./AWRL6844雷达健康检测-02-方案确认.md)

---

## 1.1 项目目标

### 1.1.1 功能需求

基于评估报告，AWRL6844雷达健康检测模块需实现：

| 功能               | 描述                            | 优先级  |
| ------------------ | ------------------------------- | ------- |
| **人存检测** | 检测监测区域是否有人            | P0 必需 |
| **姿态检测** | 识别5类姿态（站/坐/躺/走/跌倒） | P0 必需 |
| **跌倒检测** | 实时检测跌倒事件并触发告警      | P0 必需 |

### 1.1.2 性能指标

| 指标           | 目标值    |
| -------------- | --------- |
| 人存检测率     | ≥98%     |
| 姿态分类准确率 | ≥90%     |
| 跌倒检测率     | ≥95%     |
| 跌倒误报率     | <5%       |
| 响应时间       | <500ms    |
| 检测距离       | 0.5m - 6m |

### 1.1.3 硬件平台

| 项目   | 规格                  |
| ------ | --------------------- |
| 芯片   | AWRL6844              |
| 天线   | 4TX 4RX（16虚拟天线） |
| 开发板 | AWRL6844-EVM          |
| 频段   | 60GHz                 |

---

## 1.2 可选实现方案

经过分析，有 **3种可行方案**：

---

### 方案A：基于 InCabin Demo 扩展 ⚠️ 理论最优，但有产品化障碍

```
┌─────────────────────────────────────────────────────────────────┐
│  方案A：基于 AWRL6844_InCabin_Demos 扩展                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  基础工程: AWRL6844_InCabin_Demos (Radar Toolbox)               │
│                                                                 │
│  已有功能（直接可用）:                                           │
│  ├── ✅ 人存检测 (occupancyClassifier)                          │
│  ├── ✅ CNN分类器 (cnn_classifier.lib)                          │
│  ├── ✅ 入侵检测 (intrusionDetection)                           │
│  ├── ✅ Capon 2D波束成形 (高精度AoA)                             │
│  ├── ✅ 完整点云处理链                                           │
│  └── ✅ 预编译固件 (1MB appimage)                                │
│                                                                 │
│  需要添加:                                                       │
│  ├── 🔧 姿态分类逻辑 (参考xWRL6432 pose.c)                       │
│  ├── 🔧 跌倒检测判断 (状态机)                                    │
│  ├── 🔧 特征提取适配 (22维特征向量)                              │
│  └── 🔧 TLV输出格式                                             │
│                                                                 │
│  ⚠️ 致命问题：产品化不可行                                      │
│  ├── 🚫 Capon算法依赖天线相位校准                                │
│  ├── 🚫 校准需要DCA1000采集卡（研发工具，无法集成到产品）        │
│  ├── 🚫 每块板子出厂前都需校准（生产成本极高）                   │
│  └── 🚫 板子更换后需重新校准（售后维护不可行）                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

| 评估项             | 评分            | 说明                                      |
| ------------------ | --------------- | ----------------------------------------- |
| 架构匹配           | ⭐⭐⭐⭐⭐      | 原生AWRL6844，无需适配                    |
| 人存检测           | ⭐⭐⭐⭐⭐      | 已有occupancyClassifier                   |
| CNN复用            | ⭐⭐⭐⭐⭐      | cnn_classifier直接可用                    |
| 工作量             | ⭐⭐⭐⭐⭐      | 只需添加姿态/跌倒逻辑                     |
| 风险               | ⭐⭐⭐⭐⭐      | 研发阶段低风险                            |
| **产品化**   | 🚫🚫🚫🚫🚫      | **无法量产**（需DCA1000校准每块板） |
| **预计工期** | **7.5天** | 研发可行，但产品化死路                    |

---

### 方案B：基于 SDK mmwave_demo 开发

```
┌─────────────────────────────────────────────────────────────────┐
│  方案B：基于 MMWAVE_L_SDK mmwave_demo 开发                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  基础工程: mmwave_demo (SDK自带基础Demo)                         │
│                                                                 │
│  已有功能:                                                       │
│  ├── ✅ 基础点云检测                                             │
│  ├── ✅ CFAR检测                                                 │
│  ├── ✅ 校准代码                                                 │
│  └── ✅ CLI框架                                                  │
│                                                                 │
│  需要添加:                                                       │
│  ├── 🔧 人存检测算法                                            │
│  ├── 🔧 CNN分类器集成                                           │
│  ├── 🔧 姿态分类逻辑                                            │
│  ├── 🔧 跌倒检测逻辑                                            │
│  └── 🔧 特征提取全部实现                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

| 评估项             | 评分           | 说明           |
| ------------------ | -------------- | -------------- |
| 架构匹配           | ⭐⭐⭐⭐⭐     | 原生AWRL6844   |
| 人存检测           | ⭐⭐⭐         | 需自行实现     |
| CNN复用            | ⭐⭐⭐         | 需手动集成库   |
| 工作量             | ⭐⭐⭐         | 需添加大量代码 |
| 风险               | ⭐⭐⭐         | 中等           |
| **预计工期** | **10天** |                |

---

### 方案C：移植 xWRL6432 代码

```
┌─────────────────────────────────────────────────────────────────┐
│  方案C：直接移植 xWRL6432 Pose & Fall Detection                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  源代码: 知识库\Pose_And_Fall_Detection\src\xWRL6432\           │
│                                                                 │
│  可复用的算法逻辑:                                               │
│  ├── ✅ pose.c/pose.h (姿态分类)                                 │
│  ├── ✅ motion_detect.c (运动检测)                               │
│  └── ✅ 特征提取逻辑                                             │
│                                                                 │
│  需要大量适配:                                                   │
│  ├── 🔧 M4F → R5F 架构迁移                                       │
│  ├── 🔧 linker.cmd 完全重写                                      │
│  ├── 🔧 syscfg 配置重写                                          │
│  ├── 🔧 ADC格式适配 (IQ交织→分离)                                │
│  ├── 🔧 相位校正新增                                             │
│  ├── 🔧 人存检测需自行添加                                       │
│  └── 🔧 模型库重编译（风险高）                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

| 评估项             | 评分           | 说明                 |
| ------------------ | -------------- | -------------------- |
| 架构匹配           | ⭐             | M4F→R5F，需大量适配 |
| 人存检测           | ⭐⭐           | xWRL6432无此功能     |
| CNN复用            | ⭐⭐           | 模型库需重编译       |
| 工作量             | ⭐⭐           | 架构适配工作量大     |
| 风险               | ⭐⭐           | 高风险               |
| **预计工期** | **12天** |                      |

---

## 1.3 方案对比

### 功能对比

| 功能     | 方案A InCabin | 方案B mmwave_demo | 方案C 6432移植 |
| -------- | ------------- | ----------------- | -------------- |
| 人存检测 | ✅ 已有       | ❌ 需开发         | ❌ 需开发      |
| 点云检测 | ✅ 已有       | ✅ 已有           | ⚠️ 需适配    |
| CNN分类  | ✅ 已有库     | ❌ 需集成         | ⚠️ 需重编译  |
| 姿态检测 | ❌ 需添加     | ❌ 需添加         | ✅ 已有逻辑    |
| 跌倒检测 | ❌ 需添加     | ❌ 需添加         | ✅ 已有逻辑    |

### 工作量对比

| 工作项         | 方案A           | 方案B          | 方案C          |
| -------------- | --------------- | -------------- | -------------- |
| 架构适配       | 0天             | 0天            | 3天            |
| 人存检测       | 0天             | 2天            | 2天            |
| CNN集成        | 1天             | 3天            | 2天            |
| 姿态/跌倒      | 3天             | 3天            | 1天            |
| 配置适配       | 1.5天           | 1天            | 2天            |
| 联调测试       | 2天             | 2天            | 3天            |
| **总计** | **7.5天** | **11天** | **13天** |

### 风险对比

| 风险项           | 方案A              | 方案B | 方案C        |
| ---------------- | ------------------ | ----- | ------------ |
| 编译失败         | 低                 | 低    | 高           |
| 功能不达标       | 低                 | 中    | 中           |
| 模型不兼容       | 低                 | 中    | **高** |
| 架构问题         | 无                 | 无    | **高** |
| 人存不可靠       | 低                 | 中    | 中           |
| **产品化** | 🚫**不可行** | ✅ 可 | ⚠️ 待验证  |

### 产品化可行性对比 ⭐ 关键决策因素

| 维度               | 方案A                  | 方案B       | 方案C       |
| ------------------ | ---------------------- | ----------- | ----------- |
| **校准依赖** | 🚫 每块板需DCA1000校准 | ✅ 无需校准 | ⚠️ 需验证 |
| **生产成本** | 🚫 极高（校准工时）    | ✅ 标准成本 | ⚠️ 待评估 |
| **售后维护** | 🚫 板子换了需重新校准  | ✅ 即插即用 | ⚠️ 待评估 |
| **量产可行** | 🚫 不可行              | ✅ 可量产   | ⚠️ 需测试 |
| **客户体验** | 🚫 维护复杂            | ✅ 简单易用 | ⚠️ 待验证 |

> ⚠️ **致命发现**：方案A的Capon算法虽然精度高，但需要**每块板子出厂前用DCA1000校准**。这在**研发阶段可行**（你有DCA1000），但在**量产阶段完全不可行**：
>
> - 🚫 不可能每块产品出厂前都用采集卡校准
> - 🚫 不可能要求客户购买DCA1000做售后维护
> - 🚫 板子更换后无法让客户自己校准
>
> **结论**：方案A只能用于研发验证，**无法用于产品化**！

---

## 1.4 推荐方案（理论分析阶段）

> ⚠️ **重要说明**：此节是2026-01-05的理论分析结论，**忽略了产品化可行性**。
> 实战后发现方案A的致命问题，详见 [1.6 实战验证结果](#16-实战验证结果2026-01-07)。

### ❌ 原推荐：方案A（基于InCabin Demo扩展）- 理论最优但产品化不可行

**当时的推荐理由**（仅考虑研发阶段）：

| 序号 | 理由                                                     | 现实 |
| ---- | -------------------------------------------------------- | ---- |
| 1    | **人存检测开箱即用** - occupancyClassifier直接可用 | ✅   |
| 2    | **CNN分类器已就绪** - 无需集成，直接调用           | ✅   |
| 3    | **架构零适配** - 原生AWRL6844，无迁移风险          | ✅   |
| 4    | **工期最短** - 7.5天（比方案C节省5.5天）           | ✅   |
| 5    | **风险最低** - 预编译固件可先验证硬件              | ✅   |
| 6    | **功能最全** - 入侵检测等额外功能可选用            | ✅   |

**被忽略的致命问题**（产品化阶段）：

| 问题             | 影响                               | 为何被忽略               |
| ---------------- | ---------------------------------- | ------------------------ |
| 🚫 需DCA1000校准 | 量产不可行                         | Quick Start未提及        |
| 🚫 每板必须校准  | 生产成本极高                       | 只看了功能，没想生产     |
| 🚫 售后无法维护  | 板子坏了客户无法自己换             | 没有产品化经验           |
| 🚫 场景不匹配    | 车内 vs 室内，算法可能需要大量调参 | 只看Demo名字，没深入分析 |

**理论分析的思路**（错误示范）：

```
InCabin Demo 已有功能              需要添加的功能
────────────────────────          ────────────────────────
• 人存检测 ✅                       • 姿态分类逻辑(pose.c)
• 点云检测 ✅                       • 跌倒判断逻辑
• CNN分类器 ✅       ───合并───→    • 特征提取适配
• 入侵检测 ✅                       • TLV输出格式
• Capon 2D ✅                      • CLI配置命令
                            
                     ↓
        
         AWRL6844雷达健康检测固件
         (人存 + 姿态 + 跌倒)
       
❌ 问题：完全没考虑 Capon 2D 需要校准！
❌ 问题：没考虑量产时怎么办！
```

**应该的分析思路**（正确示范）：

```
技术评估 ────→ 功能是否满足？ ✅
                    ↓
            研发是否可行？ ✅
                    ↓
            ⚠️ 量产是否可行？ ← 关键问题！
                    ↓
            ┌──────┴──────┐
            ↓              ↓
          可行           不可行 ← 方案A在这里
            ↓              ↓
        推荐方案        放弃/调整
```

---

## 1.5 待确认事项

请确认以下问题：

| 序号 | 问题                                 | 选项                    |
| ---- | ------------------------------------ | ----------------------- |
| 1    | 是否同意采用方案A？                  | ✅ 同意 / ❌ 选择其他   |
| 2    | 功能范围：人存+姿态+跌倒，是否正确？ | ✅ 正确 / ❌ 需调整     |
| 3    | 呼吸检测是否作为后续研究课题？       | ✅ 是 / ❌ 当前必须实现 |
| 4    | 工期7.5天是否可接受？                | ✅ 可接受 / ❌ 需压缩   |

---

## 1.6 实战验证结果（2026-01-07）

> 📌 **重要更新**：以上是基于TI文档和SDK源码的理论分析。

#### 障碍1: 天线相位校准缺失 ⭐ 致命 - 产品化死路

**理论分析时被忽略的前提**：

- InCabin使用**Capon 2D波束成形算法**
- Capon算法**极度依赖精确的相位校准**
- TI Point Cloud Tuning Guide要求："Step 1: Perform phase calibration"

**实际要求（研发阶段）**：

- 需要**DCA1000数据采集卡**进行校准
- 或使用**mmWave Studio**执行复杂校准（需1-2天学习）

**🚫 产品化阶段的致命问题**：

| 问题                     | 说明                                              | 影响          |
| ------------------------ | ------------------------------------------------- | ------------- |
| **每块板都要校准** | 每个产品出厂前都需用DCA1000校准                   | 🚫 生产不可行 |
| **校准设备昂贵**   | DCA1000采集卡是研发工具，不可能集成到产品         | 🚫 成本极高   |
| **售后无法维护**   | 板子坏了换新板，客户无法自己校准（没有DCA1000）   | 🚫 维护不可行 |
| **校准需要专业**   | 需要mmWave Studio操作，客户做不了                 | 🚫 体验极差   |
| **环境变化影响**   | 温度/湿度变化可能需要重新校准（车内环境TI已考虑） | ⚠️ 风险高   |

**为什么理论分析时没发现？**

| 原因                         | 说明                                                |
| ---------------------------- | --------------------------------------------------- |
| ❌ 只看Quick Start           | Quick Start Guide未提及校准（它假设你会看完整文档） |
| ❌ 没读Tuning Guide          | 只有深入阅读Tuning Guide才发现校准要求              |
| ❌ 没考虑量产流程            | 只想着研发能跑起来，完全没想生产怎么办              |
| ❌ 没问"有DCA1000就行了吗？" | **最致命的疏忽**：有工具≠能量产              |

**正确的思考方式**：

```
✅ 研发阶段：
   "我有DCA1000，可以校准，InCabin能跑起来"
            ↓
⚠️ 量产阶段（被忽略了）：
   "等等，客户产品里怎么校准？"
   "总不能每个产品都配个DCA1000吧？"
   "板子坏了换新的，客户怎么重新校准？"
            ↓
🚫 结论：
   方案A只能用于研发演示，无法产品化！
```

---比测试**（硬件验证）：

```
✅ 标准mmwave_demo + 6844_profile_4T4R_tdm.cfg
   → 点云数据正常
   → 证明硬件功能正常
```

---

### 1.6.2 发现的隐藏障碍

#### 障碍1: 天线相位校准缺失 ⭐ 致命

**理论分析时被忽略的前提**：

- InCabin使用**Capon 2D波束成形算法**
- Capon算法**极度依赖精确的相位校准**
- TI Point Cloud Tuning Guide要求："Step 1: Perform phase calibration"

**实际要求**：

- 需要**DCA1000数据采集卡**（项目未配备）
- 或使用**mmWave Studio**执行复杂校准（需1-2天学习）

**为什么理论分析时没发现？**

- Quick Start Guide未提及此要求
- 只有深入阅读Tuning Guide才会发现
- 标准Demo不需要（DoA算法容忍度高）

---

#### 障碍2: TLV数据格式不兼容

**发现**：InCabin使用专有TLV格式

| 数据类型      | 标准Demo | InCabin   | 影响                   |
| ------------- | -------- | --------- | ---------------------- |
| 点云数据      | Type=1   | Type=3001 | SDK Visualizer无法识别 |
| Occupancy特征 | 无       | Type=3002 | 专有格式               |

**影响**：

- 需要使用InCabin专用GUI
- 但InCabin GUI也显示Points=0
- 说明根本原因是相位校准，不是工具问题

---

#### 障碍3: 场景适配性未验证

**InCabin设计场景**：

- 🚗 车内空间（狭小、封闭）
- 📏 短距离（0.5-2m）
- 👶 婴儿检测（弱目标）

**养老监测场景**：

- 🏠 室内空间（开放、大房间）
- 📏 中距离（1-6m）
- 👴 成人检测（强目标）

**问题**：场景差异可能导致算法不适用（未验证）

---

### 1.6.3 方案评估更新

**原理论评估 vs 实战结果**：

| 评估项             | 理论评估            | 实战结果     | 差异说明      |
| ------------------ | ------------------- | ------------ | ------------- |
| **人存检测** | ⭐⭐⭐⭐⭐（已有）  | ❌ 无法使用  | 固件跑不起来  |
| **工作量**   | ⭐⭐⭐⭐⭐（7.5天） | 🔴 实际>10天 | 需加相位校准  |
| **风险**     | ⭐⭐⭐⭐⭐（低）    | 🔴 高风险    | 隐藏前提多    |
| **成功率**   | 预期90%             | 实际40%      | 校准+场景匹配 |

**更新后的方案对比**：

| 维度               | 方案A (理论) | 方案A (实战)  | 方案B     | 方案C         |
| ------------------ | ------------ | ------------- | --------- | ------------- |
| **可用性**   | ✅ 预期可用  | ❌ 实际不可用 | ✅ 已验证 | ⚠️ 需移植   |
| **前置条件** | ✅ 无        | 🔴 需DCA1000  | ✅ 无     | ⚠️ 架构适配 |
| **隐藏成本** | 0天          | +2-3天校准    | 0天       | +3天适配      |
| **工期**     | 7.5天        | 10-12天       | 7-9天     | 12天          |
| **成功率**   | 90%          | 40%           | 85%       | 60%           |

---

### 1.6.4 方案推荐调整

**原推荐**：✅ 方案A（InCabin扩展）
**实战后调整**：✅ **方案B（标准Demo扩展）**

**调整原因**：

**教训1: 理论分析的局限**

- ❌ Quick Start Guide不等于完整要求
- ❌ "有现成算法"不等于"可以直接用"
- ✅ 必须阅读完整User Guide + Tuning Guide
- ✅ 小范围验证后再选方案

**教训2: 隐藏前置条件**

- ❌ TI Demo的前置条件往往藏在文档深处
- ❌ 官方示例场景可能与项目场景不匹配
- ✅ 必须验证Demo的适用场景
- ✅ 必须检查硬件依赖

**教训3: 实战验证的重要性**

- ❌ 理论再完美，实战可能遇到意外
- ✅ 每个方案先做最小验证（1天）
- ✅ 验证通过再深入开发
- ✅ 保留Plan B方案

**教训4: 产品化思维的缺失 ⭐ 最致命**

- ❌ **"有DCA1000就行了"** - 大错特错！
- ❌ 只考虑研发阶段能不能跑，忘记量产怎么办
- ❌ 研发工具（DCA1000）≠ 可以集成到产品
- ✅ **必须问**："量产时每块板怎么校准？"
- ✅ **必须问**："客户换板后怎么维护？"
- ✅ **必须问**："这个方案能批量生产吗？"

**正确的评估顺序**：

```
❌ 错误顺序（本案例犯的错误）：
   1. 功能是否满足？ ✅
   2. 研发是否可行？ ✅
   3. 推荐方案！      ← 停在这里了
   
   结果：选了个无法量产的方案

✅ 正确顺序：
   1. 功能是否满足？ ✅
   2. 研发是否可行？ ✅
   3. ⚠️ 量产是否可行？ ← 关键！
   4. 售后是否可维护？
   5. 综合评估后推荐
   
   结果：选择可以量产的方案
```

**具体到本项目的惨痛教训**：

| 错误思维                    | 正确思维                                |
| --------------------------- | --------------------------------------- |
| "InCabin有人存检测，真好！" | "它的算法能在没有DCA1000的情况下用吗？" |
| "我有DCA1000，可以校准"     | "量产1000台产品，难道我校准1000次？"    |
| "功能完整，推荐方案A"       | "能量产吗？不能的话研发再好也没用"      |

---- 或有专人学习mmWave Studio校准

```

---

### 1.6.5 经验教训

**教训1: 理论分析的局限**

- ❌ Quick Start Guide不等于完整要求
- ❌ "有现成算法"不等于"可以直接用"
- ✅ 必须阅读完整User Guide + Tuning Guide
- ✅ 小范围验证后再选方案

**教训2: 隐藏前置条件**

- ❌ TI Demo的前置条件往往藏在文档深处
- ❌ 官方示例场景可能与项目场景不匹配
- ✅ 必须验证Demo的适用场景
- ✅ 必须检查硬件依赖

**教训3: 实战验证的重要性**

- ❌ 理论再完美，实战可能遇到意外
- ✅ 每个方案先做最小验证（1天）
- ✅ 验证通过再深入开发
- ✅ 保留Plan B方案

---

### 1.6.6 详细诊断报告

完整的实战失败分析请参考：

- 📄 [02-方案确认 - 实战测试章节](./AWRL6844雷达健康检测-02-方案确认.md#2-实战测试2026-01-0607)
- 📄 [InCabin方案实战失败全面诊断](../../2-开发记录/2026-01-07/2026-01-07_InCabin方案实战失败全面诊断.md)
- 📄 [AWRL6844项目紧急重新评估报告](../../2-开发记录/2026-01-07/2026-01-07_AWRL6844项目紧急重新评估报告.md)

---

## 1.7 最终结论

**理论分析的价值**：

- ✅ 帮助我们理解了3种技术路线
- ✅ 正确评估了各方案的架构匹配度
- ✅ 为实战测试提供了方向

**实战验证的必要性**：

- ✅ 发现了理论分析未预见的障碍
- ✅ 避免了在错误路线上深耕
- ✅ 及时调整到可行方案

**融合的决策流程**：

```

理论分析（1天）→ 方案对比 → 初步选择
                                ↓
                          快速验证（1天）
                                ↓
                    验证通过？
                   ↙         ↘
                 是           否
                 ↓            ↓
            深入开发      调整方案（本案例）

```

**最终方案**：

- ✅ **采用方案B（标准mmwave_demo扩展）**
- 📅 预计工期：7-9天
- 📊 成功率：85%
- 🎯 下一步：执行新的实施大纲

---

> 📌 **下一步**: [02-方案确认](./AWRL6844雷达健康检测-02-方案确认.md) - 查看完整的方案调整过程
> 📅 **创建日期**: 2026-01-05（理论分析）
> 📅 **更新日期**: 2026-01-07（实战验证）
```
