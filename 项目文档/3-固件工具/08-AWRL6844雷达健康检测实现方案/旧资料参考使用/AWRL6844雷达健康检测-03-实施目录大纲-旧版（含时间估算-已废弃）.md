# 📋 AWRL6844雷达健康检测-03-实施目录大纲

> **目标**: 详细的实施步骤和代码开发大纲（基于标准mmwave_demo）
> **创建日期**: 2026-01-05（InCabin版本）
> **重写日期**: 2026-01-07（标准Demo版本）
> **状态**: ✅ 已重新规划

---

## ⚠️ 版本说明

**本大纲基于方案B（标准mmwave_demo扩展）制定**。

**版本历史**：

- v1.0 (2026-01-05): 基于方案A（InCabin Demo扩展）
- v2.0 (2026-01-07): **基于方案B（标准Demo扩展）** ← 当前版本

**为什么重写？**

- 方案A（InCabin扩展）在实战中遇到无法克服的障碍（相位校准、TLV格式等）
- 经5次测试均无法获得点云数据
- 决定切换到方案B（标准mmwave_demo扩展），已验证硬件工作正常
- 详见：[02-方案确认](./AWRL6844雷达健康检测-02-方案确认.md)

**旧版本归档**：

- 📄 [InCabin版本大纲（已废弃）](./AWRL6844雷达健康检测-03-实施目录大纲-InCabin版本（已废弃）.md)

---

## 🔧 硬件设备安装信息

### 设备型号

- **雷达模块**: AWRL6844-EVM
- **天线配置**: 4TX 4RX
- **工作频率**: 60-64 GHz

### 实际安装配置

**安装方式**: 墙面壁挂安装

**安装参数**:

```
安装高度：1.78m（距离地面）
安装朝向：天线面向监测区域
倾斜角度：-40° (俯视角度，天线略向下倾斜)
安装位置：X=0, Y=0, Z=1.78
```

**监测区域定义**（基于配置文件）:

```properties
% 主检测区域
X轴: -2.0m ~ 2.0m  (4米宽度，左右各2米)
Y轴:  0.2m ~ 5.0m  (距离墙面0.2-5米深度)
Z轴:  0.0m ~ 2.0m  (地面到2米高度)

% 传感器坐标系
sensorPosition 0 0 1.78 0 -40
格式说明：X Y Z azimuthTilt elevationTilt
```

**应用场景**: 室内健康检测（人存、姿态、跌倒检测）

### TI官方安装指南参考

- [AWRL6844 EVM User Guide (SWRU630)](https://www.ti.com/lit/swru630)
- [Indoor Human Tracking Reference Design](https://www.ti.com/lit/tiduem8)
- [mmWave Sensor Mounting and Antenna Orientation Guide](https://www.ti.com/lit/swra553)

**重要提示**:

- ✅ 当前安装配置已通过标准Demo验证（能正常检测点云）
- ⚠️ 修改安装位置/角度后需重新校准检测区域参数
- 📋 配置文件位置：`temp/test_configs/incabin_gui_test.cfg`

---

## 📊 实施总览

```
┌─────────────────────────────────────────────────────────────────┐
│           AWRL6844雷达健康检测 实施章节结构（v2.0）              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Phase 0 (架构适配) ⭐   Phase 1A (核心功能)   Phase 1B (优化)  │
│  ──────────────────     ──────────────────    ──────────────    │
│  第1章 环境搭建          第4章 人存检测实现     第7章 杂波移除    │
│  第2章 标准Demo验证      第5章 姿态检测实现     第8章 多目标      │
│  第3章 架构演进规划 🔥   第6章 跌倒检测实现                       │
│       ↓                       ↓                    ↓            │
│  [理解现状] ⭐          [扩展功能]            [性能优化]        │
│                                                                 │
│  Phase 2 (高级扩展)                                              │
│  ─────────────────                                              │
│  第9章 区域划分                                                  │
│  第10章 呼吸检测研究                                             │
│  第11章 综合测试                                                 │
│       ↓                                                         │
│  [完整系统]                                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**关键变化**（v2.1 vs v2.0）：

| 项目               | v2.0版本        | v2.1版本（当前）             | 说明          |
| ------------------ | --------------- | ---------------------------- | ------------- |
| **Phase 0**  | ❌ 缺失         | ✅**新增架构适配阶段** | 🔥 关键新增   |
| 第3章              | 人存检测        | **架构演进规划**       | 🔥 优先级最高 |
| 原第3-5章          | -               | 顺延为第4-6章                | 章节重排      |
| **预计工期** | 7天（错误低估） | 3-5天（架构）+ 2-3周（功能） | 现实评估      |
| CNN分类器          | ❌ 改用规则     | ⚠️ 待架构适配后决定        | 依赖架构      |
| DSS/DSP利用        | ❌ 未提及       | ✅**第3章核心内容**    | 🔥 关键新增   |

---

## 📁 项目目录演进规划

### 文件来源标记说明

| 标记             | 含义             | 说明                     |
| ---------------- | ---------------- | ------------------------ |
| 🆕**新建** | 从零创建         | 本项目原创代码/文档      |
| 📋**复制** | 从SDK复制        | 复制后可能需要修改       |
| 🔧**修改** | 修改已有文件     | 在已有文件基础上增加功能 |
| 📦**依赖** | 直接使用SDK      | 不修改，直接链接使用     |
| 📄**派生** | 基于参考代码改写 | 参考SDK代码重新实现      |

---

## Phase 1A: 核心功能开发

### 第1章：环境搭建

**本章目标**：复制SDK基础工程，创建项目代码框架

#### 1.1 复制SDK基础工程 ⭐ 关键步骤

**为什么要复制SDK工程？**

- 标准Demo包含完整的点云处理流程
- 包含CFAR、DoA等算法实现
- 包含TLV输出、CLI框架
- 我们在此基础上**扩展**而非从零开发

**操作步骤**：

```
1. 找到SDK mmwave_demo工程
   位置：C:\ti\MMWAVE_L_SDK_06_01_00_01\examples\mmw_demo\

2. 复制整个工程到项目目录
   复制到：project-code/AWRL6844_HealthDetect/

3. 重命名工程（在CCS中）
   原名：mmwave_demo
   新名：AWRL6844_HealthDetect
```

#### 1.2 目录结构调整

复制后的初始结构：

```
project-code/AWRL6844_HealthDetect/          # 📋 从SDK复制
├── README.md                                 # 🔧 修改：更新项目说明
│   └── 内容：项目概述、目录结构、构建说明
│
├── src/                                      # 📋 复制：SDK源代码
│   ├── mss/                                 # MSS核心代码
│   │   └── source/
│   │       ├── mmwave_demo_mss.c           # 主程序（后续扩展）
│   │       └── alg/                        # 算法目录（后续添加我们的代码）
│   └── dss/                                 # DSS核心代码
│
├── radar_config_file/                        # 🆕 新建目录
│   ├── README.md                            # 🆕 新建：配置文件说明
│   │   └── 内容：配置文件用途、参数说明、修改指南
│   └── health_detect_base.cfg               # 📋 复制：基础雷达配置
│       ├── 来源：6844_profile_4T4R_tdm.cfg
│       └── 用途：作为项目基础配置模板
│
└── docs/                                     # 🆕 新建空目录
    └── （待第10章填充）
```

#### 1.3 参考代码准备（不复制到工程）

**xWRL6432参考代码**（仅供阅读参考）：

```
知识库/Pose_And_Fall_Detection/src/xWRL6432/
├── pose.c                                    # 📚 参考：姿态检测算法
├── pose.h                                    # 📚 参考：数据结构
├── motion_detect.c                           # 📚 参考：运动检测
└── dpc.c                                     # 📚 参考：数据处理流程
```

**为什么不复制xWRL6432代码？**

- 架构差异（M4F vs R5F）需要重新实现
- 数据格式不同（IQ交织 vs 分离）
- 我们是**参考思路**，不是直接移植

**文件清单**：

| 文件                                         | 操作                | 来源/依赖           | 用途         |
| -------------------------------------------- | ------------------- | ------------------- | ------------ |
| 整个工程目录                                 | 📋 复制             | SDK mmwave_demo/    | 代码基础框架 |
| `README.md`                                | 🔧 修改             | 原SDK README        | 项目说明     |
| `src/mss/source/mmwave_demo_mss.c`         | 📋 复制（后续扩展） | SDK                 | 主程序       |
| `src/mss/source/alg/`                      | 📋 复制（后续填充） | SDK                 | 算法目录     |
| `radar_config_file/README.md`              | 🆕 新建             | -                   | 配置说明     |
| `radar_config_file/health_detect_base.cfg` | 📋 复制             | SDK Visualizer/tmp/ | 基础配置     |

#### 1.4 任务清单

- [ ] 从SDK复制mmwave_demo工程到项目目录
- [ ] 在CCS中导入工程并重命名
- [ ] 验证工程编译通过
- [ ] 验证烧录和运行正常
- [ ] 创建radar_config_file目录并复制配置文件
- [ ] 阅读xWRL6432参考代码（pose.c/pose.h）
- [ ] 更新项目README.md

---

### 第2章：标准Demo验证

**本章目标**：验证标准mmw_demo能正常工作，建立可靠基线

#### 2.1 验证内容

**硬件验证**：

- [ ] 雷达模块上电正常
- [ ] UART通信正常（CLI响应）
- [ ] CAN接口配置正确

**软件验证**：

- [ ] 标准Demo编译通过
- [ ] 烧录成功
- [ ] CLI命令响应正常
- [ ] 点云数据输出正常

**功能验证**：

```
测试场景：
1. 静态环境 → 无点云或极少点云
2. 人员走动 → 有明显点云
3. 人员静止 → 点云稳定
```

#### 2.2 验证工具

| 工具              | 用途       | 说明             |
| ----------------- | ---------- | ---------------- |
| mmWave Visualizer | 点云可视化 | 实时查看检测结果 |
| CCS Debug         | 代码调试   | 验证程序运行     |
| UniFlash          | 固件烧录   | 烧录标准固件     |

#### 2.3 输出文档

- 《标准Demo验证报告》
  - 硬件状态确认
  - 点云数据样本
  - 配置参数记录

> 📋 此章节为快速验证

---

### 第3章：架构演进规划 🔥 **关键章节**

> ⚠️ **本章是整个项目的基石**！在此之前的开发都会走弯路。

**本章目标**：从标准mmw_demo的"仅R5F"架构演进到充分利用AWRL6844多核心资源的架构

#### 3.1 章节概览

**核心问题**：

```
标准mmw_demo现状：
├── ✅ R5F @ 200MHz：运行FreeRTOS + CLI
├── ⚠️ C66x DSP @ 450MHz：闲置或低效 ❌
├── ⚠️ HWA 1.2：部分利用
└── ❌ 896KB共享RAM：未使用

目标：充分利用AWRL6844的四子系统架构
```

---

#### 3.2 目录结构演进规划

**第3章会详细规划整个项目的目录结构和代码组织**，包括：

**最终目标目录结构**：
```
project-code/AWRL6844_HealthDetect/
├── src/
│   ├── common/                      # 🆕 第3章规划
│   │   ├── data_path.h             # DPC数据结构定义
│   │   └── shared_memory.h         # 共享RAM接口
│   │
│   ├── dss/                         # 🔧 第3章扩展规划
│   │   ├── feature_extract.c       # DSS特征提取（第5章实现）
│   │   └── dsp_utils.c             # DSP工具函数
│   │
│   ├── mss/                         # 🔧 第3章扩展规划
│   │   ├── presence_detect.c       # 人存检测（第4章实现）
│   │   ├── pose_detect.c           # 姿态检测（第5章实现）
│   │   ├── fall_detect.c           # 跌倒检测（第6章实现）
│   │   └── health_monitor.c        # 主健康监测逻辑
│   │
│   └── config/                      # 🆕 第3章规划
│       ├── algorithm_params.h      # 算法参数配置
│       └── zone_config.h           # 区域配置
│
├── docs/                            # 🆕 第3章产出
│   ├── DPC机制学习笔记.md
│   ├── 数据流追踪报告.md
│   ├── DSS算法扩展架构设计.md
│   └── 共享RAM使用规范.md
│
└── radar_config_file/
    └── health_detect_final.cfg     # 最终优化配置
```

**第3章的核心产出**：
- ✅ 明确哪些代码放在DSS（C66x DSP）
- ✅ 明确哪些代码放在MSS（R5F）
- ✅ 定义DSS↔MSS数据交互接口
- ✅ 规划共享RAM使用方案

---

#### 3.3 主要任务

**Phase 3A: DPC机制深入学习**

- 阅读SDK源码理解DPC工作原理
- 追踪完整数据流（ADC→DSS→R5F→TLV）
- 实验：修改DPC输出格式
- **产出：完整的目录结构规划文档**

**Phase 3B: DSS算法扩展方案设计**

- 决定DSS代码组织方式
- 设计共享RAM数据结构
- 决策CNN vs 规则分类器路线
- **产出：各模块接口定义**

---

#### 3.4 关键技术决策

| 决策点             | 方案                          | 说明                       |
| ------------------ | ----------------------------- | -------------------------- |
| **算法部署** | DSS做特征提取，R5F做决策      | 平衡复杂度和性能           |
| **DSP利用**  | 点云特征计算、FFT分析         | 450MHz算力用于计算密集任务 |
| **CNN使用**  | Phase 1用规则，Phase 2研究CNN | 降低初期风险               |

---

#### 3.4 产出文档

- 《DPC机制学习笔记》
- 《数据流追踪报告》
- 《DSS算法扩展架构设计》
- 《共享RAM使用规范》

> 📋 详细实施步骤见第3章详细文档

---

### 第4章：人存检测实现

**本章目标**：基于第3章架构方案，实现简单稳定的人存检测

> ⚠️ **前置条件**：第3章已明确算法部署在MSS/R5F

#### 4.1 算法概要

| 版本   | 算法         | 特点          |
| ------ | ------------ | ------------- |
| 基础版 | 点云数量判断 | 简单阈值      |
| 改进版 | 运动检测增强 | 区分静止/运动 |
| 稳定版 | 滞后判断     | 防止误判      |

#### 4.2 实施步骤

- 基础算法开发（创建 presence_detect.c/h）
- 算法优化与测试

#### 4.3 测试验证

- 测试场景：空房间、静止人员、运动人员
- 验收标准：准确率 > 95%

> 📋 详细算法实现见第4章详细文档

---

### 第5章：姿态检测实现

**本章目标**：实现5类姿态检测（站/坐/躺/走/跌倒）

> ⚠️ **前置条件**：第3章已确定DSS特征提取 + MSS分类方案

#### 5.1 算法概要

**特征提取**（在DSS/C66x）：质心、高度、分布、速度

**规则分类器**（在MSS/R5F）：

| 姿态 | 判断依据             |
| ---- | -------------------- |
| 站立 | 高度高，XY分布小     |
| 坐   | 中等高度，XY分布中等 |
| 躺   | 高度低，XY分布大     |
| 走   | 有明显速度           |

#### 5.2 实施步骤

- DSS特征提取代码（创建 feature_extract.c）
- MSS规则分类器（创建 pose_detect.c）
- 参数调优

> 📋 详细特征定义和分类规则见第5章详细文档

---

### 第6章：跌倒检测实现

**本章目标**：基于姿态变化的跌倒检测

> ⚠️ **前置条件**：第5章姿态检测已完成

#### 6.1 算法概要

**状态机流程**：
```
站立/走 → [高度快速下降] → 疑似跌倒 → [持续躺姿] → 确认跌倒 → 告警
```

**判断要素**：
- 快速高度下降（>0.5m）
- 姿态突变（站/走 → 躺）
- 持续时间确认（3秒）

#### 6.2 实施步骤

- 状态机开发（创建 fall_detect.c）
- 测试与调优

> 📋 详细状态机逻辑见第6章详细文档

---

## Phase 1B: 优化功能（2天）

### 第7章：杂波移除优化

- 快速高度下降（>0.5m）
- 姿态突变（站/走 → 躺）
- 持续时间确认（3秒）

#### 6.3 实施步骤（2天）

- Day 1: 状态机开发
- Day 2: 测试与调优

> 📋 详细状态机逻辑见第6章详细文档

---

## Phase 1B: 优化功能（2天）

### 第7章：杂波移除优化

**本章目标**：优化MTI参数，减少静态杂波

#### 7.1 目录变更

```
radar_config_file/
└── health_detect_optimized.cfg    # 📄 派生：优化配置
```

#### 7.2 调优参考

⭐ **TI官方指南**（必读）：

- AWRL6844_CPD_&_SBR_Point_Cloud_Tuning_Guide.md
- Parameter_Tuning_Guide_for_Intrusion_Detection_Demo.md
- 3D_people_tracking_detection_layer_tuning_guide.md

**实施方式**：配置优化，无需代码开发

---

### 第8章：多目标处理

**本章目标**：支持多人场景

#### 8.1 目录变更

```
src/
├── clustering.h    # 🆕 点云聚类接口
└── clustering.c    # 🆕 DBSCAN算法
```

#### 8.2 算法概要

- 点云聚类（DBSCAN）
- 为每个聚类执行姿态检测

#### 8.3 TI官方参考

- 3D_people_tracking_demo_implementation_guide.md
- Tracking_radar_targets_with_multiple_reflection_points.md

---

## Phase 2: 扩展研究

### 第9章：区域划分

**本章目标**：划分床区和活动区

**实现思路**：

- CLI命令配置区域坐标
- 根据点云位置判断所在区域

---

### 第10章：呼吸检测研究

**本章目标**：尝试呼吸检测（研究性）

> ⚠️ **高风险研究**：需要DSS深度FFT分析

**实现思路**：

- 分析微多普勒信号（在DSS）
- FFT提取呼吸频率
- 相位变化检测

**风险**：可能做不出来，作为可选研究

---

### 第11章：综合测试与验收

**本章目标**：完整系统测试

**测试内容**：

- 人存检测准确率测试
- 姿态检测准确率测试
- 跌倒检测响应时间测试
- 长时间稳定性测试

---

#### 2.1 验证清单

- [ ] 固件烧录正常
- [ ] 串口通信正常
- [ ] 点云数据输出正常
- [ ] SDK Visualizer显示正常
- [ ] 配置文件加载正常

#### 2.2 测试方法

```
步骤1: 烧录 mmwave_demo 固件
步骤2: 发送 6844_profile_4T4R_tdm.cfg 配置
步骤3: 启动传感器 (sensorStart)
步骤4: 验证点云数据正常显示
步骤5: 记录测试结果
```

#### 2.3 预期结果

### 第4章：人存检测实现 ⭐ 首个功能实现

**本章目标**：基于第3章的架构设计，实现简单但稳定的人存检测算法

> ⚠️ **前置条件**：必须完成第3章架构规划，明确算法在APPSS/DSS的部署方案

#### 4.1 章节概览

**为什么需要这一章？**

- 标准Demo本身**没有人存检测功能**
- InCabin的occupancyClassifier无法使用（产品化不可行）
- 需要基于第3章的架构方案实现算法
- 验证APPSS/DSS协同工作

**实现思路**：

```
点云数据 → 预处理 → 特征提取 → 判断规则 → 人存状态
```

---

#### 4.2 目录变更

```
project-code/AWRL6844_HealthDetect/src/
├── presence_detect.h                        # 🆕 新建：人存检测头文件
│   ├── 内容：人存状态枚举、结果结构体、接口声明
│   ├── 依赖：SDK点云数据结构
│   └── 接口：
│       - presenceDetect_init()
│       - presenceDetect_run(pointCloud)
│       - presenceDetect_getResult()
│
└── presence_detect.c                        # 🆕 新建：人存检测实现
    ├── 内容：
    │   ├── 点云数量统计
    │   ├── 运动检测（速度分析）
    │   ├── 持续时间判断（防抖）
    │   └── 人存状态输出
    ├── 算法：
    │   - 简单阈值判断（点云数量>N）
    │   - 运动检测（速度>M）
    │   - 滞后判断（连续K帧）
    └── 依赖：SDK点云数据结构
```

**文件清单**：

| 文件                      | 操作    | 来源/参考 | 依赖        | 用途         |
| ------------------------- | ------- | --------- | ----------- | ------------ |
| `src/presence_detect.h` | 🆕 新建 | 自主设计  | SDK点云结构 | 人存检测接口 |
| `src/presence_detect.c` | 🆕 新建 | 自主设计  | SDK点云结构 | 人存检测实现 |

---     - presenceDetect_getResult()
│
└── presence_detect.c                        # 🆕 新建：人存检测实现
    ├── 内容：
    │   ├── 点云数量统计
    │   ├── 运动检测（速度分析）
    │   ├── 持续时间判断（防抖）
    │   └── 人存状态输出
    └── 算法：
        - 简单阈值判断（点云数量>N）
        - 运动检测（速度>M）
        - 滞后判断（连续K帧）

```

---

#### 4.3 算法设计概要

**算法分级**：

| 版本 | 算法 | 特点 | 应用场景 |
|------|------|------|----------|
| 基础版 | 点云数量判断 | 简单阈值判断 | 快速验证 |
| 改进版 | 运动检测增强 | 区分静止/运动 | 实际应用 |
| 稳定版 | 滞后判断 | 防止误判 | 生产环境 |

**关键参数**：
- 点云数量阈值
- 速度阈值
- 滞后帧数

> 📋 详细算法实现见第3章详细文档

---

#### 4.4 实施步骤

**Day 1: 基础算法开发**

1. 创建 `presence_detect.h`和 `presence_detect.c`
2. 实现算法1（点云数量判断）
3. 集成到主程序
4. 输出TLV调试信息

**Day 2: 算法优化与测试**

1. 实现算法2（运动检测增强）
2. 实现算法3（滞后判断）
3. 参数调优测试
4. 验证稳定性

---

#### 4.5 测试计划

**测试场景**：

| 场景       | 预期结果                   | 验证方法           |
| ---------- | -------------------------- | ------------------ |
| 房间无人   | PRESENCE_NONE              | 点云数量<5         |
| 静坐不动   | PRESENCE_STATIC            | 点云数量>8，无速度 |
| 正常活动   | PRESENCE_DETECTED          | 点云数量>5，有速度 |
| 人离开房间 | PRESENCE_NONE（3帧后）     | 滞后判断生效       |
| 人进入房间 | PRESENCE_DETECTED（3帧后） | 滞后判断生效       |

---

#### 4.6 输出格式

**CLI命令**：配置检测参数（点云阈值、速度阈值、滞后帧数）

**TLV输出**：人存状态、点云数量、运动点数量、信心度

> 📋 详细数据结构定义见第3章详细文档

---

#### 4.7 与后续章节的关系

**第4章输出** → **第5章姿态检测的输入**

```

人存检测结果 = {
    state: PRESENCE_DETECTED,
    numPoints: 12,
    movingPoints: 5
}
    ↓
姿态检测：
  if (state == PRESENCE_NONE) {
      return POSE_NONE;  // 跳过姿态检测
  } else {
      // 执行姿态分类
      poseClassify(pointCloud);
  }

```

**优势**：

- 人存检测作为**前置过滤器**
- 无人时跳过姿态检测，节省计算
- 分层架构清晰

---

### 第5章：姿态检测实现

**本章目标**：实现5类姿态检测（站/坐/躺/走/跌倒）

> ⚠️ **前置条件**：第3章架构已明确DSS特征提取方案，第4章人存检测已验证架构可行性

#### 4.1 章节概览

**实现思路**：

- 参考xWRL6432的pose.c算法
- 不使用CNN分类器（改用规则判断）
- 基于点云特征的规则分类

---

#### 4.2 目录变更

```

project-code/AWRL6844_HealthDetect/src/
├── pose_detect.h                            # 🆕 新建：姿态检测头文件
│   ├── 参考：知识库/Pose_And_Fall_Detection/src/xWRL6432/pose.h
│   ├── 内容：姿态类型枚举、结果结构体、接口声明
│   └── 接口：
│       - poseDetect_init()
│       - poseDetect_extractFeatures(pointCloud)
│       - poseDetect_classify(features)
│       - poseDetect_getResult()
│
└── pose_detect.c                            # 📄 派生：姿态检测实现
    ├── 参考：知识库/Pose_And_Fall_Detection/src/xWRL6432/pose.c
    ├── 内容：
    │   ├── 特征提取（质心、高度、分布、速度）
    │   ├── 规则分类器（替代CNN）
    │   └── 姿态结果输出
    └── 依赖：
        - presence_detect.h（前置判断）
        - SDK点云数据结构

```

---

#### 4.3 算法设计概要

**特征提取**（参考xWRL6432）：
- 质心坐标（X/Y/Z）
- XY平面分布范围
- Z轴分布范围
- 平均/最大速度
- 点云数量

**规则分类器**（不使用CNN）：

| 姿态 | 判断依据 |
|------|----------|
| 站立 | 高度高，XY分布小 |
| 坐 | 中等高度，XY分布中等 |
| 躺 | 高度低，XY分布大 |
| 走 | 有明显速度 |

> 📋 详细特征定义和分类规则见第4章详细文档

---

#### 4.4 实施步骤

**Day 1: 特征提取**

1. 创建 `pose_detect.h`和 `pose_detect.c`
2. 实现点云特征提取函数
3. 输出特征值调试

**Day 2: 规则分类器**

1. 实现站/坐/躺判断规则
2. 实现走判断规则
3. 集成测试

**Day 3: 参数调优**

1. 实测收集数据
2. 调整阈值参数
3. 验证准确率

---

#### 4.5 测试计划

**测试场景**：

| 场景     | 预期姿态 | 特征验证                  |
| -------- | -------- | ------------------------- |
| 站立不动 | STANDING | centerZ > 1.2             |
| 坐在椅子 | SITTING  | 0.6 < centerZ < 1.2       |
| 躺在床上 | LYING    | centerZ < 0.6, spreadXY大 |
| 行走     | WALKING  | avgVelocity > 0.3         |

---

### 第6章：跌倒检测实现

**本章目标**：基于姿态变化的跌倒检测

> ⚠️ **前置条件**：第5章姿态检测已完成，可提供稳定的姿态输入

#### 5.1 章节概览

**实现思路**：

- 使用**状态机**监控姿态变化
- 检测"站立→跌倒"或"走→跌倒"转换
- 输出告警

---

#### 5.2 目录变更

```

project-code/AWRL6844_HealthDetect/src/
└── fall_detect.c                            # 🆕 新建：跌倒检测实现
    ├── 内容：
    │   ├── 姿态历史缓冲区
    │   ├── 状态机逻辑
    │   ├── 跌倒判断规则
    │   └── 告警输出
    └── 依赖：
        - pose_detect.h（姿态输入）

```

---

#### 5.3 算法设计概要

**状态机流程**：
```

站立/走 → [高度快速下降] → 疑似跌倒 → [持续躺姿] → 确认跌倒 → 告警

```

**判断要素**：
- 快速高度下降（>0.5m）
- 姿态突变（站/走 → 躺）
- 持续时间确认（3秒）

> 📋 详细状态机逻辑和参数见第5章详细文档

---

#### 5.4 实施步骤

**Day 1: 状态机开发**

1. 创建 `fall_detect.c`
2. 实现姿态历史缓冲
3. 实现状态机逻辑

**Day 2: 测试与调优**

1. 模拟跌倒场景测试
2. 调整阈值参数
3. 验证误报率

---

## Phase 1B: 优化功能（2天）

### 第7章：杂波移除优化

**本章目标**：优化MTI参数，减少静态杂波

#### 6.1 目录变更

```

project-code/AWRL6844_HealthDetect/
└── radar_config_file/
    ├── health_detect_base.cfg               # （保留不变）
    │
    └── health_detect_optimized.cfg          # 📄 派生：优化后配置
        ├── 来源：基于 health_detect_base.cfg 修改
        ├── 修改内容：
        │   ├── clutterRemoval 参数优化
        │   ├── CFAR阈值调整
        │   └── 帧率/检测范围优化
        └── 参考：TI官方调优指南

```

**文件清单**：

| 文件                                              | 操作    | 来源/参考    | 用途     |
| ------------------------------------------------- | ------- | ------------ | -------- |
| `radar_config_file/health_detect_optimized.cfg` | 📄 派生 | 基于base.cfg | 优化配置 |

#### 6.2 ⭐ TI官方调优指南（必读）

| 文档                                | 知识库位置                                                                                | 价值等级   | 关键内容                                 |
| ----------------------------------- | ----------------------------------------------------------------------------------------- | ---------- | ---------------------------------------- |
| **Point Cloud Tuning Guide**  | `知识库/知识库PDF转机器可读文件/AWRL6844_CPD_&_SBR_Point_Cloud_Tuning_Guide.md`         | ⭐⭐⭐⭐⭐ | 相位校准、传感器位置、sensorPosition CLI |
| **Parameter Tuning Guide**    | `知识库/知识库PDF转机器可读文件/Parameter_Tuning_Guide_for_Intrusion_Detection_Demo.md` | ⭐⭐⭐⭐⭐ | CFAR配置、杂波移除                       |
| **3D Detection Layer Tuning** | `知识库/知识库PDF转机器可读文件/3D_people_tracking_detection_layer_tuning_guide.md`     | ⭐⭐⭐⭐   | 详细CFAR配置、静态杂波移除               |

**实施方式**：

- 不涉及代码开发，主要是配置优化
- 参考TI文档调整参数
- 测试不同参数的效果

---

### 第8章：多目标处理

**本章目标**：支持多人场景

#### 7.1 章节概览

**实现思路**：

- 点云聚类（DBSCAN算法）
- 为每个聚类执行姿态检测

---

#### 7.2 目录变更

```

project-code/AWRL6844_HealthDetect/src/
├── clustering.h                             # 🆕 新建：点云聚类头文件
│   ├── 参考：TI Group Tracker概念
│   ├── 内容：聚类结果结构体、接口声明
│   └── 依赖：SDK点云数据结构
│
└── clustering.c                             # 🆕 新建：点云聚类实现
    ├── 参考：TI 3D People Tracking Demo
    ├── 内容：DBSCAN算法实现
    └── 依赖：SDK点云数据结构

```

**文件清单**：

| 文件                 | 操作    | 来源/参考                 | 依赖        | 用途     |
| -------------------- | ------- | ------------------------- | ----------- | -------- |
| `src/clustering.h` | 🆕 新建 | 参考TI Group Tracker      | SDK点云结构 | 聚类接口 |
| `src/clustering.c` | 🆕 新建 | 参考TI 3D People Tracking | SDK点云结构 | 聚类实现 |

#### 7.3 ⭐ TI官方人数跟踪参考（必读）

| 文档                                                                | 知识库位置                          | 价值等级   | 关键内容              |
| ------------------------------------------------------------------- | ----------------------------------- | ---------- | --------------------- |
| **3D_people_tracking_demo_implementation_guide.md**           | `知识库/知识库PDF转机器可读文件/` | ⭐⭐⭐⭐⭐ | 完整架构、算法流程    |
| **Tracking_radar_targets_with_multiple_reflection_points.md** | `知识库/知识库PDF转机器可读文件/` | ⭐⭐⭐⭐   | Group Tracker算法详解 |

---

## Phase 2: 扩展研究

### 第9章：区域划分

**本章目标**：划分床区和活动区

**实现思路**：

- CLI命令配置区域坐标
- 根据点云位置判断所在区域

---

### 第10章：呼吸检测研究

**本章目标**：尝试呼吸检测（研究性）

> ⚠️ **高风险研究**：需要DSS深度FFT分析，依赖第3章的DSP算法扩展能力

**实现思路**：

- 分析微多普勒信号
- FFT提取呼吸频率

**风险**：标准Demo可能不支持，需研究

---

### 第11章：综合测试与验收

**本章目标**：完整系统测试

**测试内容**：

- 人存检测准确率测试
- 姿态检测准确率测试
- 跌倒检测响应时间测试
- 长时间稳定性测试

---

## 📊 章节概览

| Phase        | 章节                      | 状态 | 说明                 | 工期     |
| ------------ | ------------------------- | ---- | -------------------- | -------- |
| **Phase 0** | 第1章：环境搭建          | 📝   | 复制SDK工程          | 1天      |
| **架构**     | 第2章：标准Demo验证      | 📝   | 基础功能验证         | 1天      |
|              | 第3章：架构演进规划 🔥   | 📝   | **DPC/DSS深度研究** | **3-5天** |
| **Phase 1A** | 第4章：人存检测          | 📝   | 首个功能实现         | 1-2周    |
| **核心**     | 第5章：姿态检测          | 📝   | DSS特征提取+分类     | 2-3周    |
|              | 第6章：跌倒检测          | 📝   | 状态机开发           | 1-2周    |
| **Phase 1B** | 第7章：杂波移除          | 📝   | 配置优化             | 2-3天    |
| **优化**     | 第8章：多目标处理        | 📝   | 聚类算法             | 1周      |
| **Phase 2**  | 第9章：区域划分          | 📝   | 场景扩展             | 3-5天    |
| **扩展**     | 第10章：呼吸检测研究     | 📝   | DSP FFT分析          | 1-2周    |
|              | 第11章：综合测试         | 📝   | 系统验收             | 1周      |

**总工期估算**：

| 阶段 | 工期 | 关键产出 |
|------|------|---------|
| Phase 0（架构） | **5-7天** | DPC机制理解、DSS扩展方案 ⭐ |
| Phase 1A（核心） | **4-7周** | 人存、姿态、跌倒检测 |
| Phase 1B（优化） | **1.5-2周** | 性能提升、多人支持 |
| Phase 2（扩展） | **2.5-4周** | 区域、呼吸、验收 |
| **总计** | **13-20周** | 完整健康检测系统 |

**实施策略**：

- ⚠️ **Phase 0是基石**，不可跳过！
- Phase 1A（核心功能）：优先级最高，实现基本健康检测
- Phase 1B（优化增强）：提升系统稳定性和性能
- Phase 2（扩展研究）：高级功能和场景适配

> 📝 所有章节均为待开始状态，**必须从第1章开始，按顺序实施**

---

## 📚 与InCabin版本的对比

| 项目             | InCabin版本                           | 标准Demo版本        | 说明       |
| ---------------- | ------------------------------------- | ------------------- | ---------- |
| 人存检测         | 直接可用                              | 需开发              | 增加工作量 |
| 姿态检测         | 需移植                                | 需移植+参考xWRL6432 | 相同       |
| 跌倒检测         | 需开发                                | 需开发（状态机）    | 相同       |
| CNN分类器        | 有库可用                              | 不使用（规则代替）  | 简化       |
| 相位校准         | **必需（阻塞）**                | **不需要**    | 关键差异   |
| DCA1000          | **必需**                        | **不需要**    | 关键差异   |
| TLV格式          | 专有                                  | 标准                | 工具兼容好 |
| **可行性** | 理论可行，实际无法完成（0/5测试成功） | 已验证硬件工作正常  | 稳妥       |

---

## 🎯 关键决策记录

### 为什么放弃CNN分类器？

**原因**：

1. InCabin的CNN库无法使用（固件跑不起来）
2. 规则分类器足够简单有效
3. 降低复杂度，提高成功率

**影响**：

- ⚠️ 姿态分类准确率可能略低（预计85% vs 90%）
- ✅ 开发速度快，风险低
- ✅ 代码易维护

---

### 为什么先做人存检测？

**原因**：

1. 人存检测是所有后续功能的**前置条件**
2. 作为过滤器，可提高系统效率
3. 技术难度低，快速完成建立信心

**架构**：

```

人存检测 → 姿态检测 → 跌倒检测
   ↑            ↑            ↑
 [过滤器]    [分类器]    [状态机]

```

---

## 📄 相关文档

1. [00-能力评估报告](./AWRL6844雷达健康检测-00-能力评估报告.md) - 芯片能力边界
2. [01-方案讨论与分析](./AWRL6844雷达健康检测-01-方案讨论与分析.md) - 技术路线对比
3. [02-方案确认](./AWRL6844雷达健康检测-02-方案确认.md) - 方案选择与调整
4. [InCabin版本大纲（已废弃）](./AWRL6844雷达健康检测-03-实施目录大纲-InCabin版本（已废弃）.md) - 历史版本
5. [设备安装信息](./AWRL6844雷达健康检测-设备安装信息.md) - 硬件配置详情

---

> 📌 **当前状态**: 所有章节待开始，从第1章环境搭建开始
> 📅 **更新日期**: 2026-01-07
> 🎯 **目标**: 按Phase 1A → Phase 1B → Phase 2顺序实施
```
