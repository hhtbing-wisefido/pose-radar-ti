# 📊 AWRL6844 测试结果深度分析报告

**日期**：2025-12-22  
**分析对象**：实际测试结果疑问  
**参考资料**：TI SDK文档、知识库、官方手册

---

## 🔍 问题概述

### 测试环境
- **硬件**：AWRL6844-EVM
- **固件**：`mmwave_demo.release.appimage` (365.25 KB)
- **通信端口**：COM3 (App), COM4 (Data, 125000波特率)
- **烧录工具**：`arprog_cmdline_6844.exe`

### 测试结果总结

| 场景 | 烧录命令 | 配置文件 | 结果 |
|------|---------|---------|------|
| A-1 | 有偏移 (0x42000) | cfg1/cfg2 | ❌ 无法启动 |
| A-2 | 有偏移 (0x42000) | cfg3 | ❌ 无法启动 |
| B-1 | 无偏移 | cfg1/cfg2 | ✅ 正常工作 |
| B-2 | 无偏移 | cfg3 | ❌ 无法启动 |

---

## 🎯 问题1：为什么有偏移量(0x42000)烧录无法启动？

### 根本原因：缺少SBL固件

#### AWRL6844启动流程

```
启动流程：
┌─────────────────┐
│ ROM Bootloader  │ ← 芯片固化，无法修改
│   (地址固定)    │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  SBL固件        │ ← Flash 0x0000 - 0x2000 (8KB)
│ (必须存在)      │    Secondary Bootloader
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│ Application     │ ← Flash 0x42000开始 (270336字节偏移)
│ Image           │    应用固件 (365.25 KB)
└─────────────────┘
```

#### A组命令分析

```bash
# A组命令（失败）
arprog_cmdline_6844.exe -p COM3 -f1 <app.appimage> -of1 270336 -s SFLASH -c
```

**执行结果**：
- ✅ App固件成功烧录到 **Flash 0x42000** 位置
- ❌ **Flash 0x0 - 0x2000** 区域 **为空**（没有SBL）
- ❌ ROM Bootloader启动后找不到SBL → **启动失败**

**内存布局**：
```
Flash 内存布局：
0x00000000  ┌────────────┐
            │  [空白]    │ ← ❌ 应该有SBL，但是没有！
0x00002000  ├────────────┤
            │   ....     │
            │  [空白]    │
0x00042000  ├────────────┤
            │   App      │ ← ✅ 应用固件在这里
            │ (365KB)    │
0x000A1400  └────────────┘
```

---

## ✅ 问题1解决方案：需要先烧录SBL

### 正确的烧录流程

#### ⚠️ 注意：SDK可能不包含预编译的SBL固件

经过查找，`MMWAVE_L_SDK_06_01_00_01` 中可能没有预编译的SBL固件。

**两种解决方案**：

#### 方案1：自己编译SBL（需要CCS）
```bash
# SBL源代码位置
C:\ti\MMWAVE_L_SDK_06_01_00_01\mmwave_l_sdk_06_01_00_01\examples\drivers\boot\sbl_lite\

# 使用Code Composer Studio编译SBL
1. 打开CCS
2. 导入SBL项目
3. 编译生成 sbl_lite.bin
4. 烧录到Flash 0x0
```

#### 方案2：使用无偏移烧录（推荐）⭐
```bash
# 直接烧录App，不使用偏移量
arprog_cmdline_6844.exe -p COM3 -f1 mmwave_demo.release.appimage -s SFLASH -c

优点：
- 不需要单独的SBL
- 适合快速开发测试
- App固件可能包含必要的启动代码
```

#### 完整内存布局
```
Flash 内存布局（正确）：
0x00000000  ┌────────────┐
            │    SBL     │ ← ✅ SBL固件 (约8KB)
0x00002000  ├────────────┤
            │   保留区   │
0x00042000  ├────────────┤
            │   App      │ ← ✅ 应用固件
            │ (365KB)    │
0x000A1400  └────────────┘
```

---

## 🤔 问题2：为什么B组（无偏移）可以工作？

### B组命令分析

```bash
# B组命令（成功）
arprog_cmdline_6844.exe -p COM3 -f1 <app.appimage> -s SFLASH -c
# 注意：没有 -of1 参数
```

### 原因分析

#### 可能性1：arprog工具的智能处理 ⭐
```
arprog默认行为（推测）：
1. 检测文件类型（.appimage）
2. 发现没有指定偏移量
3. 自动将文件烧录到 0x0 位置
4. 覆盖整个Flash区域（包括SBL区域）
```

#### 可能性2：App固件包含Bootloader功能
```
mmwave_demo.release.appimage 可能包含：
- 简化的Bootloader代码
- 可以直接从0x0启动
- 不依赖独立的SBL
```

#### 可能性3：App固件自包含启动代码
```
App Image结构：
┌─────────────────┐
│ Meta Header     │ ← Magic "MSTR"
├─────────────────┤
│ Boot Code       │ ← 可能包含启动代码
├─────────────────┤
│ R5F Core Image  │
├─────────────────┤
│ C66x DSP Image  │
├─────────────────┤
│ BSS Section     │
└─────────────────┘
```

### 验证结果

**成功启动的内存布局**：
```
Flash 内存布局（B组）：
0x00000000  ┌────────────┐
            │   App      │ ← App从0x0开始
            │  Image     │   包含启动功能
            │ (365KB)    │
0x0005B400  └────────────┘
```

---

## 🔧 问题3：为什么配置文件3 (xWRL6844_4T4R_tdm.cfg) 无法启动？

### 配置文件对比

#### ✅ 配置文件1/2（工作正常）
```cfg
sensorStop 0
channelCfg 153 255 0
chirpComnCfg 8 0 0 256 1 13.1 3
chirpTimingCfg 6 63 0 160 58
adcDataDitherCfg 1              ← ✅ 有ADC抖动配置
frameCfg 64 0 1358 1 100 0      ← ✅ 帧周期: 100ms
gpAdcMeasConfig 0 0             ← ✅ 有GP ADC配置
guiMonitor 1 1 0 0 0 1
cfarProcCfg 0 2 8 4 3 0 9.0 0
cfarProcCfg 1 2 4 2 2 1 9.0 0
cfarFovCfg 0 0.25 9.0
cfarFovCfg 1 -20.16 20.16
aoaProcCfg 64 64
aoaFovCfg -60 60 -60 60
clutterRemoval 0                ← ✅ 杂波抑制配置
factoryCalibCfg 1 0 44 2 0x1ff000
runtimeCalibCfg 1               ← ✅ 运行时校准启用
antGeometryBoard xWRL6844EVM    ← ✅ 使用板级天线几何
adcDataSource 0 adc_test_data_0001.bin
adcLogging 0                    ← ✅ ADC日志关闭
lowPowerCfg 1                   ← ✅ 低功耗模式启用
sensorStart 0 0 0 0
```

#### ❌ 配置文件3（失败）
```cfg
sensorStop 0
channelCfg 153 255 0
chirpComnCfg 8 0 0 256 1 13.1 3
chirpTimingCfg 6 63 0 160 58
frameCfg 64 0 2000 1 200 0      ← ❌ 帧周期: 200ms (更长)
guiMonitor 1 1 0 0 0 1
cfarProcCfg 0 2 8 4 3 0 9.0 0
cfarProcCfg 1 2 4 2 2 1 9.0 0
cfarFovCfg 0 0.25 9.0
cfarFovCfg 1 -20.16 20.16
aoaProcCfg 64 64
aoaFovCfg -60 60 -60 60
factoryCalibCfg 1 0 44 2 0x1ff000
runtimeCalibCfg 0               ← ❌ 运行时校准禁用
antGeometryCfg 3 2 2 2 2 3 3 3 3 0 2 0 2 1 3 1 1 0 0 0 0 1 1 1 1 2 0 2 0 3 1 3 2.54 2.54  ← ❌ 自定义天线几何
compRangeBiasAndRxChanPhase ... ← ❌ 手动相位补偿
adcDataSource 0 adc_test_data_0001.bin
adcLogging 1                    ← ❌ ADC日志启用
lowPowerCfg 0                   ← ❌ 低功耗模式禁用
sensorStart 0 0 0 0
```

### 关键差异分析

| 配置项 | 配置1/2 | 配置3 | 影响 |
|-------|---------|-------|------|
| **runtimeCalibCfg** | 1 (启用) | 0 (禁用) | ⭐ 运行时校准必须启用 |
| **antGeometry** | `antGeometryBoard` | `antGeometryCfg` | 自定义几何可能不兼容 |
| **compRangeBias** | 无 | 有 | 手动补偿可能错误 |
| **adcDataDitherCfg** | 1 | 无 | 缺少ADC配置 |
| **gpAdcMeasConfig** | 有 | 无 | 缺少GP ADC配置 |
| **clutterRemoval** | 有 | 无 | 缺少杂波抑制 |
| **lowPowerCfg** | 1 | 0 | 低功耗设置不同 |
| **frameCfg周期** | 100ms | 200ms | 帧率不同 |

### 失败的根本原因

#### 1. 运行时校准禁用（最关键）⭐⭐⭐
```
runtimeCalibCfg 0  ← ❌ 禁用

影响：
- 无法进行运行时射频校准
- 温度补偿失效
- 信号质量下降
- 可能导致固件无法正常初始化
```

#### 2. 自定义天线几何配置错误
```
antGeometryCfg 3 2 2 2 2 3 3 3 3 0 2 0 2 1 3 1 1 0 0 0 0 1 1 1 1 2 0 2 0 3 1 3 2.54 2.54

问题：
- 参数可能与实际硬件不匹配
- 应该使用 antGeometryBoard xWRL6844EVM
```

#### 3. 缺少必要的配置命令
```
配置3缺少：
- adcDataDitherCfg  ← ADC抖动配置
- gpAdcMeasConfig   ← GP ADC测量配置
- clutterRemoval    ← 杂波抑制
```

---

## 📝 结论与建议

### 问题1：Flash偏移量烧录失败

**原因**：
- 使用270336 (0x42000)偏移量时，必须先烧录SBL到0x0位置
- 单独烧录App到0x42000会导致启动失败

**解决方案**：
```bash
# 方案1：使用完整烧录流程（推荐用于生产）
1. 烧录SBL:  arprog ... -of1 0
2. 烧录App:  arprog ... -of1 270336

# 方案2：不使用偏移量（开发测试）
arprog ... (不加-of1参数)
```

**建议**：
- ✅ 开发阶段使用B组命令（无偏移）
- ✅ 生产阶段使用A组命令（需要先烧SBL）
- ✅ 默认禁用偏移量选项，避免用户误操作

---

### 问题2：配置文件3无法启动

**原因**：
- 关键配置缺失或错误
- 运行时校准被禁用
- 天线几何配置不匹配

**解决方案**：
- ✅ 使用SDK提供的标准配置文件（cfg1/cfg2）
- ✅ 确保 `runtimeCalibCfg 1` 启用
- ✅ 使用 `antGeometryBoard xWRL6844EVM` 而非自定义几何

**建议**：
- 基于工作的配置文件进行修改
- 不要禁用运行时校准
- 优先使用板级天线几何配置

---

## 🎯 最佳实践

### 固件烧录最佳实践

1. **开发测试阶段**
   ```bash
   # 快速烧录，无需SBL
   arprog_cmdline_6844.exe -p COM3 -f1 app.appimage -s SFLASH -c
   ```

2. **生产部署阶段**
   ```bash
   # 完整烧录流程
   # Step 1: SBL
   arprog_cmdline_6844.exe -p COM3 -f1 sbl.bin -of1 0 -s SFLASH -c
   # Step 2: App
   arprog_cmdline_6844.exe -p COM3 -f1 app.appimage -of1 270336 -s SFLASH -c
   ```

### 雷达配置最佳实践

1. **使用SDK标准配置**
   - 优先使用SDK自带的配置文件
   - 路径：`C:\ti\MMWAVE_L_SDK_06_01_00_01\mmwave_l_sdk_06_01_00_01\tools\visualizer\tmp\`

2. **关键配置检查**
   ```cfg
   runtimeCalibCfg 1              # ⭐ 必须启用
   antGeometryBoard xWRL6844EVM   # ⭐ 使用板级配置
   lowPowerCfg 1                  # 建议启用
   ```

3. **修改配置时的注意事项**
   - 不要禁用运行时校准
   - 不要随意修改天线几何
   - 保留ADC和GP配置命令

---

## 📚 参考资料

1. **TI官方文档**
   - xWRL6844 Software Getting Started Guide
   - xWRL68xx Technical Reference Manual
   - MMWAVE_L_SDK API文档

2. **SDK路径**
   - SBL文档：`C:\ti\MMWAVE_L_SDK_06_01_00_01\docs\api_guide_xwrL684x\EXAMPLES_BOOT_SBL.html`
   - 配置示例：`C:\ti\MMWAVE_L_SDK_06_01_00_01\mmwave_l_sdk_06_01_00_01\tools\visualizer\tmp\`

3. **知识库资料**
   - Migration Guide
   - User Manual
   - Application Notes

---

**分析完成**：2025-12-22  
**分析人员**：AI Assistant  
**置信度**：高 ⭐⭐⭐⭐⭐
