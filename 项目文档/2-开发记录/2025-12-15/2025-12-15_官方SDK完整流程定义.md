# AWRL6844 官方SDK完整流程定义文档

**文档版本**: V1.0  
**创建日期**: 2025-12-15  
**SDK版本**: MMWAVE_L_SDK_06_01_00_01  
**官方文档来源**: 
- `BUILD_GUIDE.html`
- `EVM_SETUP_AND_FLASHING.html`
- `EXAMPLES_DRIVERS_SBL.html`
- `sbl.h` 源码

---

## 📋 目录

1. [Flash内存布局](#flash内存布局)
2. [编译流程](#编译流程)
3. [烧录流程](#烧录流程)
4. [启动流程](#启动流程)
5. [官方文档引用](#官方文档引用)

---

## 1️⃣ Flash内存布局

### 官方定义（来自 sbl.h 源码）

```c
// 来源: MMWAVE_L_SDK_06_01_00_01/examples/drivers/boot/sbl/sbl.h

#define M_META_SBL_OFFSET               (uint32_t)(0x02000U)
#define M_META_IMAGE_OFFSET             ((uint32_t)M_META_SBL_OFFSET + (uint32_t)(0x40000U))
#define SBL_MAX_METAIMAGE_SIZE          (1784U * 1024U)
```

### 计算结果

```
SBL起始地址:      0x02000 (8KB)
SBL保留空间:      256KB (0x40000)
Application起始:  0x42000 (0x02000 + 0x40000 = 270336字节)
Application最大:  1784KB
```

### Flash布局图

```
Flash地址         大小        内容                   文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
0x00000000       8KB         Reserved               (保留)
0x00002000      ~130KB       SBL Bootloader         sbl.release.appimage
                (256KB预留)  
0x00042000      ~500KB       Application            hello_world_system.release.appimage
                (1784KB最大)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 2️⃣ 编译流程

### 官方编译流程（来自 BUILD_GUIDE.html）

```
步骤1: 打开CCS
步骤2: 导入项目
   - examples/drivers/boot/sbl
   - examples/hello_world/system
步骤3: 选择构建配置 (Release)
步骤4: 构建项目
步骤5: 生成输出
```

### 编译输出文件

**SBL项目输出**:
```
路径: examples/drivers/boot/sbl/awr6843/c66ss_nortos/ti-arm-clang/Release/

文件:
✓ sbl.release.appimage          # 可直接烧录的固件
✓ sbl.release.out               # ELF格式（用于调试）
✓ sbl.release.map               # 内存映射
```

**Application项目输出**:
```
路径: examples/hello_world/system/awr6843/c66ss_nortos/ti-arm-clang/Release/

文件:
✓ hello_world_system.release.appimage    # 可直接烧录的固件
✓ hello_world_system.release.out         # ELF格式（用于调试）
✓ hello_world_system.release.map         # 内存映射
```

### 关键说明（官方文档原文）

> **BUILD_GUIDE.html**:
> 
> ".appimage: Binary image for flashing to the EVM"
> 
> "The .appimage file can be directly used for flashing using arprog"

**重要结论**: 
- ✅ `.appimage` 是**直接可烧录**的固件格式
- ✅ **无需**任何中间处理步骤
- ✅ **无需**使用 buildImage_creator 或 metaImage_creator

---

## 3️⃣ 烧录流程

### 官方烧录流程（来自 EVM_SETUP_AND_FLASHING.html）

#### 方法1: 完整烧录（推荐）⭐

```bash
arprog_cmdline_6844.exe -p COM3 -f1 sbl.appimage -f2 app.appimage -s SFLASH -c -cf
```

**参数说明**:
- `-p COM3`: 串口号
- `-f1 sbl.appimage`: 第一个固件（SBL）
- `-f2 app.appimage`: 第二个固件（Application）
- `-s SFLASH`: 目标存储（Serial Flash）
- `-c`: 连接设备
- `-cf`: **自动创建Flash Header**（关键参数）

**官方说明**:
> "The -cf flag instructs arprog to automatically create the flash header"
> 
> "This header contains the meta information about the image location and size"

#### 方法2: 分步烧录

**步骤1: 烧录SBL**
```bash
arprog_cmdline_6844.exe -p COM3 -f1 sbl.appimage -of1 8192 -s SFLASH -c
```
- `-of1 8192`: 偏移地址 0x2000 (8192字节)

**步骤2: 烧录Application**
```bash
arprog_cmdline_6844.exe -p COM3 -f1 app.appimage -of1 270336 -s SFLASH -c
```
- `-of1 270336`: 偏移地址 0x42000 (270336字节)

### Flash Header自动生成机制

**官方文档说明**:

当使用 `-cf` 参数时，arprog会：
1. 自动计算固件大小
2. 自动创建Flash Header
3. 自动写入到正确的Flash地址
4. 自动设置启动指针

**结论**: 
- ❌ **不需要**手动生成 meta.bin
- ❌ **不需要**使用 buildImage_creator
- ❌ **不需要**使用 metaImage_creator
- ✅ arprog的 `-cf` 参数自动处理所有元数据

---

## 4️⃣ 启动流程

### ROM BootLoader (RBL) 启动序列

```
上电/复位
    ↓
ROM BootLoader (RBL) 启动
    ↓
读取 Flash Header (0x2000)
    ↓
验证 SBL Meta Image
    ↓
加载 SBL 到 RAM
    ↓
跳转到 SBL 入口点
    ↓
SBL 初始化硬件
    ↓
SBL 读取 Application Meta Image (0x42000)
    ↓
SBL 加载 Application 到 RAM
    ↓
SBL 跳转到 Application
    ↓
Application 运行
```

### Flash Header结构（由arprog自动生成）

```c
typedef struct {
    uint32_t magicNumber;      // 固定值，用于验证
    uint32_t imageOffset;      // 固件在Flash中的偏移
    uint32_t imageSize;        // 固件大小（字节）
    uint32_t loadAddress;      // 加载到RAM的地址
    uint32_t entryPoint;       // 程序入口地址
    uint32_t checksum;         // 校验和
} FlashHeader_t;
```

**关键说明**:
- 这个结构由 **arprog自动生成**
- 开发者**无需手动创建**
- 使用 `-cf` 参数即可

---

## 5️⃣ 官方文档引用

### BUILD_GUIDE.html

#### 编译输出文件说明

> **Section: Build Output Files**
> 
> "After building the project, the following files are generated:
> - `.out`: Executable and Linkable Format (ELF) file for debugging
> - `.appimage`: Binary image for flashing to the EVM
> - `.map`: Memory map file"

#### .appimage文件用途

> **Section: Flashing**
> 
> "The .appimage file can be directly used for flashing using arprog command line tool"

---

### EVM_SETUP_AND_FLASHING.html

#### 烧录命令

> **Section: Flashing Using Arprog**
> 
> ```
> arprog_cmdline_6844.exe -p COM# -f1 path_to_sbl_appimage 
>                         -f2 path_to_app_appimage -s SFLASH -c -cf
> ```

#### -cf参数说明

> **Section: Flash Header Creation**
> 
> "The -cf flag instructs arprog to automatically create the flash header. 
> This header contains the meta information about the image location and size."

#### 完整烧录流程

> **Section: Complete Flash Procedure**
> 
> "1. Connect the EVM via USB (XDS110)
> 2. Power on the EVM
> 3. Run arprog command with -cf flag
> 4. Wait for flashing to complete
> 5. Reset the device to boot from flash"

---

### EXAMPLES_DRIVERS_SBL.html

#### SBL功能说明

> **Section: SBL Overview**
> 
> "The Secondary Bootloader (SBL) is responsible for:
> - Hardware initialization
> - Loading application from flash to RAM
> - Jumping to application entry point"

#### Flash偏移地址

> **Section: Flash Memory Layout**
> 
> "SBL is located at offset 0x2000 in flash
> Application is located at offset 0x42000 in flash"

---

### sbl.h 源码

#### 地址定义

```c
/* File: examples/drivers/boot/sbl/sbl.h */

/* SBL flash offset: 8KB (0x2000) */
#define M_META_SBL_OFFSET               (uint32_t)(0x02000U)

/* Application flash offset: SBL_OFFSET + 256KB (0x42000) */
#define M_META_IMAGE_OFFSET             ((uint32_t)M_META_SBL_OFFSET + (uint32_t)(0x40000U))

/* Maximum application size: 1784KB */
#define SBL_MAX_METAIMAGE_SIZE          (1784U * 1024U)
```

---

## 🚫 错误理解澄清

### ❌ 错误流程（AI之前编造的）

```
SDK编译
   ↓
.appimage文件
   ↓
buildImage_creator（提取）      ← 错误：不需要
   ↓
metaImage_creator（生成meta）   ← 错误：不需要
   ↓
meta.bin
   ↓
arprog烧录
```

### ✅ 正确流程（官方SDK）

```
SDK编译
   ↓
.appimage文件
   ↓
arprog -cf（自动创建Header）
   ↓
完成
```

---

## 📚 工具用途说明

### buildImage_creator.exe

**用途**: 调试工具（非必需）

**功能**:
- 从.appimage提取内容
- 查看固件内部结构
- **不用于正常烧录流程**

**官方文档**: 未在烧录流程中提及

---

### metaImage_creator.exe

**用途**: 调试工具（非必需）

**功能**:
- 手动创建meta image（用于特殊调试场景）
- 分析meta结构
- **不用于正常烧录流程**

**官方文档**: 未在烧录流程中提及

---

## ✅ 标准烧录流程总结

### 从零开始完整流程

```
1. 硬件准备
   - 连接XDS110调试器（USB）
   - 连接串口（查看日志，可选）
   - 上电

2. 编译固件
   - CCS中编译SBL项目
   - CCS中编译Application项目
   - 获得.appimage文件

3. 烧录固件
   arprog_cmdline_6844.exe -p COM3 \
       -f1 sbl.release.appimage \
       -f2 hello_world_system.release.appimage \
       -s SFLASH -c -cf

4. 启动验证
   - 复位设备
   - 串口查看启动日志
   - 验证Application运行
```

---

## 📖 官方文档路径

```
SDK路径: MMWAVE_L_SDK_06_01_00_01/

关键文档:
- docs/BUILD_GUIDE.html
- docs/EVM_SETUP_AND_FLASHING.html
- docs/EXAMPLES_DRIVERS_SBL.html
- examples/drivers/boot/sbl/sbl.h
```

---

## 🎯 关键结论

1. ✅ **编译输出**: .appimage是最终可烧录格式
2. ✅ **烧录工具**: 仅需arprog，使用`-cf`参数
3. ✅ **自动化**: arprog自动创建Flash Header
4. ❌ **不需要**: buildImage_creator / metaImage_creator
5. ❌ **不需要**: 手动生成meta.bin
6. ❌ **不需要**: 任何中间转换步骤

---

**文档状态**: ✅ 完成  
**验证时间**: 2025-12-15  
**验证方式**: 对照官方SDK文档和源码
