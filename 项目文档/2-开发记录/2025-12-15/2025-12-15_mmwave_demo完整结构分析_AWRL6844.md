# 📡 mmwave_demo 项目完整结构分析（AWRL6844）

> **分析日期**: 2025-12-15  
> **项目名称**: mmwave_demo  
> **硬件平台**: xWRL6844EVM (AWRL6844)  
> **雷达配置**: 4T4R（4发4收）  
> **SDK版本**: MMWAVE-L-SDK v6.01.00.01

---

## 📋 目录

1. [项目概述](#1-项目概述)
2. [雷达配置文件详解](#2-雷达配置文件详解)
3. [固件架构](#3-固件架构)
4. [功能模块划分](#4-功能模块划分)
5. [硬件资源配置](#5-硬件资源配置)
6. [与HelloWorld对比](#6-与helloworld对比)
7. [关键技术特性](#7-关键技术特性)
8. [应用场景](#8-应用场景)

---

## 1. 项目概述

### 1.1 基本信息

| 属性 | 值 |
|------|-----|
| **项目名称** | mmwave_demo |
| **项目类型** | 完整雷达应用演示 |
| **硬件平台** | AWRL6844 (xWRL684x-evm) |
| **固件数量** | 1个（单核R5F + RF固件） |
| **固件大小** | 374 KB |
| **源代码量** | 24个文件，453.32 KB |
| **雷达配置** | 4种profile配置 + 监控配置 |

### 1.2 项目定位

**mmwave_demo是TI官方最完整的雷达应用参考项目**，包含：
- ✅ 完整的雷达信号处理链
- ✅ 多种天线配置支持（2T4R、3T4R、4T4R）
- ✅ 完善的校准和监控机制
- ✅ 多种数据输出方式（UART、LVDS）
- ✅ 电源管理优化
- ✅ 工厂和运行时校准

---

## 2. 雷达配置文件详解

### 2.1 配置文件清单

| 配置文件 | 大小 | 用途 | 天线配置 |
|---------|------|------|----------|
| **profile_4T4R_tdm.cfg** | 690字节 | **4发4收TDM模式** | **✨ AWRL6844推荐** |
| profile_3T4R_tdm.cfg | 534字节 | 3发4收TDM模式 | 中等性能 |
| profile_2T4R_bpm.cfg | 535字节 | 2发4收BPM模式 | 低功耗模式 |
| monitors.cfg | 1410字节 | 完整监控配置 | 包含所有监控器 |

### 2.2 4T4R配置详解（AWRL6844最佳配置）

#### 核心参数

**通道配置**：
```
channelCfg 153 255 0
解读：
- 153 (0x99) = 二进制 10011001 → TX通道：1,4,5,8启用（4发）
- 255 (0xFF) = 二进制 11111111 → RX通道：全部启用（4收）
- 结果：4T4R完整配置
```

**Chirp配置**：
```
chirpComnCfg 8 0 0 256 1 13.1 3
关键参数：
- 起始频率：60 GHz基准
- 带宽：3 GHz
- ADC采样点：256点
- 扫频时间：13.1 μs
```

**帧配置**：
```
frameCfg 64 0 1358 1 100 0
帧参数：
- 每帧Chirp数：64个
- 帧周期：100 ms
- 帧率：10 FPS
```

#### CFAR检测配置

**距离CFAR**：
```
cfarProcCfg 0 2 8 4 3 0 9.0 0
- 窗口大小：8个单元
- 保护单元：4个
- 噪声平均：2侧
- 检测门限：9.0 dB
```

**多普勒CFAR**：
```
cfarProcCfg 1 2 4 2 2 1 9.0 0
- 更小的窗口（运动目标）
- 门限：9.0 dB
```

#### FOV配置

**距离视场**：
```
cfarFovCfg 0 0.25 9.0
- 最小距离：0.25 m
- 最大距离：9.0 m
```

**角度视场**：
```
cfarFovCfg 1 -20.16 20.16
aoaFovCfg -60 60 -60 60
- 方位角：±60°
- 俯仰角：±60°
- 速度范围：±20.16 m/s
```

#### 高级功能

**AOA处理**：
```
aoaProcCfg 64 64
- FFT点数：64 × 64
- 高精度角度估计
```

**校准配置**：
```
factoryCalibCfg 1 0 44 2 0x1ff000
runtimeCalibCfg 1
- 工厂校准：启用
- 运行时校准：启用
- 校准数据地址：0x1ff000
```

**天线几何**：
```
antGeometryBoard xWRL6844EVM
- 使用标准6844 EVM天线布局
- 自动加载天线几何参数
```

### 2.3 监控配置详解

monitors.cfg包含**完整的RF监控系统**：

#### RF监控器类型

**1. PLL监控**：
```
monPllCtrlVolt 0x03 0.2 1 0.1 1.45
- 监控锁相环控制电压
- 确保频率稳定性
```

**2. 发射功率监控**（8个TX）：
```
monTxnPowCfg 0-7 58.0 2.2 -3.5 3.5
- 每个TX独立监控
- 功率范围：±3.5 dB
- 基准值：58.0（相对值）
```

**3. 基带功率监控**：
```
monTxnBBPowCfg 0,2,4,6 60.5 2.2 -6 3
- 监控基带功率
- 4个TX通道（偶数）
```

**4. DC偏置监控**：
```
monTxnDcSigCfg 0-3 58.0 2.2 0x3
- 监控TX DC偏置
- 确保信号质量
```

**5. TX-RX环回监控**：
```
monTxRxLbCfg 0,2,4,6 58.0 2.2 -26 -26 -3 3 -20 20 -3 3 -30 30
- 发射-接收链路测试
- 幅度和相位监控
```

**6. RX高通滤波器监控**：
```
monRxHpfDcSigCfg 58.0 0 1.5 4.5 -14 -6
- 接收通路DC监控
```

**7. 时钟监控**：
```
monPmClkDcCfg 58.0 0x7fffff
- 电源和时钟稳定性监控
```

#### 监控启用掩码

```
enableRFmons 0x00000001FEABFEAB
解读：64位掩码，每位对应一个监控器
- 启用的监控器：PLL、TX功率、基带、DC、环回等
- 未启用：保留和测试用监控器
```

---

## 3. 固件架构

### 3.1 固件组成

**mmwave_demo.release.appimage (374 KB)** 包含：

#### 核心映像（Metaimage结构）

| 组件 | 文件名 | 功能 | 位置 |
|------|--------|------|------|
| **R5F固件** | mmwave_demo_r5_img.release.rig | 主控制器和应用逻辑 | 核心0 |
| **R5F固件** | mmwave_demo_r5_img.release.rig | （分段加载） | 核心1 |
| **RF固件** | mmwave_rfs_patch.rig | RF子系统固件补丁 | RF核心 |

#### 与HelloWorld的固件差异

| 对比项 | HelloWorld | mmwave_demo |
|--------|------------|-------------|
| **固件数量** | 4个（2单核+2双核） | 1个（单核+RF） |
| **是否多核** | 可选（有System变体） | 仅R5F单核 |
| **是否包含C66x** | System变体包含 | ❌ 不包含DSP |
| **RF固件** | 仅System变体 | ✅ 必须包含 |
| **固件大小** | 43-219 KB | 374 KB |

**关键差异解读**：
- mmwave_demo专注于R5F实现，不使用DSP
- 所有信号处理在R5F + HWA（硬件加速器）完成
- RF固件必须，因为涉及雷达操作

### 3.2 固件加载机制

**Metaimage配置结构**：
```json
{
  "metaImageType": "multi",          // 多映像组合
  "buildImages": [
    {
      "buildImagePath": "mmwave_demo_r5_img.release.rig",  // R5F应用
      "encryptEnable": "no"
    },
    {
      "buildImagePath": "mmwave_rfs_patch.rig",            // RF补丁
      "encryptEnable": "no"
    }
  ]
}
```

**核心映像分解**：
```
coreImages: [
  mmwave_demo_r5_img.release_coreimage_0.bin  // R5F代码段1
  mmwave_demo_r5_img.release_coreimage_1.bin  // R5F数据段
  mmwave_rfs_patch_coreimage_0.bin            // RF固件
]
```

**加载流程**：
1. **SBL引导** → 加载Metaimage
2. **解析头部** → 识别3个核心映像
3. **加载R5F** → 代码+数据段到R5F内存
4. **加载RF** → RF固件到RF子系统
5. **启动应用** → R5F开始执行mmwave_demo

---

## 4. 功能模块划分

### 4.1 源代码模块（24个文件，453 KB）

#### 主控模块

**mmwave_demo.c/h**：
- 应用主入口和框架
- 任务调度和状态机
- 系统初始化

**main.c**：
- 平台特定入口点
- FreeRTOS任务创建

#### 命令行接口

**mmw_cli.c/h**：
- UART命令解析
- 配置参数接收
- 结果输出控制

**功能**：
- 接收.cfg文件命令
- 实时参数调整
- 调试和诊断

#### 校准模块（calibrations/）

**factory_cal.c/h**：
- 工厂校准流程
- 校准数据存储（Flash）
- 校准参数加载

**mmw_flash_cal.c/h**：
- Flash校准数据管理
- 校准状态验证

**range_phase_bias_measurement.c/h**：
- 距离-相位偏差测量
- TX-RX通道校准
- 提高测距精度

**作用**：
- 补偿硬件差异
- 提高测量精度
- 长期稳定性

#### 信号处理（dpc/）

**dpc.c/h**：
- 数据路径控制（Data Path Control）
- 信号处理链管理
- HWA（硬件加速器）配置

**处理流程**：
1. ADC数据采集
2. 距离FFT（HWA）
3. 多普勒FFT（HWA）
4. CFAR检测
5. AOA估计
6. 目标跟踪

#### 数据流（lvds_streaming/）

**mmw_lvds_stream.c/h**：
- LVDS高速数据流
- 原始ADC数据导出
- 点云数据输出

**应用**：
- 数据采集卡（DCA1000）
- 高级分析工具
- 算法开发

#### 毫米波控制（mmwave_control/）

**mmwave_control_config.c**：
- mmWave子系统配置
- Chirp和帧配置
- 触发控制

**interrupts.c/h**：
- 中断处理程序
- 帧触发中断
- Chirp中断处理

**monitors.c/h**：
- RF监控器管理
- 监控报告解析
- 异常处理

#### 电源管理（power_management/）

**power_management.c/h**：
- 低功耗模式
- 帧间睡眠
- 动态电源调节

**功能**：
- 减少功耗30-50%
- 延长电池寿命
- 热管理

#### 测试模块（test/）

**ADC_testbuf.c/h**：
- ADC测试缓冲区
- 数据完整性验证
- 调试工具

### 4.2 模块依赖关系

```
mmwave_demo (主控)
├── CLI接口 → 接收配置命令
├── 毫米波控制 → 配置RF和Chirp
│   ├── 配置生成 → Chirp参数
│   ├── 监控器 → RF健康检查
│   └── 中断处理 → 帧同步
├── 校准系统 → 补偿和校准
│   ├── 工厂校准 → 出厂参数
│   ├── Flash管理 → 持久化存储
│   └── 相位校准 → 运行时补偿
├── 信号处理（DPC） → 目标检测
│   ├── HWA配置 → 硬件加速
│   ├── CFAR检测 → 目标识别
│   └── AOA估计 → 角度测量
├── LVDS流 → 数据导出
└── 电源管理 → 节能优化
```

---

## 5. 硬件资源配置

### 5.1 SysConfig配置（example.syscfg）

#### 外设配置

**ADC缓冲区（adcbuf）**：
- 4个RX通道同时采样
- 256点ADC采样/Chirp
- 高速数据缓冲

**HWA（硬件加速器）**：
- 距离FFT加速
- 多普勒FFT加速
- 比R5F软件快10-20倍

**CBUFF（循环缓冲区）**：
- LVDS数据流缓冲
- 高速数据传输

**EDMA（直接内存访问）**：
- ADC到内存传输
- 零CPU开销
- 2个EDMA实例

**QSPI Flash**：
- 固件存储
- 校准数据存储
- 配置参数持久化

**UART × 2**：
- UART1：CLI命令接口
- UART2：调试日志输出

**I2C**：
- 电流监控（INA226 × 3）
- PMIC电源管理
- 传感器接口

**SPI（从模式）**：
- 数据流输出
- 连接主机处理器

**GPIO × 2**：
- LED状态指示
- SPI主机中断信号

### 5.2 内存配置

**R5F内存布局**（linker.cmd）：
```
区域             大小        用途
-----------------------------------
TCMA RAM        32 KB       代码快速访问
TCMB RAM        32 KB       数据快速访问
L2 SRAM         1 MB        主内存（代码+数据）
HSM RAM         64 KB       安全区域
CBUFF           32 KB       数据流缓冲
HWA RAM         192 KB      硬件加速器内存
```

### 5.3 MPU配置（11个区域）

内存保护单元配置，保护：
- 代码段（只读执行）
- 数据段（读写）
- 外设寄存器（设备内存）
- DMA缓冲区（非缓存）

---

## 6. 与HelloWorld对比

### 6.1 核心差异对比表

| 对比维度 | HelloWorld | mmwave_demo |
|----------|------------|-------------|
| **项目定位** | 基础入门示例 | 完整雷达应用 |
| **固件变体** | 4种（单/双核、OS/裸机） | 1种（单核FreeRTOS） |
| **固件大小** | 43-219 KB | 374 KB |
| **源代码量** | 基础框架 | 24文件，453 KB |
| **雷达配置** | ❌ 无 | ✅ 4种profile |
| **RF操作** | ❌ 不涉及 | ✅ 完整RF控制 |
| **信号处理** | ❌ 无 | ✅ 完整处理链 |
| **HWA使用** | ❌ 未配置 | ✅ 关键加速 |
| **校准系统** | ❌ 无 | ✅ 工厂+运行时 |
| **监控系统** | ❌ 无 | ✅ 完整RF监控 |
| **数据输出** | 简单打印 | UART + LVDS流 |
| **电源管理** | ❌ 无 | ✅ 低功耗优化 |
| **实际应用** | 学习框架 | 可直接部署 |

### 6.2 架构层次对比

**HelloWorld架构**（简单）：
```
main() → 初始化 → 打印消息 → 结束
- 单线程或简单任务
- 验证硬件正常
- 学习SDK使用
```

**mmwave_demo架构**（复杂）：
```
系统初始化
├── FreeRTOS启动
├── 外设初始化
├── mmWave子系统初始化
└── 任务创建
    ├── CLI任务（接收命令）
    ├── mmWave任务（RF控制）
    ├── DPC任务（信号处理）
    └── 监控任务（健康检查）

命令循环
├── 接收配置 → 应用参数
├── 启动传感器 → 开始Chirp
├── 数据处理 → 目标检测
├── 结果输出 → UART/LVDS
└── 监控检查 → RF状态

中断驱动
├── 帧中断 → 触发处理
├── Chirp中断 → 数据同步
└── EDMA完成 → 数据就绪
```

### 6.3 学习路径建议

**阶段1：HelloWorld**
- 理解SDK结构
- 验证硬件正常
- 学习编译和烧录
- 掌握基础调试

**阶段2：mmwave_demo**
- 理解雷达原理
- 学习RF配置
- 掌握信号处理
- 实战应用开发

---

## 7. 关键技术特性

### 7.1 TDM-MIMO技术

**4T4R TDM配置**：
- **时分复用（TDM）**：4个TX按时间顺序发射
- **虚拟天线阵列**：4T × 4R = 16个虚拟天线
- **角度分辨率**：优于BPM模式
- **FOV范围**：±60°方位和俯仰

**TDM时序**：
```
Chirp1: TX1发射 → 4个RX接收 → 4路数据
Chirp2: TX4发射 → 4个RX接收 → 4路数据
Chirp3: TX5发射 → 4个RX接收 → 4路数据
Chirp4: TX8发射 → 4个RX接收 → 4路数据
合计：16路独立数据（虚拟16通道）
```

**优势**：
- ✅ 高角度分辨率（~15°）
- ✅ 无需复杂相位编码
- ✅ 简化信号处理
- ⚠️ 帧率受限（需要4倍Chirp时间）

### 7.2 CFAR检测算法

**两级CFAR**：

**1. 距离CFAR**：
- CA-CFAR（单元平均）
- 窗口：8个训练单元
- 保护单元：4个
- 检测静止和运动目标

**2. 多普勒CFAR**：
- 专门用于速度维度
- 窗口：4个训练单元
- 抑制静止杂波

**自适应门限**：
- 根据噪声水平动态调整
- 虚警率控制（9.0 dB门限）
- 环境适应性强

### 7.3 AOA估计技术

**角度测量方法**：
- FFT-based AOA：64点FFT
- 波束形成：虚拟天线阵列
- 相位测量：TX-RX相位差

**精度**：
- 方位角：±1-2°（取决于SNR）
- 俯仰角：±1-2°
- 测量范围：±60°

### 7.4 校准系统

**工厂校准**（factory_cal）：
- TX相位校准
- RX增益校准
- 频率偏移校准
- **存储位置**：Flash 0x1ff000

**运行时校准**（runtime_cal）：
- 温度补偿
- 实时相位调整
- 自动触发条件：
  - 温度变化 > 10°C
  - 开机后首次
  - 长时间运行后

**相位偏差测量**：
- TX-RX通道一致性
- 提高AOA精度
- 消除系统误差

### 7.5 监控系统

**实时RF健康监控**：
- 发射功率偏差检测
- PLL锁定状态
- 温度监控
- 电压监控

**异常处理**：
- 功率超限 → 告警输出
- PLL失锁 → 重新配置
- 温度过高 → 降功率/停止

**作用**：
- 确保性能稳定
- 早期故障检测
- 延长设备寿命
- 满足法规要求（FCC）

---

## 8. 应用场景

### 8.1 适合的应用

**汽车雷达**：
- ✅ 车内人员检测
- ✅ 驾驶员监控（DMS）
- ✅ 乘客监控（OMS）
- ✅ 生命体征检测

**工业自动化**：
- ✅ 区域入侵检测
- ✅ 人员计数
- ✅ 轨迹跟踪
- ✅ 手势识别

**智能家居**：
- ✅ 存在检测
- ✅ 跌倒检测
- ✅ 呼吸心率监测
- ✅ 手势控制

**安防监控**：
- ✅ 周界防范
- ✅ 入侵报警
- ✅ 人员统计
- ✅ 异常行为检测

### 8.2 性能参数（4T4R配置）

**探测能力**：
- 距离范围：0.25-9.0 m
- 速度范围：±20.16 m/s
- 角度范围：±60°（方位和俯仰）

**分辨率**：
- 距离分辨率：~5 cm（3 GHz带宽）
- 速度分辨率：~0.16 m/s
- 角度分辨率：~15°

**检测性能**：
- 最大目标数：64个/帧
- 帧率：10 FPS
- 虚警率：可配置（门限控制）

**功耗**（电源管理启用）：
- 活动模式：~1.2 W
- 低功耗模式：~0.3 W
- 平均功耗：~0.6 W（10 FPS）

### 8.3 与AWRL6844的匹配度

**完美匹配原因**：

**1. 硬件配置**：
- ✅ 4T4R充分利用6844的所有TX/RX
- ✅ HWA加速器最大化性能
- ✅ 内存配置优化（1 MB L2）

**2. 频段和功率**：
- ✅ 60-64 GHz ISM频段
- ✅ EIRP满足FCC 47 CFR 15.255
- ✅ 多地区认证支持

**3. 接口和扩展**：
- ✅ UART CLI（配置和调试）
- ✅ LVDS流（连接DCA1000）
- ✅ SPI从模式（连接主机MCU）
- ✅ GPIO（状态指示）

**4. 功耗和热管理**：
- ✅ 电源管理优化
- ✅ 温度监控
- ✅ 动态调整

---

## 9. 关键结论

### 9.1 项目特点总结

**mmwave_demo是AWRL6844的最佳参考项目**：

1. **完整性**：包含从配置到输出的完整流程
2. **实用性**：可直接用于产品开发
3. **灵活性**：多种配置适应不同场景
4. **优化性**：充分利用硬件加速和低功耗
5. **可靠性**：完善的校准和监控系统

### 9.2 与HelloWorld的互补

| 项目 | 定位 | 学习重点 | 开发用途 |
|------|------|----------|----------|
| **HelloWorld** | 入门示例 | SDK框架、编译流程 | 验证环境 |
| **mmwave_demo** | 参考应用 | 雷达应用、信号处理 | 产品开发基础 |

**学习建议**：
1. **先学HelloWorld** → 掌握基础
2. **再学mmwave_demo** → 理解应用
3. **基于mmwave_demo开发** → 定制功能

### 9.3 固件库集成建议

**扫描策略**：
```
项目：mmwave_demo
├── 固件：mmwave_demo.release.appimage (374 KB)
├── 雷达配置：
│   ├── ✨ profile_4T4R_tdm.cfg （推荐）
│   ├── profile_3T4R_tdm.cfg
│   ├── profile_2T4R_bpm.cfg
│   └── monitors.cfg （监控配置）
├── SysConfig：example.syscfg
├── 推荐SBL：
│   ├── sbl.release.appimage (69.78 KB)
│   └── sbl_lite.release.appimage (62.28 KB)
└── 源代码目录：source/
    ├── 主控：mmwave_demo.c/h
    ├── CLI：mmw_cli.c/h
    ├── 校准：calibrations/
    ├── 信号处理：dpc/
    ├── 数据流：lvds_streaming/
    ├── RF控制：mmwave_control/
    └── 电源管理：power_management/
```

**UI显示建议**：
```
📁 mmwave_demo [AWRL6844-4T4R]
  固件：mmwave_demo.release.appimage (374 KB)
  
  雷达配置：
  ✨ profile_4T4R_tdm.cfg (推荐)
  📄 profile_3T4R_tdm.cfg
  📄 profile_2T4R_bpm.cfg
  🔧 monitors.cfg (监控)
  
  SysConfig：example.syscfg
  
  推荐SBL：
  📌 sbl.release.appimage (69.78 KB)
  📌 sbl_lite.release.appimage (62.28 KB)
  
  源代码：6个模块，24个文件
```

---

## 10. 后续工作

### 10.1 固件库实现

**需要实现的功能**：

1. **雷达配置扫描**：
   - 在项目目录搜索*.cfg
   - 排除syscfg、rov、x509
   - 识别profiles、chirp_configs目录
   - 解析配置类型（4T4R、3T4R等）

2. **配置文件推荐**：
   - 根据硬件平台推荐配置
   - 6844 → 优先4T4R
   - 6432 → 优先2T4R
   - 标注"推荐"和"可选"

3. **配置详情展示**：
   - 天线配置（TX/RX）
   - 距离/速度/角度范围
   - 分辨率参数
   - 适用场景说明

### 10.2 测试验证

**验证项目**：
- [ ] 扫描mmwave_demo项目
- [ ] 正确识别4个雷达配置
- [ ] 标注4T4R为推荐
- [ ] 显示配置详情
- [ ] 关联正确的SBL
- [ ] 源代码目录链接

---

> **文档版本**: v1.0  
> **作者**: AI Assistant  
> **最后更新**: 2025-12-15
