# v1.0.7 设计方案

## 🎯 问题分析

### 1. 界面显示不全的问题
**现状**：
- 默认900x820窗口无法显示所有功能
- 1080P分辨率看不到端口管理
- 2K分辨率看不到串口监视器
- 所有功能挤在一个界面

**根本原因**：
- 单页面布局导致内容过多
- 没有使用滚动条
- 功能混杂在一起

### 2. 烧录选项不明显
**现状**：
- SBL和App单独烧录按钮被折叠
- 用户看不到这些选项

### 3. SBL烧录判断问题
**问题**：如何判断只需要烧录App而不需要烧录SBL？

**分析**：
1. **首次烧录**：必须SBL+App完整烧录
2. **应用更新**：只需烧录App
3. **SBL损坏**：只需烧录SBL

**判断依据**：
- 板载是否有SBL：通过测试COM3/COM4端口
- SBL版本信息：需要读取板载固件信息
- 用户选择：提供选项让用户决定

### 4. 烧录地址问题
**现状**：
- SBL偏移：0x2000（固定）
- App偏移：0x42000（固定）
- 这是自动的，由设备配置定义

## 💡 解决方案

### 方案A：标签页布局（推荐）✅
```
┌─────────────────────────────────────────┐
│ [基本烧录] [高级功能] [串口监视] [设置] │
├─────────────────────────────────────────┤
│                                         │
│  当前标签页的内容                        │
│  （一次只显示一个功能区）                │
│                                         │
└─────────────────────────────────────────┘
```

**优点**：
- 每个标签页内容清晰
- 不会出现显示不全的问题
- 功能分类明确
- 适应任何分辨率

**标签页划分**：
1. **基本烧录**：固件文件、端口、完整烧录
2. **高级功能**：单独烧SBL、单独烧App、固件分析
3. **串口监视**：COM3/COM4监视器
4. **端口管理**：端口测试、释放、扫描

### 方案B：可折叠面板
每个功能区可以折叠/展开

**缺点**：
- 还是在一个页面
- 可能还是显示不全

### 方案C：主界面+子窗口
主界面只有基本功能，其他功能弹出独立窗口

**缺点**：
- 窗口太多，管理混乱

## 🎨 v1.0.7 设计（标签页方案）

### 标签页1：基本烧录 🚀
```
┌─────────────────────────────────────┐
│ 📁 固件文件                          │
│   SBL: ✅ 已找到 (130KB)            │
│   App: ✅ 已找到 (219KB)            │
│                                     │
│ 🔌 端口设置                          │
│   烧录端口(COM3): [下拉框]           │
│   调试端口(COM4): [下拉框]           │
│                                     │
│ ⏱️ 超时设置                          │
│   SBL: 120秒                        │
│   App: 180秒                        │
│   完整: 300秒                       │
│                                     │
│ 🚀 开始烧录                          │
│   [完整烧录 (SBL+App)]  ← 大按钮    │
│                                     │
│ 📝 烧录日志                          │
│   [日志输出区域]                     │
└─────────────────────────────────────┘
```

### 标签页2：高级功能 🔧
```
┌─────────────────────────────────────┐
│ 🎯 选择性烧录                        │
│                                     │
│   [🔧 仅烧录SBL]                    │
│   适用：SBL损坏或升级               │
│   地址：0x2000                      │
│                                     │
│   [📱 仅烧录App]                    │
│   适用：应用更新（SBL已存在）        │
│   地址：0x42000                     │
│                                     │
│ 💡 何时只烧录App？                   │
│   ✓ 板子已有SBL                     │
│   ✓ 只修改了应用代码                 │
│   ✓ SBL工作正常                     │
│                                     │
│ 🔍 固件分析                          │
│   [分析SBL固件]                     │
│   [分析App固件]                     │
│                                     │
│ 📋 Flash布局信息                    │
│   SBL区域: 0x02000 - 0x41FFF       │
│   App区域: 0x42000 - 0x2FFFFF       │
└─────────────────────────────────────┘
```

### 标签页3：串口监视 📡
```
┌─────────────────────────────────────┐
│ 📺 COM3监视器（烧录端口）            │
│   [监视窗口]                         │
│   [暂停][清空][Hex/Text]            │
│                                     │
│ 📺 COM4监视器（调试端口）            │
│   [监视窗口]                         │
│   [暂停][清空][Hex/Text]            │
└─────────────────────────────────────┘
```

### 标签页4：端口管理 🔧
```
┌─────────────────────────────────────┐
│ 🔍 端口测试                          │
│   [测试COM3]  [测试COM4]            │
│                                     │
│ 🔄 端口扫描                          │
│   [刷新端口列表]                     │
│                                     │
│ 🔓 端口释放                          │
│   [释放所有端口]                     │
│                                     │
│ 📊 端口状态                          │
│   COM3: ✅ 可用                     │
│   COM4: ✅ 可用                     │
└─────────────────────────────────────┘
```

## 📊 烧录地址说明

### Flash布局（AWRL6844）
```
0x00000 ┌─────────────────┐
        │  Vector Table    │
0x02000 ├─────────────────┤ ← SBL起始地址（自动）
        │  SBL Bootloader │
        │  (100-200KB)    │
0x42000 ├─────────────────┤ ← App起始地址（自动）
        │  Application    │
        │  (150-1784KB)   │
0x2FFFFF└─────────────────┘
```

### 自动处理
- 地址由设备配置自动确定
- 用户无需手动输入
- SBL固定0x2000
- App固定0x42000

## 🔄 烧录决策树

```
开始烧录
    │
    ├─ 首次烧录？
    │   └─ 是 → 必须完整烧录（SBL+App）
    │
    ├─ SBL是否损坏？
    │   └─ 是 → 仅烧录SBL
    │
    ├─ 只修改了App代码？
    │   └─ 是 → 仅烧录App（推荐）
    │
    └─ 不确定？
        └─ 完整烧录（最安全）
```

## 📝 实现清单

### v1.0.7更新内容
- [ ] 引入ttk.Notebook实现标签页
- [ ] 重构界面为4个标签页
- [ ] 在"高级功能"页添加使用说明
- [ ] 添加烧录决策提示
- [ ] 优化窗口最小尺寸为1000x700
- [ ] 更新版本号和文档

### 技术要点
```python
# 使用ttk.Notebook
notebook = ttk.Notebook(root)
tab1 = tk.Frame(notebook)
tab2 = tk.Frame(notebook)
notebook.add(tab1, text="基本烧录")
notebook.add(tab2, text="高级功能")
```

## ✅ 优势总结

1. **显示完整**：任何分辨率都能看到所有功能
2. **布局清晰**：功能分类明确
3. **操作简单**：常用功能在第一个标签
4. **扩展性好**：未来添加功能只需增加标签页
5. **用户友好**：有明确的使用提示和说明

---

**结论**：采用标签页布局方案实现v1.0.7 ✅
