# 🎯 flash_tool.py v1.0.4 更新说明

**更新日期**: 2025-12-15  
**版本**: v1.0.4  
**更新人**: Benson@Wisefido

---

## 📋 更新内容

### 1. 🎯 设备型号显示

**功能描述**：
- 启动时显示当前使用的设备型号：**AWRL6844EVM**
- 界面顶部新增设备信息栏，包含：
  - 设备名称：AWRL6844 评估板
  - 设备系列：xWRL684x
  - SDK版本：MMWAVE_L_SDK_06_01_00_01
  - 设备描述：60GHz毫米波雷达评估板

**实现方式**：
```python
# 新增设备信息栏（蓝色背景）
device_frame = tk.Frame(self.root, bg="#3498db", height=80)
# 显示设备型号和详细信息
tk.Label(text=f"🎯 当前设备: {self.device_config['display_name']}")
```

---

### 2. 🔄 多设备支持架构

**架构设计**：

创建了 `DEVICE_CONFIGS` 字典，支持多设备配置：

```python
DEVICE_CONFIGS = {
    "AWRL6844EVM": {
        "name": "AWRL6844EVM",
        "display_name": "AWRL6844 评估板",
        "series": "xWRL684x",
        "tool_exe": "arprog_cmdline_6844.exe",
        "sbl_name": "sbl.release.appimage",
        "app_name": "hello_world_system.release.appimage",
        "sbl_offset": 0x2000,
        "app_offset": 0x42000,
        "timeout_sbl": 120,
        "timeout_app": 180,
        "sdk_path": "C:\\ti\\MMWAVE_L_SDK_06_01_00_01",
        "available": True,  # 当前可用
        "description": "60GHz毫米波雷达评估板，支持人体检测、姿态识别等应用"
    },
    "AWRL6432EVM": {
        # 预留配置（未来实现）
        "available": False
    },
    "IWR6843EVM": {
        # 预留配置（未来实现）
        "available": False
    }
}
```

**支持的设备**：

| 设备型号 | 状态 | 说明 |
|---------|------|------|
| **AWRL6844EVM** | ✅ 当前可用 | 60GHz毫米波雷达评估板 |
| AWRL6432EVM | 🚧 预留 | 低功耗毫米波雷达（未来支持） |
| IWR6843EVM | 🚧 预留 | 集成MCU的毫米波雷达（未来支持） |

---

### 3. 📋 设备选择器界面

**功能描述**：
- GUI中新增"🔄 切换设备"按钮
- 点击后弹出设备选择对话框
- 显示所有可用和预留设备
- 当前设备标记为 ✅
- 未实现设备标记为 🚧

**界面特性**：
- 单选按钮选择设备
- 显示设备详细信息（系列、描述）
- 可用设备可选择，未实现设备灰显
- 提示切换后需重启工具

**实现方法**：
```python
def show_device_selector(self):
    """显示设备选择器对话框"""
    # 创建对话框窗口
    dialog = tk.Toplevel(self.root)
    # 列出所有设备配置
    for device_name, config in DEVICE_CONFIGS.items():
        # 创建单选按钮和设备信息
        # 根据 available 状态启用/禁用
```

---

### 4. ⚙️ 自动适配机制

**功能描述**：
根据选择的设备自动适配：
- 烧录工具路径（arprog_cmdline_XXXX.exe）
- 固件文件名称
- Flash地址偏移
- 超时时间设置
- SDK路径

**实现代码**：
```python
def __init__(self, root, device_name: str = DEFAULT_DEVICE):
    self.device_name = device_name
    self.device_config = DEVICE_CONFIGS[device_name]
    
    # 自动适配路径
    self.arprog_exe = self.tools_dir / self.device_config["tool_exe"]
    self.sbl_image = self.sbl_dir / self.device_config["sbl_name"]
    self.app_image = self.app_dir / self.device_config["app_name"]
    
    # 自动适配参数
    self.SBL_OFFSET = self.device_config["sbl_offset"]
    self.APP_OFFSET = self.device_config["app_offset"]
```

---

### 5. 🖥️ 命令行参数支持

**使用方法**：

```bash
# 默认启动（AWRL6844EVM）
python flash_tool.py

# 指定设备启动
python flash_tool.py --device AWRL6844EVM
python flash_tool.py --device AWRL6432EVM  # 会提示设备不可用

# 查看帮助
python flash_tool.py --help
```

**帮助信息**：
```
usage: flash_tool.py [-h] [--device {AWRL6844EVM,AWRL6432EVM,IWR6843EVM}]

TI毫米波雷达固件烧录工具

options:
  -h, --help            show this help message and exit
  --device {AWRL6844EVM,AWRL6432EVM,IWR6843EVM}
                        选择设备型号（默认：AWRL6844EVM）
```

---

## 🎨 界面变化

### 更新前（v1.0.3）
```
┌─────────────────────────────────────┐
│ AWRL6844 固件烧录工具 v1.0.3        │
├─────────────────────────────────────┤
│ 文件选择...                          │
│ 端口管理...                          │
│ ...                                  │
```

### 更新后（v1.0.4）
```
┌─────────────────────────────────────┐
│ 🎯 当前设备: AWRL6844 评估板    🔄   │ ← 新增设备信息栏
│ 系列: xWRL684x | SDK: MMWAVE_L...   │
│ 60GHz毫米波雷达评估板...             │
├─────────────────────────────────────┤
│ AWRL6844 评估板 固件烧录工具 v1.0.4 │
├─────────────────────────────────────┤
│ 文件选择...                          │
│ 端口管理...                          │
│ ...                                  │
```

---

## 📝 代码变更统计

### 新增内容
- ✅ 设备配置字典：`DEVICE_CONFIGS`（3个设备）
- ✅ 默认设备常量：`DEFAULT_DEVICE`
- ✅ 设备选择器方法：`show_device_selector()`
- ✅ 命令行参数解析（argparse）
- ✅ 设备信息显示组件（80px高度）

### 修改内容
- 🔄 `__init__` 方法：添加 `device_name` 参数
- 🔄 窗口高度：780px → 820px（容纳设备信息栏）
- 🔄 窗口标题：包含设备名称
- 🔄 欢迎日志：显示设备系列和SDK版本
- 🔄 文件路径：从设备配置动态读取

### 行数统计
- v1.0.3: 1757行
- v1.0.4: ~2050行（+293行）

---

## 🧪 测试验证

### 测试项目

- [x] 默认启动（AWRL6844EVM）
- [x] 命令行参数 `--help` 正常工作
- [x] 设备信息栏显示正确
- [x] 设备选择器弹窗正常
- [x] 切换设备按钮可用
- [x] 未实现设备提示正确
- [ ] GUI功能完整测试（待执行）

### 命令行测试结果

```bash
$ python flash_tool.py --help
usage: flash_tool.py [-h] [--device {AWRL6844EVM,AWRL6432EVM,IWR6843EVM}]

TI毫米波雷达固件烧录工具

options:
  -h, --help            show this help message and exit
  --device {AWRL6844EVM,AWRL6432EVM,IWR6843EVM}
                        选择设备型号（默认：AWRL6844EVM）
```

✅ 测试通过

---

## 🚀 未来扩展计划

### 短期计划
- [ ] 完整实现 AWRL6432EVM 支持
- [ ] 完整实现 IWR6843EVM 支持
- [ ] 添加设备自动检测功能

### 长期计划
- [ ] 支持更多TI雷达型号
- [ ] 设备配置文件外部化（JSON/YAML）
- [ ] 设备固件版本管理
- [ ] 多设备并行烧录

---

## 📚 文档更新

### 更新的文档

1. **flash_tool.py 头部注释**
   - 更新版本号 v1.0.4
   - 添加更新日志
   - 标题改为"TI毫米波雷达固件烧录工具"

2. **5-Scripts/README.md**
   - 更新版本号和新功能说明
   - 添加设备支持列表
   - 更新使用方法（命令行参数）
   - 更新使用流程（设备信息栏）

3. **本文档**
   - 详细记录v1.0.4所有变更

---

## 💡 技术亮点

### 1. 可扩展架构
通过配置字典实现多设备支持，添加新设备只需：
```python
DEVICE_CONFIGS["新设备"] = {
    "name": "新设备型号",
    # ... 其他配置
}
```

### 2. 命令行友好
支持 `--help`、`--device` 参数，方便自动化脚本调用

### 3. 界面信息丰富
设备信息栏清晰展示当前配置，避免误操作

### 4. 未来兼容性
预留3个设备配置槽位，为未来扩展做好准备

---

## ✅ 验收标准

- [x] 启动时显示 AWRL6844EVM 设备信息
- [x] 设备选择器可正常弹出
- [x] 命令行参数工作正常
- [x] 代码结构清晰，易于扩展
- [x] 文档更新完整
- [ ] 完整功能测试（待执行）

---

**更新完成！** 🎉
