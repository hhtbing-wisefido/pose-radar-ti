# 🎯 Pose and Fall Detection 移植到 AWRL6844 项目规划

**创建日期**: 2025-12-09  
**项目目标**: 将 IWRL6432 的 Pose_And_Fall_Detection Demo 完整移植到 AWRL6844EVM 平台

---

## 📋 项目概况

### 源平台特性 (IWRL6432BOOST)
- **芯片**: IWRL6432 (60GHz 单芯片雷达)
- **天线配置**: 需要侧向安装以获得更好的仰角分辨率
- **核心**: ARM Cortex-M4F
- **功能**: AI姿态识别 + 跌倒检测
- **分类**: 5种姿态 (standing, sitting, lying, walking, falling)

### 目标平台特性 (AWRL6844EVM)
- **芯片**: AWRL6844 (60GHz 车规级雷达)
- **天线配置**: 4T4R (4发4收)
- **核心**: ARM Cortex-R4F (主处理器) + C674x DSP
- **优势**: 更强的处理能力，更多天线阵元
- **挑战**: 架构差异较大

---

## 🔍 关键硬件差异分析

### 1. 芯片架构对比

| 特性 | IWRL6432 | AWRL6844 |
|------|----------|----------|
| **主处理器** | ARM Cortex-M4F | ARM Cortex-R4F |
| **DSP** | 无 | C674x DSP |
| **天线** | 集成天线 | 4T4R 外部天线 |
| **内存** | 有限 | 更大 |
| **功耗** | 低功耗 (<2mW) | 车规级 (更高功耗) |
| **SDK** | MMWAVE-L-SDK | MMWAVE-SDK |

### 2. 软件架构差异

**IWRL6432 架构**:
```
单核 M4F 架构
├── 雷达处理 (在 M4F 上)
├── AI 推理 (TVM 模型在 M4F 上)
└── 数据输出 (UART)
```

**AWRL6844 架构**:
```
多核异构架构
├── MSS (Cortex-R4F) - 主系统控制
├── DSS (C674x DSP) - 雷达信号处理
└── BSS - 射频前端控制
```

### 3. AI 模型部署差异

| 方面 | IWRL6432 | AWRL6844 |
|------|----------|----------|
| **推理位置** | M4F 核心 | R4F 或 DSP |
| **模型格式** | TVM (M4F 优化) | 需重新编译 |
| **内存限制** | 更严格 | 更宽松 |
| **推理速度** | 受限 | 潜在更快 |

---

## 🎯 移植任务分解

### Phase 1: 环境准备与分析 ✅
- [x] 复制 Pose_And_Fall_Detection 到知识库
- [x] 分析硬件和软件架构差异
- [x] 创建项目代码目录结构
- [x] 制定移植计划

### Phase 2: 雷达配置适配 (Week 1-2)
- [ ] **任务 2.1**: 分析 IWRL6432 的雷达配置参数
  - 频率范围、带宽、chirp 配置
  - 帧率、采样率
  - 天线配置
  
- [ ] **任务 2.2**: 转换为 AWRL6844 配置
  - 利用 4T4R 天线优势
  - 优化 chirp 配置
  - 调整帧结构
  
- [ ] **任务 2.3**: 生成 AWRL6844 的 .cfg 配置文件
  - 使用 mmWave Studio 或 visualizer
  - 验证配置有效性

### Phase 3: 固件框架移植 (Week 2-3)
- [ ] **任务 3.1**: 搭建 AWRL6844 基础框架
  - 从 MMWAVE-SDK 的 In-Cabin Demo 入手
  - 配置 MSS + DSS 双核通信
  - 建立数据流管道
  
- [ ] **任务 3.2**: 移植雷达处理算法
  - Range FFT
  - Doppler FFT  
  - CFAR 检测
  - 点云生成
  
- [ ] **任务 3.3**: 移植跟踪算法
  - People tracking 算法
  - 高度估计
  - 速度估计

### Phase 4: AI 模型移植 (Week 3-4)
- [ ] **任务 4.1**: 分析现有 AI 模型
  - 输入特征 (22个特征)
  - 模型架构 (PyTorch)
  - 输出分类 (5类)
  
- [ ] **任务 4.2**: 重新编译模型
  - 使用 TI Neural Network Compiler
  - 针对 R4F 或 DSP 优化
  - 验证模型精度
  
- [ ] **任务 4.3**: 集成推理引擎
  - 在 MSS (R4F) 上运行推理
  - 优化内存使用
  - 性能测试

### Phase 5: 系统集成与测试 (Week 4-5)
- [ ] **任务 5.1**: 端到端集成
  - 雷达数据 → 特征提取 → AI 推理 → 结果输出
  - UART 数据流格式
  - 与 Visualizer 兼容
  
- [ ] **任务 5.2**: 功能测试
  - 5种姿态分类准确度
  - 跌倒检测灵敏度
  - 实时性能 (帧率)
  
- [ ] **任务 5.3**: 优化与调试
  - 性能优化
  - 功耗优化
  - 稳定性测试

### Phase 6: 文档与部署 (Week 5-6)
- [ ] **任务 6.1**: 编写技术文档
  - 移植技术报告
  - 用户使用手册
  - 配置参数说明
  
- [ ] **任务 6.2**: 创建示例和教程
  - 编译指南
  - 烧录指南
  - 可视化使用
  
- [ ] **任务 6.3**: 开源发布准备
  - 代码整理
  - License 声明
  - GitHub 仓库

---

## 📂 项目目录结构

```
project-code/pose-fall-awrl6844/
├── README.md                    # 项目说明
├── docs/                        # 文档
│   ├── migration-guide.md       # 移植指南
│   ├── hardware-setup.md        # 硬件配置
│   └── user-manual.md           # 用户手册
├── firmware/                    # 固件源码
│   ├── mss/                     # MSS (R4F) 代码
│   │   ├── main.c
│   │   ├── ai_inference.c       # AI 推理
│   │   └── data_process.c       # 数据处理
│   ├── dss/                     # DSS (DSP) 代码
│   │   ├── dss_main.c
│   │   └── radar_process.c      # 雷达信号处理
│   └── common/                  # 共享代码
│       ├── pose_detection.h
│       └── tracking.c
├── config/                      # 配置文件
│   ├── awrl6844_pose.cfg        # 雷达配置
│   └── chirp_config.lua         # Chirp 参数
├── model/                       # AI 模型
│   ├── pose_model.onnx          # ONNX 模型
│   ├── pose_model_r4f.a         # R4F 编译库
│   └── training/                # 训练脚本
│       ├── train.py
│       └── dataset/
├── tools/                       # 工具脚本
│   ├── flash.py                 # 烧录工具
│   ├── visualizer_config.py     # 可视化配置
│   └── data_collector.py        # 数据采集
├── tests/                       # 测试用例
│   ├── unit_tests/
│   └── integration_tests/
└── build/                       # 编译输出
    ├── mss.out
    ├── dss.out
    └── appimage/
```

---

## 🔧 技术难点与解决方案

### 难点 1: 双核通信
**问题**: AWRL6844 需要 MSS 和 DSS 协同工作  
**解决方案**:
- 使用 Mailbox 机制进行核间通信
- 参考 In-Cabin Demo 的架构
- 使用共享内存传递大数据

### 难点 2: AI 模型编译
**问题**: IWRL6432 的 M4F 模型不能直接用  
**解决方案**:
- 使用 TI Neural Network Compiler 重新编译
- 目标平台选择 Cortex-R4F
- 可能需要调整模型量化参数

### 难点 3: 天线配置差异
**问题**: 4T4R 配置与单芯片不同  
**解决方案**:
- 利用更多天线提升性能
- 优化 MIMO 配置
- 可能需要重新训练模型以适应新数据

### 难点 4: 功耗与性能平衡
**问题**: AWRL6844 功耗较高  
**解决方案**:
- 使用低功耗模式
- 优化帧率和 chirp 配置
- 动态调整处理负载

---

## 📊 关键性能指标 (KPI)

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| **姿态识别准确率** | >90% | 实际测试 100 次 |
| **跌倒检测灵敏度** | >95% | 跌倒测试 50 次 |
| **误报率** | <5% | 正常活动 100 次 |
| **实时性** | <100ms | 端到端延迟测量 |
| **帧率** | ≥10 fps | 系统输出帧率 |
| **功耗** | <100mW | 平均功耗测量 |
| **检测距离** | 3-5 米 | 不同距离测试 |

---

## 🚀 里程碑时间表

| 阶段 | 时间 | 交付物 | 状态 |
|------|------|--------|------|
| **Phase 1** | Week 1 | 环境准备与分析文档 | ✅ 完成 |
| **Phase 2** | Week 1-2 | AWRL6844 雷达配置文件 | 🔜 待开始 |
| **Phase 3** | Week 2-3 | 固件框架原型 | 🔜 待开始 |
| **Phase 4** | Week 3-4 | AI 模型移植完成 | 🔜 待开始 |
| **Phase 5** | Week 4-5 | 系统集成与测试 | 🔜 待开始 |
| **Phase 6** | Week 5-6 | 文档与部署 | 🔜 待开始 |

---

## 📚 参考资料

### TI 官方文档
1. **MMWAVE-SDK 文档**:
   - `知识库/C_ti_link/mmwave_sdk_**/docs/`
   - 重点: In-Cabin Demos User Guide

2. **AWRL6844 技术文档**:
   - Datasheet
   - Technical Reference Manual
   - Programming Guide

3. **AI 模型部署**:
   - TI Neural Network Compiler Guide
   - TVM Runtime Guide
   - Edge AI Studio Documentation

### 本地资源
- **源代码**: `知识库/Pose_And_Fall_Detection/`
- **配置示例**: `知识库/雷达模块/RADAR-TOOLBOX/.../config/`
- **烧录工具**: `temp/direct_flash.py`

### 在线资源
- [TI E2E Forum - mmWave Sensors](https://e2e.ti.com/support/sensors-group/sensors/f/sensors-forum)
- [TI Resource Explorer](https://dev.ti.com/tirex/)
- [GitHub - TI mmWave Examples](https://github.com/topics/ti-mmwave)

---

## ⚠️ 风险评估

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| **架构差异导致移植困难** | 高 | 高 | 深入研究 SDK，参考类似 Demo |
| **AI 模型性能下降** | 中 | 高 | 保留重新训练的选项 |
| **硬件资源不足** | 低 | 中 | 优化算法，减少内存使用 |
| **实时性能不达标** | 中 | 高 | 优化代码，使用 DSP 加速 |
| **功耗超标** | 中 | 中 | 使用低功耗模式，优化配置 |

---

## 🎉 预期成果

1. **技术成果**:
   - ✅ 完整的 AWRL6844 Pose and Fall Detection Demo
   - ✅ 性能优于或等于 IWRL6432 版本
   - ✅ 完整的源代码和文档

2. **学习收获**:
   - ✅ 掌握 AWRL6844 双核开发
   - ✅ 理解 AI 模型部署流程
   - ✅ 积累雷达信号处理经验

3. **实际应用**:
   - ✅ 可用于老人看护系统
   - ✅ 可集成到智能家居
   - ✅ 为其他移植项目提供参考

---

## 📞 联系与支持

- **TI E2E Forum**: 技术问题咨询
- **GitHub Issues**: Bug 报告和功能请求
- **项目文档**: 详细的技术文档和示例

---

**最后更新**: 2025-12-09  
**项目状态**: 🚧 Phase 1 完成，Phase 2 准备中
