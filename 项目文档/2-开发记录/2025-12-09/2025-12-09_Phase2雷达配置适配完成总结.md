# Phase 2: 雷达配置适配 - 完成总结

**完成日期**: 2025-12-09  
**状态**: ✅ 已完成  
**进度**: 100%

---

## 📋 任务目标

将IWRL6432雷达配置适配到AWRL6844EVM开发板，生成128个range bins用于AI姿态检测模型。

---

## ✅ 主要成果

### 1. 成功配置参数

**最终工作配置**（`awrl6844_pose_detection_v1_conservative.cfg`）：

```cfg
sensorStop 0
channelCfg 153 255 0
chirpComnCfg 8 0 0 128 1 13.1 3
chirpTimingCfg 6 63 0 160 58
adcDataDitherCfg 1
frameCfg 64 0 1358 1 100 0
gpAdcMeasConfig 0 0
guiMonitor 1 1 0 0 0 1
cfarProcCfg 0 2 8 4 3 0 9.0 0
cfarProcCfg 1 2 4 2 2 1 9.0 0
cfarFovCfg 0 0.25 9.0
cfarFovCfg 1 -20.16 20.16
aoaProcCfg 64 64
aoaFovCfg -60 60 -60 60
clutterRemoval 0
factoryCalibCfg 1 0 44 2 0x1ff000
runtimeCalibCfg 1
antGeometryBoard xWRL6844EVM
lowPowerCfg 0
sensorStart 0 0 0 0
```

### 2. 关键参数发现

| 参数 | 值 | 说明 |
|------|---|------|
| **chirpComnCfg[1]** | **8** | ⚠️ 关键！不是10000 |
| **chirpComnCfg[4]** | **128** | ADC采样点数 |
| **chirpComnCfg[5]** | **1** | 必须是1（MIMO模式） |
| **frameCfg chirps** | **64** | 与256采样点配置保持一致 |
| **frameCfg period** | **100 ms** | 帧周期 |

### 3. 验证结果

- ✅ 传感器启动成功：`sensorStart 0 0 0 0` → `Done`
- ✅ 数据持续输出：平均 173 字节/帧
- ✅ Range bins验证：128 bins（256采样点是270字节/帧）
- ✅ 数据稳定性：5秒内接收50帧，无丢帧

---

## 🔍 问题排查过程

### 问题1: chirpComnCfg参数错误

**错误配置**：
```cfg
chirpComnCfg 10000 0 0 128 0 13.1 3  ❌
```

**错误现象**：
- 所有配置命令返回 `Done`
- `sensorStart` 返回错误：`Error: mmWave config failed [Error code -203685886]`
- COM4无数据输出

**解决方案**：
```cfg
chirpComnCfg 8 0 0 128 1 13.1 3  ✅
```

**关键变化**：
- 参数1: `10000` → `8`
- 参数5: `0` → `1`

### 问题2: frameCfg参数不匹配

**错误尝试**：
```cfg
frameCfg 4 0 800 1 800 0  ❌
```

**解决方案**：保持与TI官方256采样点配置相同的frameCfg
```cfg
frameCfg 64 0 1358 1 100 0  ✅
```

### 问题3: 工具兼容性

- ❌ Industrial Visualizer - 配置文件格式不兼容
- ✅ Body and Chassis Visualizer - 完全兼容
- ✅ Python串口脚本 - 验证工具正常

---

## 📊 性能指标

| 指标 | 256采样点（参考） | 128采样点（目标） |
|------|-----------------|-----------------|
| 数据包大小 | ~270 字节/帧 | ~173 字节/帧 |
| Range bins | 256 | 128 ✅ |
| 帧周期 | 100 ms | 100 ms |
| Chirp数量 | 64 | 64 |
| 数据稳定性 | ✅ 稳定 | ✅ 稳定 |

---

## 📁 交付物

### 配置文件
- `project-code/pose-fall-awrl6844/config/awrl6844_pose_detection_v1_conservative.cfg`
  - ✅ 已验证工作
  - ✅ 生成128 range bins
  - ✅ 数据稳定输出

### 配置说明
- `project-code/pose-fall-awrl6844/config/README.md`
  - ✅ 使用方法
  - ✅ 参数说明
  - ✅ 注意事项

### 验证工具
- `project-code/pose-fall-awrl6844/tools/monitor_radar_data.py`
  - ✅ 数据监控脚本
  - ✅ 可用于调试

---

## 🎯 下一步计划（Phase 3）

### 固件移植
1. 分析IWRL6432固件代码结构
2. 适配AWRL6844 SDK
3. 移植数据处理流程
4. 编译和烧录验证

### 准备工作
- [x] 雷达配置完成
- [x] 128 range bins验证
- [ ] SDK环境搭建
- [ ] 固件代码分析

---

## 📝 经验教训

### 成功因素
1. ✅ 使用TI官方配置作为基准
2. ✅ 逐步修改参数，记录每次变化
3. ✅ 用Python脚本验证，避免GUI复杂性
4. ✅ 通过数据包大小快速验证结果

### 注意事项
1. ⚠️ `chirpComnCfg`参数1和参数5必须正确
2. ⚠️ 不能随意修改`frameCfg`参数
3. ⚠️ 配置失败后需要复位硬件（按RST）
4. ⚠️ 工具选择很重要（Body and Chassis Visualizer最可靠）

### 避免的错误
1. ❌ 不要随意猜测参数值（如10000）
2. ❌ 不要同时修改多个参数
3. ❌ 不要跳过硬件验证步骤
4. ❌ 不要依赖错误的文档或假设

---

## 📚 参考资料

- TI官方配置：`知识库/雷达模块/RADAR-TOOLBOX/.../6844_profile_4T4R_tdm.cfg`
- AWRL6844固件版本：xWRL684x MMW Demo 06.00.05.01
- 开发板：AWRL6844EVM
- 串口配置：COM3 (115200) CLI, COM4 (921600) Data

---

**Phase 2任务完成！** 🎉
