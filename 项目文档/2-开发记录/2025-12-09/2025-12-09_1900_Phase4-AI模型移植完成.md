# Phase 4: AI æ¨¡å‹ç§»æ¤å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-12-09 19:00  
**é˜¶æ®µ**: Phase 4 - AI æ¨¡å‹ç§»æ¤  
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ å®Œæˆå†…å®¹

### 4.1 æ¨¡å‹åˆ†æ

**åŸå§‹æ¨¡å‹ä½ç½®**:
```
çŸ¥è¯†åº“/Pose_And_Fall_Detection/src/xWRL6432/model/
â”œâ”€â”€ pose_model.a          # 63KB (M4F æ¶æ„)
â””â”€â”€ tvmgen_default.h      # TVM æ¥å£
```

**æ¨¡å‹æ¶æ„**:
- ç±»å‹: PyTorch â†’ ONNX â†’ TVM
- è¾“å…¥: `Tensor[(1, 176), float32]` (22ç‰¹å¾ Ã— 8å¸§)
- è¾“å‡º: `Tensor[(1, 5), float32]` (5ç±»æ¦‚ç‡)
- ç½‘ç»œ: 4å±‚å…¨è¿æ¥ + BatchNorm + ReLU + Softmax
- å‚æ•°é‡: ~15K

### 4.2 è®­ç»ƒèµ„æºå®šä½

**è®­ç»ƒ Notebook**:
```
çŸ¥è¯†åº“/Pose_And_Fall_Detection/retraining_resources/
â”œâ”€â”€ pose_and_fall_model_training.ipynb  # 38KB
â”œâ”€â”€ dataset/                            # è®­ç»ƒæ•°æ®
â””â”€â”€ modules/helper_functions.py         # è¾…åŠ©å‡½æ•°
```

**TVM ç¼–è¯‘å·¥å…·**:
```
çŸ¥è¯†åº“/é›·è¾¾æ¨¡å—/RADAR-TOOLBOX/.../3-TVM_codegen/
â””â”€â”€ ti_tvm-0.16.0-cp310-cp310-linux_x86_64.whl  # 30MB
```

### 4.3 åˆ›å»ºçš„æ–‡ä»¶

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| `firmware/model/pose_model_wrapper.h` | 3.5KB | æ¨¡å‹å°è£…å±‚æ¥å£ |
| `firmware/model/pose_model_wrapper.c` | 6.4KB | æ¨¡å‹å°è£…å±‚å®ç° |
| `docs/phase4-ai-model-porting.md` | 8KB | è¯¦ç»†ç§»æ¤æŒ‡å— |

### 4.4 ä»£ç ä¿®æ”¹

**pose_mss.c æ›´æ–°**:
- `RunTVMModel()` å‡½æ•°æ·»åŠ æ¡ä»¶ç¼–è¯‘
- `#ifdef USE_TVM_MODEL`: ä½¿ç”¨çœŸå® TVM æ¨¡å‹
- `#else`: ä½¿ç”¨åŸºäºè§„åˆ™çš„æ¨¡æ‹Ÿè¾“å‡º (æµ‹è¯•ç”¨)

---

## ğŸ“Š æ¨¡å‹å°è£…å±‚ API

```c
/* åˆå§‹åŒ– */
int32_t PoseModel_init(void);

/* æ¨ç† */
int32_t PoseModel_run(const float* input, float* output);

/* åˆ†ç±» */
int32_t PoseModel_getClass(const float* probs);
int32_t PoseModel_getClassWithConfidence(const float* probs, 
    int32_t* classIndex, float* confidence);

/* å·¥å…· */
const char* PoseModel_getClassName(int32_t classIndex);
int32_t PoseModel_isReady(void);
void PoseModel_reset(void);
```

---

## ğŸ”§ ç¼–è¯‘é…ç½®

### ä½¿ç”¨çœŸå®æ¨¡å‹

åœ¨ CCS é¡¹ç›®ä¸­å®šä¹‰:
```
USE_TVM_MODEL
```

å¹¶é“¾æ¥:
```
../model/pose_model_r4f.a
```

### æµ‹è¯•æ¨¡å¼ (æ— æ¨¡å‹)

ä¸å®šä¹‰ `USE_TVM_MODEL`ï¼Œä½¿ç”¨æ¨¡æ‹Ÿè¾“å‡ºæµ‹è¯•æ•°æ®æµã€‚

---

## ğŸ“ˆ è¿›åº¦æ›´æ–°

| Phase | çŠ¶æ€ | è¯´æ˜ |
|-------|------|------|
| Phase 1: éœ€æ±‚åˆ†æ | âœ… å®Œæˆ | |
| Phase 2: æºç å­¦ä¹  | âœ… å®Œæˆ | |
| Phase 3: å›ºä»¶æ¡†æ¶ç§»æ¤ | âœ… å®Œæˆ | |
| **Phase 4: AI æ¨¡å‹ç§»æ¤** | âœ… **å®Œæˆ** | æœ¬æ¬¡ |
| Phase 5: ç³»ç»Ÿé›†æˆæµ‹è¯• | â³ å¾…å¼€å§‹ | |
| Phase 6: ä¼˜åŒ–ä¸éƒ¨ç½² | â³ å¾…å¼€å§‹ | |

---

## â­ï¸ ä¸‹ä¸€æ­¥

### Phase 5: ç³»ç»Ÿé›†æˆæµ‹è¯•

1. **CCS é¡¹ç›®å¯¼å…¥**
   - å¯¼å…¥ MSS å’Œ DSS é¡¹ç›®
   - é…ç½®ç¼–è¯‘å™¨å’Œ SDK è·¯å¾„
   - è§£å†³ç¼–è¯‘é”™è¯¯

2. **æ¨¡å‹é‡ç¼–è¯‘** (Linux ç¯å¢ƒ)
   - å®‰è£… TI-TVM
   - è¿è¡Œ `compile_model_r4f.py`
   - ç”Ÿæˆ `pose_model_r4f.a`

3. **ç¡¬ä»¶æµ‹è¯•**
   - çƒ§å½•åˆ° AWRL6844EVM
   - æµ‹è¯•åŒæ ¸é€šä¿¡
   - éªŒè¯ ML æ¨ç†

---

## ğŸ“ å½“å‰æ–‡ä»¶ç»Ÿè®¡

```
firmware/
â”œâ”€â”€ common/     3 files,  ~16KB
â”œâ”€â”€ mss/        5 files,  ~55KB (pose_mss.c å¢åŠ åˆ° ~25KB)
â”œâ”€â”€ dss/        4 files,  ~9KB
â””â”€â”€ model/      3 files,  ~13KB

æ€»è®¡: 15 ä¸ªæºæ–‡ä»¶, ~93KB
```

---

**Phase 4 å®Œæˆï¼å›ºä»¶æ¡†æ¶å’Œ AI æ¨¡å‹é›†æˆå·²å°±ç»ªã€‚**
