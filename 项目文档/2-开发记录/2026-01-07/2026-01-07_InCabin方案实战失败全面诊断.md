# 🔴 InCabin Demo方案实战失败 - 全面诊断报告

**日期**: 2026-01-07  
**状态**: 🔴 方案A失败，需重新决策  
**文档性质**: 开发记录 - 经验总结  
**关联文档**: 
- `08-AWRL6844雷达健康检测实现方案/02-方案确认.md` - 需修订
- `08-AWRL6844雷达健康检测实现方案/00-能力评估报告.md` - 需更新

---

## 📊 问题定位

### 当前状态

经过5天密集测试，**方案A（基于InCabin Demo扩展）**遇到无法克服的障碍：

| 测试轮次 | 日期 | 固件 | 配置 | 工具 | 结果 |
|---------|------|------|------|------|------|
| v1.0-1.2 | 01-06 | 自编译InCabin | CFAR K0=8.0 | SDK Visualizer | Points=0 ❌ |
| v1.3 | 01-07 | 自编译InCabin | CFAR K0=8.0 | SDK Visualizer | Points=0 ❌ |
| v1.4 | 01-07 | 自编译InCabin | CFAR K0=7.0(TI推荐) | SDK Visualizer | Points=0 ❌ |
| v1.5 | 01-07 | 自编译InCabin | CFAR K0=5.0(极低) | InCabin GUI | Points=0 ❌ |
| **标准Demo** | 01-06 | TI官方mmwave_demo | 标准配置 | SDK Visualizer | **✅ 工作正常** |

**关键对比**：
```
✅ 标准Demo → 点云数据正常
❌ InCabin Demo → 无点云数据（任何配置/任何工具）
```

### 根本原因诊断

#### 原因1: 相位校准缺失（概率70%）⭐

**问题**：
- InCabin Demo **依赖精确的天线相位校准**
- Capon 2D波束成形算法对相位误差极其敏感
- 当前配置使用**默认的校准参数**（未实际测量）

**TI文档要求**（Point Cloud Tuning Guide）：
> "Step 1: Perform phase calibration using DCA1000 or mmWave Studio"  
> "Apply calibration data to `compRangeBiasAndRxChanPhase` command"

**当前状态**：
```cfg
compRangeBiasAndRxChanPhase 0 1 0 1 0 1 0 1 0 -1 0 -1 0 -1 0 -1 0 1 0 1 0 1 0 1 0 -1 0 -1 0 -1 0 -1 0
                            ↑ 这些是默认值，不是实际测量值！
```

**为什么标准Demo不需要校准？**
- 标准Demo使用**DoA (Direction of Arrival)** 算法
- DoA对相位误差容忍度高
- InCabin使用**Capon算法**，精度要求高10倍

**验证方法**：
- 需要DCA1000数据采集卡（项目没有）
- 或使用mmWave Studio执行校准流程（需1-2天学习）

---

#### 原因2: TLV数据格式不兼容（概率20%）

**发现**：InCabin Demo使用**专有TLV格式**

| 数据类型 | 标准Demo | InCabin Demo | 影响 |
|---------|---------|--------------|------|
| 点云数据 | Type=1 | Type=3001 | SDK Visualizer无法识别 |
| Occupancy特征 | 无 | Type=3002 | InCabin独有 |
| Classification结果 | 无 | Type=1041 | InCabin独有 |

**详细分析**：见`06-SDK固件研究/InCabin与标准Demo数据格式对比.md`

**实际影响**：
- SDK Visualizer看不到InCabin的点云 → 正常
- 但InCabin GUI也看不到 → 说明**根本没产生点云数据**

**结论**：TLV格式是表象，相位校准才是根本原因

---

#### 原因3: 固件本身的bug（概率10%）

**测试**：
- ❌ 自编译InCabin固件 → 无点云
- 待测：TI官方预编译InCabin固件 → ?

**建议下一步测试**：
```
使用官方固件:
C:\ti\radar_toolbox_3_30_00_06\source\ti\examples\
  Automotive_InCabin_Security_and_Safety\AWRL6844_InCabin_Demos\
  prebuilt_binaries\demo_in_cabin_sensing_6844_system.release.appimage

如果官方固件也无点云 → InCabin Demo本身不适合我们的应用
```

---

## 💡 技术盲点反思

### 盲点1: 理论评估未考虑隐藏前置条件

**01-方案讨论文档说**：
> "方案A：基于InCabin Demo扩展 ⭐推荐"  
> "人存检测：⭐⭐⭐⭐⭐ 已有occupancyClassifier"  
> "工作量：⭐⭐⭐⭐⭐ 只需添加姿态/跌倒逻辑"  
> "预计工期：7.5天"

**实际情况**：
- ❌ InCabin需要**相位校准**（TI文档深处才提到）
- ❌ 相位校准需要**DCA1000硬件**或**mmWave Studio学习**
- ❌ 占用分类器需要**训练数据集**（车内场景）
- ❌ 我们的养老监测场景与车内场景差异大

**教训**：
- 理论分析要查找**所有前置条件**
- TI Quick Start Guide不等于完整实施指南
- 需要**小范围验证**再做方案选择

---

### 盲点2: SDK文档阅读方法错误

**错误流程**：
```
看到InCabin Demo → 看Quick Start → 编译成功 → 以为可以直接用
```

**正确流程应该是**：
```
1. Quick Start Guide（入门）
2. User Guide（完整文档）← 我们跳过了这步
3. Tuning Guide（调优指南）← 相位校准在这里
4. Application Note（应用笔记）
5. 源码阅读（实现细节）
```

**实际发现**：
- `mmWave_Demo_Tuning_Guide.pdf` 第一步就是**相位校准**
- 但Quick Start Guide里只字未提
- 导致我们跳过了关键步骤

---

### 盲点3: 未区分"Demo能跑"vs"Demo适合我们"

**两个不同的问题**：

| 问题 | InCabin Demo | 标准mmwave_demo |
|------|-------------|----------------|
| Demo能跑起来吗？ | ❌ 需校准，我们没做到 | ✅ 能跑 |
| Demo适合养老监测吗？ | ❓ 未知（车内场景） | ✅ 通用点云 |
| 有现成的人存检测吗？ | ✅ 有occupancyClassifier | ❌ 需自己实现 |
| 开发难度如何？ | 🔴 高（隐藏前置条件多） | 🟡 中（纯软件开发） |

**之前的错误**：
- 只看到InCabin"有人存检测" → 以为简单
- 没评估"InCabin是否适合室内养老场景"
- 没评估"隐藏的前置条件"

---

## 🔄 方案重新评估

### 方案对比矩阵（更新版）

| 维度 | 方案A: InCabin扩展 | 方案B: 标准Demo开发 | 方案C: IWR6843硬件 |
|------|------------------|-------------------|------------------|
| **基础能力** | ⚠️ 需相位校准 | ✅ 已验证可用 | ✅ 已验证可用 |
| **人存检测** | ✅ 现成算法（但跑不起来） | 🔧 需开发 | ✅ OOB Demo有 |
| **姿态检测** | 🔧 需开发 | 🔧 需开发 | ✅ 已有示例 |
| **跌倒检测** | 🔧 需开发 | 🔧 需开发 | ✅ 已有示例 |
| **生命体征** | ❌ 无 | ❌ 无 | ✅ Vital Signs Demo |
| **前置条件** | 🔴 需DCA1000/校准知识 | ✅ 无 | ✅ 无 |
| **场景适配度** | ⚠️ 车内 vs 室内（未知） | ✅ 通用 | ✅ 人体监测专用 |
| **技术风险** | 🔴 高（已失败5次） | 🟡 中 | 🟢 低 |
| **工期估算** | ⏱️ 2-3天深度调试 + 7天开发 | ⏱️ 2天人存 + 5天姿态跌倒 | ⏱️ 1天环境 + 3天集成 |
| **成功概率** | 🎲 40% | 🎲 85% | 🎲 95% |
| **推荐度** | ❌ **不推荐**（已证明困难） | ✅ **推荐**（稳妥路线） | ⭐ **最佳**（长期考虑） |

---

## 📋 建议的行动方案

### 立即行动（今天）

**选项1: 放弃InCabin，切换标准Demo路线** ✅ **强烈推荐**

**理由**：
1. 标准Demo已验证工作正常
2. 避免深陷相位校准泥潭
3. 人存检测可以用简单算法实现（点云聚类）
4. 7天内可完成人存+姿态+跌倒

**实施计划**：
```
Day 1: 基于标准Demo实现简单人存检测（点云数量判断）
Day 2: 添加运动检测（点云速度分析）
Day 3-5: 移植xWRL6432的姿态分类算法
Day 6: 添加跌倒检测状态机
Day 7: 集成测试
```

---

**选项2: 深度调试InCabin（2-3天）** ⚠️ **高风险**

**如果你坚持InCabin路线**，必须完成：

**Step 1: 测试TI官方预编译InCabin固件**（0.5天）
```powershell
# 烧录官方固件
$firmware = "C:\ti\radar_toolbox_3_30_00_06\source\ti\examples\" +
            "Automotive_InCabin_Security_and_Safety\AWRL6844_InCabin_Demos\" +
            "prebuilt_binaries\demo_in_cabin_sensing_6844_system.release.appimage"

python flash_tool.py -f $firmware -p COM10

# 使用TI官方配置测试
$config = "C:\ti\radar_toolbox_3_30_00_06\tools\visualizers\" +
          "AWRL6844_Incabin_GUI\src\chirpConfigs6844\cpd.cfg"

# 启动InCabin GUI测试
cd "C:\ti\radar_toolbox_3_30_00_06\tools\visualizers\AWRL6844_Incabin_GUI\src"
.\occupancy_demo_gui.exe
```

**结果判断**：
- ✅ 官方固件有点云 → 自编译固件有问题，重新编译
- ❌ 官方固件也无点云 → **InCabin不适合，立即切换标准Demo**

---

**Step 2: 学习并执行相位校准**（1-2天）

**需要的资源**：
1. mmWave Studio软件（已安装）
2. DCA1000数据采集卡（项目没有，可能需要购买）
3. TI Phase Calibration文档学习

**替代方案**：
- 如果没有DCA1000，使用mmWave Studio的Calibration功能
- 参考：`TI 低功耗毫米波雷达传感器中的校准 (Rev. B).md`

**校准步骤**：
```
1. 使用mmWave Studio连接EVM
2. 执行Calibration Wizard
3. 获取校准参数
4. 更新配置文件中的compRangeBiasAndRxChanPhase
5. 重新测试
```

---

**Step 3: 启用Range Profile监控**（0.5天）

**目的**：判断是否收到雷达回波

```cfg
# 修改配置文件
guiMonitor 1 1 1 1 0 1 1 1
%          ^ ^
%          | +-- rangeProfile启用
%          +---- pointCloud启用
```

**分析Range Profile**：
- 如果Range Profile平坦 → 雷达没收到反射（硬件/RF问题）
- 如果Range Profile有峰值但Points=0 → CFAR过滤问题

---

### 中期规划（1周内）

**如果选择标准Demo路线**：

1. **更新文档体系**
   - 修订`02-方案确认.md` → 改为方案B
   - 修订`03-实施目录大纲.md` → 基于标准Demo重新规划
   - 修订`00-能力评估报告.md` → 添加实战经验

2. **重新规划章节**
   ```
   第1章：环境搭建（✅ 已完成）
   第2章：标准Demo验证（✅ 已完成）
   第3章：人存检测实现（🔧 2天）
   第4章：姿态检测实现（🔧 3天）
   第5章：跌倒检测实现（🔧 2天）
   ```

---

### 长期规划（未来考虑）

**方案C: 切换到IWR6843硬件**

**为什么IWR6843可能是更好选择？**

| 特性 | AWRL6844 | IWR6843 | 说明 |
|------|---------|---------|------|
| 频段 | 60GHz | 60GHz | 相同 |
| 天线 | 4TX4RX | 3TX4RX | 差异不大 |
| **Vital Signs Demo** | ❌ 无 | ✅ 有 | 🔥 关键！ |
| **Fall Detection Demo** | ❌ 无 | ✅ 有 | 🔥 关键！ |
| **People Tracking** | ⚠️ 需开发 | ✅ 有 | |
| **文档完善度** | 🟡 中 | ✅ 高 | 社区活跃 |
| **成功案例** | 🟡 车内为主 | ✅ 医疗/养老多 | |

**IWR6843的优势**：
- 有现成的**生命体征检测Demo**（呼吸+心率）
- 有完整的**跌倒检测示例**
- **文档和社区支持更好**

**考虑时机**：
- 如果标准Demo路线也遇到困难
- 如果需要添加呼吸心率功能
- 项目预算允许更换硬件（~$99）

---

## 📖 经验教训总结

### 教训1: TI Demo不等于开箱即用

**错误认知**：
> "InCabin有occupancy classifier → 人存检测开箱即用"

**真相**：
- TI Demo是**技术展示**，不是**产品级代码**
- 很多Demo有**隐藏的前置条件**（文档深处才说）
- Quick Start ≠ 完整使用指南

**正确做法**：
- 先用最简单的Demo验证硬件（✅ 我们做了）
- 阅读完整的User Guide + Tuning Guide（❌ 我们跳过了）
- 小范围测试再做方案选择（❌ 直接就选了方案A）

---

### 教训2: 理论评估要考虑实施成本

**理论评估时忽略了**：
- 相位校准需要DCA1000（硬件成本）
- 相位校准需要学习mmWave Studio（时间成本）
- InCabin场景与养老监测的适配度（场景差异）

**应该评估的维度**：
- ✅ 功能是否存在
- ✅ 是否需要额外硬件
- ✅ 是否需要专业知识
- ✅ 场景是否匹配
- ✅ 社区支持如何

---

### 教训3: 小步验证胜过大跃进

**错误流程**：
```
理论分析 → 选方案A → 开始编译 → 遇到问题 → 深陷泥潭
```

**正确流程**：
```
理论分析 → 列出3个方案 
  → 每个方案快速验证（1天）
    → 选择验证成功的方案
      → 深入开发
```

**如果重来**：
```
Day 1: 测试标准Demo能否检测人存（简单算法）
Day 2: 测试InCabin Demo能否获得点云（先验证基础）
Day 3: 测试xWRL6432代码能否编译（评估移植难度）
Day 4: 根据验证结果选方案
Day 5+: 深入开发选定方案
```

---

## 🎯 决策建议

### 我的推荐（按优先级）

**🥇 推荐1: 立即切换标准Demo路线**

**优点**：
- ✅ 已验证硬件工作正常
- ✅ 无隐藏前置条件
- ✅ 开发纯软件逻辑
- ✅ 1周内可完成核心功能
- ✅ 成功率85%以上

**缺点**：
- ⚠️ 需要自己实现人存检测算法（但不复杂）
- ⚠️ 没有现成的CNN分类器（可以不用CNN，用规则判断）

**时间线**：
- Day 1-2: 人存检测（点云聚类）
- Day 3-5: 姿态检测（参考xWRL6432算法）
- Day 6-7: 跌倒检测（状态机）

---

**🥈 推荐2: 花1天测试官方InCabin固件**

**目的**：最后确认InCabin路线是否可行

**操作**：
1. 烧录TI官方预编译InCabin固件
2. 使用InCabin GUI + cpd.cfg测试
3. 观察是否有点云数据

**结果判断**：
- ✅ 有点云 → 自编译固件有问题，重新编译
- ❌ 无点云 → **立即放弃InCabin，切标准Demo**

**时间**：0.5天测试 + 0.5天决策

---

**🥉 备选3: 长期考虑IWR6843**

**时机**：
- 标准Demo完成后，如果需要添加呼吸心率
- 或者AWRL6844始终无法满足需求

**优势**：
- 有完整的Vital Signs Demo
- 有完整的Fall Detection示例
- 社区支持更好

---

## 📝 下一步行动清单

### 今天必须决定的问题

**问题1**: 是否继续InCabin路线？
- [ ] 是 → 执行"0.5天官方固件测试"
- [ ] 否 → 立即开始"标准Demo人存检测开发"

**问题2**: 是否需要更新文档？
- [ ] 是 → 修订02/03文档，切换方案
- [ ] 否 → 保留现有文档，在开发记录补充

**问题3**: 是否考虑换硬件？
- [ ] 近期不考虑
- [ ] 完成标准Demo后评估
- [ ] 立即研究IWR6843方案

---

## 📚 关联文档

### 需要修订的文档

1. **02-方案确认.md** - 方案A失败，改选方案B
2. **03-实施目录大纲.md** - 基于标准Demo重新规划
3. **00-能力评估报告.md** - 添加"修订说明"和实战结果

### 新增的文档

1. **本文档** - InCabin失败全面诊断
2. **2026-01-07_AWRL6844项目紧急重新评估报告.md** - 决策参考
3. **InCabin与标准Demo数据格式对比.md** - 技术分析

---

## 🎓 技术知识积累

### 学到的关键知识

1. **相位校准的重要性**
   - Capon算法对相位误差敏感
   - 需要DCA1000或mmWave Studio
   - 标准DoA算法容忍度高

2. **TLV数据格式**
   - 标准Demo: Type=1点云
   - InCabin Demo: Type=3001点云
   - 工具兼容性要提前验证

3. **Demo场景适配性**
   - InCabin = 车内场景（狭小空间）
   - 养老监测 = 室内场景（开放空间）
   - 场景差异可能导致算法不适用

4. **TI文档阅读顺序**
   - Quick Start → User Guide → Tuning Guide → Application Note
   - 完整流程很重要

---

**结论**: InCabin路线虽然理论上吸引人，但实战中遇到太多隐藏障碍。**建议立即切换到标准Demo路线**，以稳妥的方式完成项目目标。

> 💡 **核心教训**: "有现成算法"不等于"可以直接用"，隐藏的前置条件才是真正的难点。
