# 🔍 SBL烧录成功后无法检测设备的原因分析

**日期**: 2025-12-19  
**问题**: SBL烧录显示成功,但无法检测到设备  
**分析师**: AI Assistant

---

## 📋 问题描述

用户反馈:
- ✅ SBL烧录完成,显示 `Done Metaimage: 0`
- ✅ 烧录工具返回成功
- ❌ 但是后续无法检测到设备
- ❌ App烧录前需要再次拔插USB

---

## 🎯 根本原因（知识库证据）

### 1️⃣ **SOP模式问题** ⭐⭐⭐

**关键发现**（来自知识库）:

烧录完成后,设备需要 **切换SOP模式** 才能正常运行!

#### 烧录模式（SOP_MODE1）
```
S8 = OFF
S7 = OFF
功能: 进入QSPI Flash烧录模式
```

#### 运行模式（SOP_MODE2）
```
S8 = OFF
S7 = ON
功能: 从QSPI Flash启动应用
```

**问题所在**:
- SBL烧录时: SOP开关设为 [0 0]（烧录模式）
- 烧录完成后: **没有切换到 [0 1]（运行模式）**
- 结果: 设备仍然处于烧录模式,等待烧录指令
- 表现: 设备"无响应"、"检测不到"

---

### 2️⃣ **复位信号问题** ⭐⭐

**烧录工具输出分析**（来自烧录成功记录）:

```
set break signal
--- please restart the device ---
connection succeeded
```

**关键点**:
1. 烧录工具发送 `break signal` 后
2. 明确提示: `--- please restart the device ---`
3. **需要手动复位设备**,烧录才能继续

**烧录完成后的输出**:
```
Done Metaimage: 0
disconnecting device....
```

**问题所在**:
- `disconnecting device` 表示烧录工具断开连接
- 设备进入 **未定义状态**（flash写入完成,但未重启应用）
- 需要 **手动复位** 才能启动新烧录的SBL

---

### 3️⃣ **设备状态机问题** ⭐

**AWRL6844启动流程**:

```
上电/复位 → 读取SOP配置 → 进入对应模式
```

**烧录完成后的状态**:
```
Flash已写入新SBL → 但设备仍在烧录模式 → 没有执行SBL代码
```

**为什么检测不到**:
- SBL只是写入了Flash存储器
- **SBL代码还没有运行**
- 设备串口没有输出（因为SBL没启动）
- 检测工具无法收到SBL的输出信息

---

## 🔧 解决方案（标准操作流程）

### 方案1: SBL烧录后必须复位 ✅

**正确流程**:
```
1. 设置SOP = [0 0]（烧录模式）
2. 烧录SBL
3. 等待 "Done Metaimage: 0"
4. 【关键】设置SOP = [0 1]（运行模式）
5. 【关键】按RESET按钮
6. SBL启动并输出信息
7. 现在可以检测到设备了
```

### 方案2: 完整烧录流程（SBL+App）

**官方推荐**:
```
1. SOP = [0 0]
2. 拔插USB/按RESET
3. 烧录SBL
4. 【立即】拔插USB/按RESET
5. 烧录App（设备仍在烧录模式）
6. SOP = [0 1]
7. 按RESET
8. SBL+App一起启动
```

**为什么要立即烧录App**:
- 避免SOP模式切换
- 减少手动操作步骤
- 确保SBL和App的版本匹配

---

## 📚 知识库证据链

### 证据1: SOP模式配置文档

**来源**: `2025-12-12_SOP配置修正说明.md`

```markdown
### 烧录模式
SOP_MODE1 (QSPI刷写模式)
S8 S7 = 0 0

### 运行模式
SOP_MODE2 (应用/功能模式)
S8 S7 = 0 1
```

### 证据2: 烧录输出日志

**来源**: `SBL烧录成功记录_2025-12-19.md`

```
--- please restart the device ---
[等待用户复位设备]
connection succeeded
[烧录继续]
Done Metaimage: 0
disconnecting device....
[烧录工具退出]
```

### 证据3: 验证步骤文档

**来源**: `操作指南.md`

```markdown
### 验证成功
1. 设置SOP开关为SOP_MODE2 (SOP0=OFF, SOP1=ON)
2. 打开串口终端（115200 8N1）
3. 按复位按钮
4. 应看到输出：
   [BOOTLOADER_PROFILE] Boot Media : FLASH
```

---

## ⚠️ 常见误解

### 误解1: "烧录成功就能用了"
❌ **错误**: Flash写入≠代码运行  
✅ **正确**: 需要复位+SOP切换才能启动

### 误解2: "检测不到=烧录失败"
❌ **错误**: 可能只是没有复位设备  
✅ **正确**: 烧录成功,但设备没进入运行模式

### 误解3: "拔插USB就够了"
❌ **错误**: 拔插USB只是让设备进入烧录模式  
✅ **正确**: 还需要切换SOP开关到运行模式

---

## 🎯 工具改进建议

### 当前问题:
- 工具只提示"烧录成功"
- 没有提示用户切换SOP模式
- 没有提示用户复位设备

### 改进方案:

**SBL烧录完成后的提示**:
```python
messagebox.showinfo(
    "SBL烧录完成",
    "✅ SBL已烧录到Flash\n\n"
    "⚠️ 重要提示：\n"
    "1. 设置SOP开关: S8=OFF, S7=ON\n"
    "2. 按RESET按钮启动SBL\n"
    "3. 如需烧录App，请再次拔插USB\n\n"
    "💡 提示：完整烧录建议一次性烧录SBL+App"
)
```

---

## 📊 时间线分析

```
T0: 用户点击"仅SBL"烧录
T1: SOP = [0 0], 拔插USB
T2: 烧录工具写入Flash
T3: "Done Metaimage: 0" ✅
T4: 烧录工具断开连接

[此时设备状态]:
- Flash: ✅ SBL已写入
- 运行: ❌ SBL未启动
- SOP: ❌ 仍在烧录模式[0 0]
- 串口: ❌ 无输出

T5: 用户尝试"检测SBL"
T6: 工具发送测试命令
T7: 设备无响应（因为SBL没运行）
T8: 报告"检测不到" ❌

[正确操作]:
T5: 切换SOP = [0 1]
T6: 按RESET按钮
T7: SBL启动
T8: 串口输出 "[BOOTLOADER] Boot Media: FLASH"
T9: 检测成功 ✅
```

---

## 🔗 TI官方资料参考

### 搜索关键词:
- "AWRL6844 SOP mode flash programming"
- "AWRL6844 bootloader not responding after flash"
- "TI xWRL6843 SBL flash boot mode"

### E2E论坛搜索:
https://e2e.ti.com/
- 主题: mmWave Sensors
- 搜索: "SBL flash reset"

---

## ✅ 结论

**SBL烧录成功但检测不到的原因**:

1. **主要原因**: SOP开关仍在烧录模式[0 0],未切换到运行模式[0 1]
2. **次要原因**: 烧录完成后没有复位设备,SBL代码未运行
3. **根本原因**: 用户不了解烧录流程需要SOP模式切换

**解决方法**:
- ✅ 烧录完成后切换SOP为[0 1]
- ✅ 按RESET按钮启动SBL
- ✅ 或者直接选择"完整烧录(SBL+App)"避免中间状态

**工具改进**:
- 添加明确的SOP切换提示
- 添加复位设备提示
- 推荐使用完整烧录而非分步烧录

---

**更新时间**: 2025-12-19  
**文档状态**: ✅ 已验证
