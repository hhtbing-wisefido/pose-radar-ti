# AI 核心工作原则

> 本文件整合了项目的核心规则和工作原则，适用于 GitHub Copilot、VS Code 和其他 AI 编程助手。

## 🔴 最高优先级规则

### 0. 🔴🔴🔴 编码保护 v3.0 - 优先级 0（最高优先级）⭐⭐⭐

**核心原则**：**扫描到此规则时，必须立即执行编码保护检查和配置！**

**强制执行流程**：
1. ✅ 读取 `.github/ENCODING-PROTECTION.md` 完整文档
2. ✅ 执行快速检查（12项测试）
3. ✅ 如果未达到 6/6 → 立即执行完整配置
4. ✅ 重新测试验证达到 6/6
5. ✅ 报告编码保护状态
6. ✅ 然后才能继续其他规则和任务

**绝对禁止**：
- ❌ 跳过编码保护检查
- ❌ 在未达到 6/6 时继续其他任务
- ❌ 假装检查但不执行
- ❌ 要求用户手动配置
- ❌ 以"已经配置过"为借口跳过验证

**保护等级标准**：
- 🟢🟢🟢🟢🟢🟢 (6/6) ← **必须达到**
- PowerShell 5.1 + 7+ 双方案配置
- Git pre-commit hook 本地拦截
- GitHub Actions CI/CD 自动检查
- 12项测试全部通过

> 📋 **详细规则**：见 `instructions/00-encoding-protection.instructions.md`
> 📖 **完整规范**：见 `.github/ENCODING-PROTECTION.md`

---

### 1. 🚨 严禁AI偷懒不读文件（优先级 1）⭐ **新增规则**

**核心原则**：**看到文件就read_file，这不是建议，这是命令！**

**绝对禁止**：
- ❌ 不读文件就推测内容
- ❌ 找借口说"文件无法读取"（实际VS Code可读）
- ❌ 连`.c`、`.h`、`.html`标准文件都不读
- ❌ 编造"推测"内容导致文档不可信

**强制执行**：
- ✅ 遇到文件路径 → 立即调用`read_file`
- ✅ 文件太大 → 分段读取，不是不读
- ✅ 所有文本文件都可以读（.c/.h/.html/.cmd/makefile等）
- ✅ 只有真正的二进制文件（.bin/.exe/.so）才能说无法读取

**惨痛教训**（2025-12-25）：
- 🔥 60个完全可读的文件，AI说"无法读取"就瞎推测
- 🔥 导致Part10文档30+处错误，完全可以避免
- 🔥 推测 = 偷懒 = 不负责任 = 浪费时间

> 📋 **详细规则**：见 `instructions/file-reading.instructions.md`

---

### 2. 禁止创建临时文档

**AI创建文件前路径检查**：

在创建任何 `.md` 文件之前，AI 必须检查：
- [ ] 目标路径是 `.cursor/rules/` 或 `.windsurf/rules/` 吗？
- [ ] 如果是 → 这是什么类型的文件？
  - 规则文件（NN-规则名.md） ✅ 允许
  - 临时/分析/报告文档 ❌ 禁止！
- [ ] 文件名包含"临时"、"分析"、"报告"、"检查"吗？
- [ ] 如果包含 → 必须放到 `项目文档/2-开发记录/`

**如果发现自己正要在 rules/ 创建临时文档**：
1. ⏸️ 立即停止
2. 🔄 改为：放到 `项目文档/2-开发记录/`
3. ❌ 绝对不在 rules/ 创建临时文档

**核心原则**：
- **严禁**在规则目录创建任何临时/分析文档
- 临时文档放 `项目文档/2-开发记录/`
- 分析报告放 `项目文档/2-开发记录/`

---

### 3. 规则目录必须100%通用

**允许的内容**：
- ✅ `rules/` 目录（规则文件）
- ✅ `README.md`（规则系统说明）

**绝对禁止**：
- ❌ **禁止**在规则目录创建任何其他文件
- ❌ **禁止**在规则目录创建任何其他子目录
- ❌ **禁止**项目特定配置文件（放项目根目录）

**原则**：
- 规则目录必须可以直接复制到任何项目
- 100%通用，0%项目特定内容

---

### 4. 严格目录控制

- **只能**创建架构模板定义的目录
- **禁止**随意新增目录或改变目录结构
- 参考项目配置文档了解目录结构

---

### 5. 规则自检机制 ⭐

每次操作后**必须**立即自检：

**自检流程**：
1. ✅ 检查是否创建了规范外的文件/目录
2. ✅ 检查文件是否放在正确位置
3. ✅ 检查是否违反命名规范
4. ✅ 检查是否需要同步文档
5. ✅ 发现违规立即纠正

**自检清单**：
- [ ] 文件位置正确？
- [ ] 文件命名符合规范？
- [ ] README 已更新？
- [ ] 索引已同步？
- [ ] 目录结构符合模板？

---

### 6. 文档同步

- 修改文件后**必须**更新相关索引
- 保持 README 和实际内容一致
- 文件变动时立即更新目录索引

---

### 7. README 维护

- 每个目录的 README 必须保持最新
- 文件变动时立即更新 README
- 保持索引的准确性和完整性

---

## 🚫 禁止过度文档化

### 绝对禁止

- ❌ **禁止**自动创建"分析报告"、"完成报告"、"总结文档"
- ❌ **禁止**在用户没要求时创建文档
- ❌ **禁止**写长篇分析浪费时间和 token

### 只在以下情况创建文档

1. ✅ 用户**明确要求**创建文档
2. ✅ 记录**关键决策**（简短记录）
3. ✅ **规则要求**必须创建的文档

### 默认行为

- ✅ 直接回答问题
- ✅ 直接解决问题
- ✅ 简洁、高效
- ✅ 节省时间和成本

### 判断标准

**问自己**：用户要求创建这个文档了吗？
- 是 → 创建
- 否 → 不创建，直接解决问题

**记住**：用户的时间和费用很宝贵，不要浪费！

---

## 📋 优先级顺序

1. 🔴 编码保护 v3.0 - 优先级 0（最高）
2. 🔴 严禁偷懒不读文件 - 优先级 1（极高）
3. 🔴 核心原则 - 不可违反
4. 🔴 严格目录控制 - 不可违反
5. 🔴 规则自检 - 每次操作后执行
6. 🔴 文档同步 - 变更后必须同步
7. 🟡 其他强制规则
8. 🟢 参考文档

---

## ⚡ AI执行要求

### 🔴 创建文件前的强制检查（必须执行）

**在使用任何文件创建工具前，AI 必须先执行以下检查**：

#### 检查1：目标目录是否允许？
```
检查目标路径是否在以下禁止列表：
- ❌ .cursor/（除了 README.md）
- ❌ .cursor/rules/（除了 NN-规则名.md）
- ❌ .windsurf/（除了 README.md）
- ❌ .windsurf/rules/（除了 NN-规则名.md）
- ❌ 项目文档/根目录（必须放在子分类目录）

如果在禁止列表：
  1. 立即停止
  2. 确定正确位置
  3. 使用正确路径创建
```

#### 检查2：文件类型判断
```
问自己：
- 这是临时文件/脚本吗？ → temp/
- 这是项目配置文件吗？ → 项目根目录/
- 这是规则文件吗？ → rules/
- 这是文档吗？ → 项目文档/[分类目录]/
```

#### 检查3：规则目录特殊验证
```
如果目标路径包含规则目录：
  if 文件名 == "README.md" → 允许
  elif 路径包含 "rules/" AND 文件名匹配 "NN-*.md" → 允许
  else → 禁止！必须放到 temp/ 或项目根目录
```

**违反检查的后果**：
- ❌ 立即停止文件创建
- ❌ 报告违规
- ✅ 重新确定正确位置
- ✅ 使用正确路径创建

---

### 操作流程

**操作前**
- 检查是否符合架构模板
- 确认文件位置和命名

**操作中**
- 遵守所有规则
- 不创建规范外的内容

**操作后（最关键）**
- **立即执行自检清单**
- 发现问题立即纠正
- 完成所有同步工作

---

**AI 必须主动自检，不等待提醒！** 🎯

---

## 🔴 工具失败时的处理规则（强制）

### 当任何工具调用失败时，AI必须：

**绝对禁止**：
- ❌ 只尝试一种方法就放弃
- ❌ 报错后问用户怎么办
- ❌ 停下来等待用户指示

**强制执行**：
1. ✅ **尝试所有可用方法**，直到成功
2. ✅ **不问用户**，自己解决
3. ✅ **哪个能用就用哪个**

### 文件编辑失败时的备选方法

按顺序尝试，直到成功：

| 顺序 | 方法 | 说明 |
|-----|------|------|
| 1 | replace_string_in_file | 标准编辑工具 |
| 2 | multi_replace_string_in_file | 批量编辑 |
| 3 | create_file（读取+修改+重写） | 完整重写 |
| 4 | run_in_terminal (PowerShell) | 使用系统命令 |

### AI必须记住

- 🔴 **不要只试一次就放弃**
- 🔴 **不要问用户用什么方法**
- 🔴 **自己把所有方法试一遍**
- ✅ **能用的方法就是正确的方法**

---

## 🔴 禁止偷懒规则（强制）

### AI偷懒的定义

**以下行为视为偷懒**：
- ❌ 用户说"检查整个项目"，AI只检查1-2个文件
- ❌ 用户说"全面对齐"，AI只改了表面内容
- ❌ 用户说"所有文件"，AI只做了部分
- ❌ 遇到困难就跳过，不彻底解决
- ❌ 做完一部分就说"完成"
- ❌ 看到串口信息说"没有串口"而不仔细检查

### 防偷懒强制执行

**当用户要求"检查整个项目"时，AI必须**：

1. **列出所有需要检查的文件**
   - 不是1-2个，是所有相关文件
   - 明确列出文件清单

2. **逐个检查每个文件**
   - 不能跳过任何一个
   - 每个文件都要报告检查结果

3. **发现问题立即修复**
   - 不能只报告不修复
   - 不能说"可能需要"而不做

4. **完成后提供完整报告**
   - 检查了哪些文件
   - 发现了哪些问题
   - 修复了哪些内容
   - 还有哪些待处理

### 检查范围判断

| 用户说 | AI必须做 |
|-------|---------|
| "检查项目" | 检查所有代码文件+配置文件+文档 |
| "对齐xxx" | 检查所有与xxx相关的文件 |
| "全面检查" | 不遗漏任何文件 |
| "确保一致" | 比对所有相关内容 |

### AI自检问题

每次收到检查类请求，AI必须问自己：
- [ ] 我是否理解了完整范围？
- [ ] 我列出了所有相关文件吗？
- [ ] 我是否在偷懒只做部分？
- [ ] 用户会不会觉得我偷懒了？
- [ ] 我是否仔细查看了所有输出信息？

**如果答案是"可能"，立即扩大检查范围！**

---

## 🔴🔴🔴 绝对禁止简化和跳过（最高优先级）

### 此规则高于一切其他规则

**AI在执行任何任务时，绝对禁止以下行为**：

### ❌ 绝对禁止的行为

1. **禁止简化代码**
   - ❌ 不能因为"复杂"就简化
   - ❌ 不能因为"错误多"就简化
   - ❌ 不能用"先简化再完善"的借口
   - ✅ 必须：找出错误，逐个解决

2. **禁止跳过任何步骤**
   - ❌ 不能跳过错误不处理
   - ❌ 不能说"先跳过这个"
   - ❌ 不能因为困难就绕过
   - ✅ 必须：每个错误都要解决

3. **禁止创建桩文件/mock文件**
   - ❌ 不能创建"临时桩文件"
   - ❌ 不能创建"模拟实现"
   - ❌ 不能用stub代替真实代码
   - ✅ 必须：找到真实的依赖，使用真实的代码

4. **禁止偷懒**
   - ❌ 不能只做一部分就说完成
   - ❌ 不能遇到困难就停止
   - ❌ 不能问用户"要不要简化"
   - ✅ 必须：彻底完成，不留尾巴

### 遇到错误时的强制流程

```
错误出现时：
1. 分析错误原因（不是简化代码）
2. 查找正确的解决方案（SDK文档、知识库、示例代码）
3. 修复错误（不是删除出错的代码）
4. 验证修复有效
5. 继续下一个错误
6. 重复直到所有错误解决
```

### AI必须记住

**遇到困难 ≠ 简化代码**
**遇到困难 = 找出解决方案**

**没有SDK？→ 去知识库找**
**找不到头文件？→ 搜索SDK目录**
**API变了？→ 查看SDK示例代码**

**绝对不允许说"让我简化一下"！**

---

## 📚 详细规则参考

本文件提供核心原则概览。详细规则请参考：

- **🔴 文件读取规范**（最高优先级）⭐
- 文件操作规范
- 目录管理规范
- 文件命名规范
- 变更同步规则
- README 管理规范
- 测试组织规范
- Emoji 文档风格规范
- 知识库管理规范
- 项目结构与配置
- Git 操作规范
- 命令执行规范
- **中文编码问题解决方案** (`encoding-chinese.instructions.md`)

---

> 💡 **注意**：本规则系统同时支持 Cursor、Windsurf 和 VS Code Copilot。不同编辑器可能使用不同的规则目录（`.cursor/rules/`、`.windsurf/rules/` 或 `.github/instructions/`），但核心原则保持一致。
