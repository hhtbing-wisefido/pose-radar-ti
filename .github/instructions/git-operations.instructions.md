---
description: "Git操作规范 - 提交、推送、分支管理的标准流程"
applyTo: "**"
---

# 🔄 Git操作规范

**规则类型**: 🔴 强制规则  
**强制级别**: 🔴 严格执行  
**适用范围**: 所有Git操作

---

## 🎯 核心原则

### AI在执行Git操作时必须遵守

**绝对禁止**：

**🔴 AI执行Git命令前强制自检**：

在执行任何git add命令之前，AI必须问自己：
- [ ] 我要执行的命令中有-A、.、*吗？
- [ ] 如果有 → 这是禁止的！必须改成逐个指定文件
- [ ] 我执行了git status检查了吗？
- [ ] 我分析了哪些文件应该添加吗？

**如果发现自己正要执行git add -A**：
1. ⏸️ 立即停止
2. 🔄 改为：git status → 分析 → 逐个添加
3. ❌ 永远不要执行批量添加

**AI违规记录**：
- 如果发现自己执行了git add -A → 立即git reset撤销

---

- ❌ 禁止使用 `git add -A` 或 `git add .`
- ❌ 禁止不检查就批量添加文件
- ❌ 禁止提交临时文件、空文件、旧目录

**必须执行**：
- ✅ 必须先检查工作区状态
- ✅ 必须选择性添加文件
- ✅ 必须在提交前确认

---

## 📋 强制检查清单

### AI在执行 `git add` 前必须检查

#### 1. 检查工作区状态
```powershell
git status
```

**必须确认**：
- [ ] 查看了所有待添加的文件
- [ ] 识别了新文件、修改文件、删除文件
- [ ] 没有可疑的文件名

#### 2. 识别可疑文件

**可疑文件模式**（禁止添加）：
- `*temp*.py|.md|.txt` - 临时文件
- `*test*.py` - 测试文件
- `*_old*` - 旧文件
- `*backup*` - 备份文件
- `.windsurfrules/` - 旧规则目录
- `项目记录/` - 旧目录名
- 任何0字节的文件

**如发现可疑文件**：
1. ⏸️ 停止添加操作
2. 💬 询问用户："发现可疑文件 [文件名]，是否应该添加？"
3. ✅ 建议添加到 `.gitignore`

#### 3. 检查空文件

**AI必须检查**：
```powershell
# Windows PowerShell
Get-ChildItem -Recurse | Where-Object { $_.Length -eq 0 }
```

**发现空文件时**：
- ⏸️ 停止添加
- 💬 询问用户："发现空文件 [文件名]，是否应该删除？"

#### 4. 检查旧目录

**必须检查是否存在**：
- `.windsurfrules/` → 应删除
- `项目记录/` → 应重命名或删除
- 其他与架构模板不符的目录

---

## ✅ 正确的Git工作流程

### 步骤1: 检查状态
```powershell
git status
```

### 步骤2: 分析文件列表

**AI必须**：
1. 阅读所有文件路径
2. 识别可疑文件
3. 确定哪些应该添加

### 步骤3: 选择性添加

```powershell
# ✅ 正确 - 逐个添加
git add "文件路径1"
git add "文件路径2"
git add "文件路径3"

# ❌ 错误 - 批量添加
git add -A
git add .
git add *
```

### 步骤4: 再次确认
```powershell
git status
```

### 步骤5: 提交
```powershell
git commit -m "清晰的提交信息"
```

### 步骤6: 推送
```powershell
git push
```

---

## 🚫 绝对禁止的操作

### 禁止命令列表

| 禁止命令 | 原因 | 正确做法 |
|---------|------|---------|
| `git add -A` | 会添加所有文件 | 逐个指定文件 |
| `git add .` | 会添加当前目录所有 | 逐个指定文件 |
| `git add *` | 会添加匹配的所有 | 逐个指定文件 |
| `git commit -am` | 跳过检查 | 先add再commit |
| `git push -f` | 覆盖远程历史 | 正常push |

---

## 📝 提交信息规范

### 格式要求

```
<类型>: <简短描述>

[可选的详细说明]
```

### 类型标签

- `feat:` - 新功能
- `fix:` - 修复bug
- `docs:` - 文档更新
- `refactor:` - 重构代码
- `test:` - 测试相关
- `chore:` - 杂项（配置、依赖等）

### 示例

```
feat: 添加用户认证功能

实现了JWT token验证
添加了登录/登出API
更新了用户模型
```

---

## ⚠️ 特殊情况处理

### 场景1: 发现已添加可疑文件

```powershell
# 撤销所有添加
git reset

# 重新逐个添加
git add "正确的文件1"
git add "正确的文件2"
```

### 场景2: 误提交后

```powershell
# 撤销最后一次提交（保留修改）
git reset --soft HEAD~1

# 重新添加和提交
git add "正确的文件"
git commit -m "修正的提交信息"
```

### 场景3: 需要忽略某些文件

```powershell
# 编辑 .gitignore
echo "temp/" >> .gitignore
echo "*.log" >> .gitignore

# 提交 .gitignore
git add .gitignore
git commit -m "更新gitignore规则"
```

---

## 🔍 AI自检清单

每次执行git add前必须检查：

- [ ] 执行了 `git status` 吗？
- [ ] 分析了所有待添加的文件吗？
- [ ] 没有可疑文件吗？
- [ ] 没有空文件吗？
- [ ] 没有临时文件吗？
- [ ] 使用逐个添加而非批量添加吗？
- [ ] 提交信息清晰吗？

**如果任何一项是"否"，立即停止操作！**

---

**AI必须主动执行所有检查，不等待提醒！** 🎯
